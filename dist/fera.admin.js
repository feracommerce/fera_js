function __enlightenmentInstance(){return window.__enlighten=window.__enlighten||new Enlightenment,window.__enlighten}function enlighten(e,t,i){return __enlightenmentInstance().show(e,t,i)}function unlighten(e){return __enlightenmentInstance().hide(e)}Fera.AdminElementSelector=function(e){var t=this;e=e||{};var i,n,a=Fera.Util.$(),r=(e.closeAfter,e.elementHeight||"15px"),o=e.elementDisplayType||"block",s=e.elementMinWidth||150,l=[],d=[],h=function(){f(e),p(),v(),t.running=!0,t.stopped=!1,a(window).on("resize",m)},p=function(){var n,r=20;a("body","*").on("mousemove",(function(e){t.running&&((r+=1)>10&&(S(e),r=0),n&&clearTimeout(n),n=setTimeout((function(){r=20}),250))})),a("body","*").on("click",(function(e){if(t.running&&!t.stopped){var n=e||window.event;n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),null!=n.cancelBubble&&(n.cancelBubble=!0);var r=a(".fera-highlight");r.hasClass("fera-highlight-invalid")?alert("This element cannot be used as an integration point because it does not have a specific enough class or ID. Please contact your developer or the Fera support team for help with modifying your store's content if you really want it at this location."):(i||b(r),w())}})),a(document).on("keyup keydown",(function(i){var n=i.keyCode||i.which;t.stopped||27!==n||(t.pause(),t.stopped=!0,e.completedCallback()),t.stopped||16!==n||("keydown"===i.type?t.pause():(t.resume(),S(i)))}))},c=function(e){var t=e.attr("class");if(!t)return e;t=t.split(" ");for(var i=[],n=0;n<t.length;n++)t[n]&&-1===t[n].indexOf("fera-")&&""!==t[n]&&i.push(t[n]);return e.attr("class",i.join(" ")),e};t.pause=function(){t.running=!1,c(a(".fera-highlight")),a(".fera-highlight-placeholder").remove(),a("body").removeClass("fera-choosingLocation"),a("#feraElementSelectorStyles").remove()},t.resume=function(i,n){f(i),void 0!==n&&(e.completedCallback=n),t.running=!0,t.stopped=!1,v()};var f=function(t){e!==t&&(e=a.extend(e,t||{})),g()},g=function(){if(s=e.elementMinWidth,e.elementMinWidth)s=e.elementMinWidth;else if(e.locationOpts&&e.locationOpts.min_width)if(-1!==e.locationOpts.min_width.indexOf("%")){var t=parseFloat(e.locationOpts.min_width.replace("%",""))/100;s=a(window).width()*t}else s=e.locationOpts.min_width;else s=150},m=Fera.Util.debounce(g,250),u=function(e){return e.width()>=s},w=function(){var r=a(a(i)[0].outerHTML)[0].outerHTML;if(!r)return!1;var o={css_path:i,position:n,html:r.replace(/fera-highlight[^\s'"]*/g,"").replace(/ class="\s?"/,"").replace(/\n\n+/g,"\n").trim(),recommended_classes:l,recommended_styles:d};t.pause(),t.stopped=!0,e.completedCallback(o)},v=function(){var t='<style id="feraElementSelectorStyles"> .fera-highlight{ cursor: crosshair !important; } .fera-highlight.fera-highlight-invalid{ cursor: not-allowed !important; outline: 1px solid red !important; } body.fera-load-waiting::after {content: "";background-color: rgba(255, 255, 255, 0.5);position: fixed;left: 0;top: 0;right: 0;bottom: 0;z-index: 99999999;}';if(e.chooseLocation){a("body").addClass("fera-choosingLocation");var i=parseInt(r.replace("px",""));i=i>150?150:i;Math.max((i-15)/2,2);t+="[data-fera-widget] { opacity: 0.3; cursor: not-allowed; } .fera-highlight{ outline: 1px solid #0000ff24 !important; } .fera-highlight-placeholder { text-align: center !important;\n    width: 100% !important;\n    font-weight: bold !important;\n    color: black !important;\n    display: block !important;\n    background-color: #f0f2ff !important;\n    border: 4px solid #1800ff !important;\n    text-transform: uppercase !important;\n    z-index: 9 !important;\n    position: relative !important;\n    margin-left: auto !important;\n    margin-right: auto !important;\n    font-size: 16px !important;\n    cursor: crosshair !important;\n    height: 0 !important;}.fera-choosingLocation [data-fera-widget] * {\n    pointer-events: none;\n}@keyframes feraHighlightPulse {\n    0% {        box-shadow: none;    }    20% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    80% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    100% {        box-shadow: none;    }}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;\n    animation-duration: 1.5s;\n    animation-iteration-count: 1;\n    animation-timing-function: linear;}.fera-highlight.fera-highlight-before, .fera-highlight.fera-highlight-prepend_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n\n.fera-highlight.fera-highlight-after, .fera-highlight.fera-highlight-append_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n"}else t+=".fera-highlight{ outline: 2px solid #0000ff !important; } .fera-highlight.btn:not(.disabled):hover::after { border: none !important; }";t+="</style>",a("body").append(t)},b=function(e,t){var i;t=t||" ";var n=e.get(0).tagName;if(-1!==["TR","THEAD","TFOOT","TBODY"].indexOf(n))return null;if(e.hasClass("shopify-payment-button__button"))return null;if(!u(e))return null;if("flex"===e.parent().css("display"))return null;var r=function(e){return-1===e.indexOf("data-fera.")&&1===a(t+e).length};if(e.data("fera-widget")||e.parents("[data-fera-widget]").length>0||e.data("fera-skill")||e.parents("[data-fera-skill]").length>0)return null;if(e.attr("id")&&(e.attr("id")&&r("#"+e.attr("id"))&&!e.attr("id").match(/product[_\-.][0-9a-z]+/i)))return i=t+"#"+e.attr("id");if(e.data("section-id"))return i='[data-section-id="'+e.data("section-id")+'"]';if("FORM"===n&&e.attr("action")){var o='form[action="'+e.attr("action")+'"]';if(r(o))return i=t+o}if(e.attr("class"))for(var s=e.attr("class").replace(/\s\s+/gm," ").trim().split(" "),l=0;l<s.length;l++){var d=s[l];if(-1===d.indexOf("fera-highlight")&&r("."+d))return i=t+"."+d}if(r(n))return i=t+n.toLowerCase();var h=new Fera.CssPathGenerator(e.get(0),{skipDataAttributes:!0,skipAttributes:!0});return r(i=h.getPath())||r(i=(h=new Fera.CssPathGenerator(e.get(0),{skipAttributes:!0,maxDataAttrSize:60})).getPath())?t+i:null},x=function(){a(".fera-highlight").removeClass("fera-highlight fera-highlight-prepend_to fera-highlight-append_to fera-highlight-invalid fera-highlight-after fera-highlight-before fera-highlight-left fera-highlight-right")},P=function(t,i){var n=i.css("display"),a=-1===["table-cell","table-row","li"].indexOf(n);-1!==["table-cell","table-row"].indexOf(n)&&(a=!1);var r=!0;"block"===o&&e.chooseLocation&&(-1!==["inline-block","inline","flex"].indexOf(n)&&(r=!1),-1!==["H1","H2","H3","H4","H5","H6","P","A","TABLE","SVG","IMG"].indexOf(i[0].tagName)&&(r=!1)),i.is(".slideshow,.slick-slider")&&(r=!1);var s=i.height()/4,l=t.offsetY>=2*s,d=(t.offsetY,t.offsetY>=3*s),h=t.offsetY>=2*s&&t.offsetY<3*s,p=t.offsetY>=s&&t.offsetY<2*s;t.offsetY;return a&&d?"after":r&&(a&&h||!a&&l)?"append_to":r&&p||!a?"prepend_to":"before"},y=function(e,t){-1!==["after","before"].indexOf(t)&&-1!==["left","right"].indexOf(e.css("float"))?d.push("float: "+e.css("float")):-1!==["prepend_to","append_to"].indexOf(t)&&-1!==["left","right"].indexOf(e.children(":not(.fera-highlight-placeholder)").css("float"))&&d.push("float: "+e.children(":not(.fera-highlight-placeholder)").css("float")),e.hasClass("container")&&l.push("container");var i=parseInt(e.css("padding-bottom"));i&&i>0&&"after"===t&&d.push("margin-bottom: "+e.css("padding-bottom"));var n=parseInt(e.css("padding-top"));n&&n>0&&"before"===t&&d.push("margin-top: "+e.css("padding-top"));var a=parseInt(e.css("margin-bottom"));a&&a>0&&"after"===t&&d.push("margin-bottom: "+e.css("margin-bottom"));var r=parseInt(e.css("margin-top"));r&&r>0&&"before"===t&&d.push("margin-top: "+e.css("margin-top"))},_=function(){if(e.chooseLocation){var t=a("<div></div>");t.attr("style",d.join(" !important; ")),t.attr("class","fera-highlight-placeholder "+l.join(" ")),t.insertBefore(".fera-highlight-before"),t.insertAfter(".fera-highlight-after"),t.prependTo(".fera-highlight-prepend_to"),t.appendTo(".fera-highlight-append_to")}},S=function(t){var r=a(t.target);if(r.hasClass("fera-highlight-placeholder"))return!1;a(".fera-highlight-placeholder").remove();var o=b(r);if(!o){var s=r.parents("div[id]");(o=b(r,"#"+s.first().attr("id")+" "))&&(r=a(o))}if(r.parents(".slideshow,.slick-slider").length>0&&(r=r.parents(".slideshow,.slick-slider").first()),x(),d=[],l=[],r.addClass("fera-highlight"),null===o)return r.addClass("fera-highlight-invalid"),i=n=null,!1;n=P(t,r),r.addClass("fera-highlight-"+n),e.chooseLocation&&y(r,n),i=o,_()};h()},Fera.AdminIntegrationChecker=function(e){e=e||{};var t=this,i=Fera.Util.$();t.check=function(e){var t="==== YOUR CUSTOMERS WILL >>NOT<< SEE THIS MESSAGE ====\n\n",n="Please contact our support team at help@fera.ai and someone will be able to help you get it working.";"product_list"==e&&0==i('.banana-container[data-container_type="list"]').length&&alert(t+"It doesn't look like Fera is integrated properly into your list/grid/collection pages. "+n)}},Fera.AdminPanel=function(e){this.version=e.app.version;var t=this;e=e||{};var i,n,a,r,o=Fera.Util.$(),s=!1,l=function(){e.logger.log("~~ Loaded fera.admin.js version "+t.version+" ~~")};t.initHelpers=function(){i=e.containers,n=e.markAllContainersAsDirtyCallback,T(),g(),m(),S(),_(),u(),w(),k(),C(),$(),A(),v(),b(),x(),setInterval(x,1e3),P(),managePreviewMode()};t.showPreviewMessage=function(e){d()&&a.html(": "+e)};var d=function(){return e.sandboxMode};t.managePreviewMode=function(){d()&&(0===o("#feraPreviewModeIndicator").length&&(r=o('<div id="feraPreviewModeIndicator" class="fera-preview-mode-indicator"><img src="https://uploads.fera.ai/brand/icon.png" alt="Fera.ai Admin Preview"><span id="adminPreviewModeMainCaption">Widget Preview Mode</span><a class="close-preview" href="#">close preview</a><span id="adminPreviewModeMessage"></span><style>'+".fera-preview-mode-indicator-container {\n  height: 0;\n  width: 0;\n}\n.fera-preview-mode-indicator {\n  z-index: 99999999999;\n  position: fixed;\n  top: 0;\n  left: 0;\n  background-color: white;\n  color: #ff3500;\n  border: 12px solid #f44714;\n  padding: 18px 60px;\n  vertical-align: middle;\n  box-shadow: 0px 0px 20px #00000014;\n  cursor: grabbing;\n}\n.fera-preview-mode-indicator.draggable { cursor: grabbing; } \n.fera-preview-mode-indicator img {\n  max-height: 22px;\n  display: inline-block;\n  vertical-align: middle;\n}\n.fera-preview-mode-indicator #adminPreviewModeMainCaption {\n  height: 24px;\n  display: inline-block;\n  vertical-align: middle;\n  line-height: unset;\n  margin-left: 12px;\n  font-weight: bold;\n  letter-spacing: 1px;\n  text-transform: uppercase;}\n.fera-preview-mode-indicator:hover a.close-preview {\n    display: block;\n}\n\n.fera-preview-mode-indicator .close-preview {\n  position: absolute;\n  right: 4px;\n  top: 2px;\n  font-size: 10px;\n  text-transform: uppercase;\n  color: #ff3500;\n  text-decoration-color: #ff35003d;\n}@media(max-width: 500px) {\n .fera-preview-mode-indicator #adminPreviewModeMessage,\n .fera-preview-mode-indicator #adminPreviewModeMainCaption {\n     display: none;\n }  \n .fera-preview-mode-indicator {\n     padding: 4px;\n     border-width: 2px;\n } \n  .fera-preview-mode-indicator .close-preview {\n      background-color: white;\n      font-size: 8px;\n      position: relative;\n      left: 0;\n  }\n}"+"</style></div>"),o("body").prepend(r),a=r.find("#adminPreviewModeMessage"),r.find(".close-preview").on("click",(function(e){e.preventDefault(),e.stopPropagation(),h()})),p(),c(),o("#admin-bar-iframe").hide()))};var h=function(){return e.app.previewer.stopPreview(),!0},p=function(){o("a").each((function(){var t=o(this);if(!t.data("fera-preview-links-added")){var i=t.attr("href");"string"==typeof i&&""!==i&&0!==i.indexOf("#")&&(i=Fera.Util.updateURLParameter(i,"fera_test",e.testMode),i=Fera.Util.updateURLParameter(i,"fera_admin",e.adminMode),i=Fera.Util.updateURLParameter(i,"fera_preview",e.optionsParser.getPreviewId()),t.data("fera-preview-links-added",!0),t.attr("href",i))}}))},c=function(){var e=r.width(),t=r.height(),i=null;r.on("mousedown",(function(e){"close-preview"!==o(e.target).attr("class")&&(r.attr("unselectable","on").addClass("draggable"),i=r)})).on("mouseup",(function(){i=null,r.removeAttr("unselectable").removeClass("draggable")})),o("body").on("mousemove",(function(n){i&&i.offset({top:n.pageY-t/2,left:n.pageX-e/2})}))},f=function(){s?(t.$panel.hide(),s=!1):(t.$panel.show(),s=!0)},g=function(){o("#feraAdminPanelToggle").on("change",(function(e){e.preventDefault(),f()}))},m=function(){t.$panel.find("#feraAdminPanel--hide").on("click",(function(e){e.preventDefault(),e.stopPropagation(),o("#feraAdminPanelToggle").click()}))},u=function(){t.$panel.find("#feraAdminPanel--clearShownHistoryHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert('Fera only shows each social proof event (eg. "Someone has started buying X item") ONCE per customer.\n\nUse this action to clear Fera\'s "seen" history and re-display any shown social proof events for testing purposes.\n\nNote: Clearing of notifications will remain active until you switch to another page.'),!1}))},w=function(){t.$panel.find("#feraAdminPanel--clearShownHistory").on("click",(function(t){return t.preventDefault(),t.stopPropagation(),e.app.trigger("feeds.reset"),window.location=Fera.Util.updateURLParameter(window.location.toString(),"clear_notification_history",1),!1}))},v=function(){t.$panel.find("#feraAdminPanel--numContainersHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("This shows you the number of Fera containers located on this page. The Fera containers are what show Fera content embedded within your pages. \n\nIf you're expecting to see Fera embedded content ON THIS PAGE but you're not seeing anything and this number is 0, that probably means Fera is not properly integrated into your store's theme. Please follow our integration guides or seek help from one of our support staff to get integration working on your store."),!1})),t.$panel.find("#feraAdminPanel--numContainersValue").text(i.size())},b=function(){t.$panel.find("#feraAdminPanel--sessionTimeHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Shows how much time the user spent on site during the current session. Session resets after 1 hours of inactivity."),!1})),t.$panel.find("#feraAdminPanel--timeSinceFirstSeenHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Shows how much time has passed since the user first visited the site (including any time in the past). This timer never resets (unless the shoppers session is lost)."),!1})),t.$panel.find("#feraAdminPanel--timeOnCurrentPageHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Shows how much time the user spent on current page. This timer resets after the shopper navigates to any other page."),!1}))},x=function(){e.timeTracker&&(t.$panel.find("#feraAdminPanel--sessionTimeValue").text(y(e.timeTracker.getSessionTime())),t.$panel.find("#feraAdminPanel--timeSinceFirstSeenValue").text(y(e.timeTracker.getTimeSinceFirstSeen())),t.$panel.find("#feraAdminPanel--timeOnCurrentPageValue").text(y(e.timeTracker.getTimeOnCurrentPage())),t.$panel.find("#feraAdminPanel--inactiveTimeOnCurrentPageValue").text(y(e.timeTracker.getInactiveTimeOnPage())))},P=function(){(t.$panel.find("#feraAdminPanel--resetUserTimersHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Resets all timers: Session Time, Time on Current Page and Time Since 1st Seen."),!1})),e.timeTracker)&&t.$panel.find("#feraAdminPanel--resetUserTimers").on("click",(function(t){return t.preventDefault(),t.stopPropagation(),e.timeTracker.reset(),n&&n(),x(),!1}))},y=function(e){var t=e%60,i=(e=(e-t)/60)%60,n=(e-i)/60,a="";return n>0&&(a+=n+"h "),(i>0||n>0)&&(a+=i+"min "),n<=0&&(a+=t+"sec "),a},_=function(){t.$panel.find("#feraAdminPanel--testModeHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Test Mode allows admins to preview in-store campaigns using test data from our server. This is useful for you to see how a busy store will look to visitors."),!1}))},S=function(){var i=t.$panel.find("#feraAdminPanel--toggleTestMode");e.testMode?i.checked=!0:i.checked=!1,i.on("change",(function(t){t.preventDefault(),t.stopPropagation();var i=window.location.toString();return-1!==i.indexOf("fera_test")?-1!==(i=Fera.Util.updateURLParameter(i,"fera_test",e.testMode?0:1)).indexOf("test_mode")&&(i=Fera.Util.updateURLParameter(i,"test_mode",null)):i=Fera.Util.updateURLParameter(i,"fera_test",e.testMode?0:1),window.location=i,!1}))},C=function(){t.$panel.find("#feraAdminPanel--resetHelp").on("click",(function(e){return e.preventDefault(),e.stopPropagation(),alert("Resetting the timers will bring back any countdown timers to their starting position. This is useful to see how things look on your store to customers who have not had their timers expire yet."),!1}))},k=function(){t.$panel.find("#feraAdminPanel--reset").on("click",(function(t){return t.preventDefault(),t.stopPropagation(),e.app.trigger("timers.reset"),e.app.trigger("feeds.reset"),window.location.reload(),!1}))},$=function(){t.$panel.find("#feraAdminPanel--goBackToAdmin").on("click",(function(t){return t.preventDefault(),t.stopPropagation(),window.location=e.api.baseAppPath,!1}))},A=function(){t.$panel.find("#feraAdminPanel--turnOff").on("click",(function(e){if(e.preventDefault(),e.stopPropagation(),confirm("You can reactivate the storefront admin panel from your Fera account under the 'Store Settings' menu section.")){var t=window.location.toString();-1!==t.indexOf("fera_test")?-1!==(t=Fera.Util.updateURLParameter(t,"fera_test",0)).indexOf("test_mode")&&(t=Fera.Util.updateURLParameter(t,"test_mode",null)):t=Fera.Util.updateURLParameter(t,"fera_test",0),-1!==t.indexOf("fera_admin")?-1!==(t=Fera.Util.updateURLParameter(t,"fera_admin",0)).indexOf("admin_mode")&&(t=Fera.Util.updateURLParameter(t,"admin_mode",null)):t=Fera.Util.updateURLParameter(t,"fera_admin",0),window.location=t}}))},T=function(){o("#feraAdminPanelContainer").remove();var i='<div><div class="fera-button-wrapper" id="feraAdminButton"><input class="fera-hidden-trigger" id="feraAdminPanelToggle" type="checkbox"><div class="fera-circle"><label class="fera-circle-label" for="feraAdminPanelToggle"><img src="https://uploads.fera.ai/brand/icon.png" alt="Fera A.I. Admin Icon" /><div class="fera-button-label">Admin</div></label></div></div></div>',n='<div id="feraAdminPanelContainer"><div id="feraAdminPanel" class="fera-admin-panel"><div class="fera-admin-panel-header"><div class=fera-admin-panel-header-side></div><div class="fera-admin-panel-header-inner">Fera Admin Panel</div><div class="fera-admin-panel-header-side"><a href="#" id="feraAdminPanel--hide">Hide</a></div></div><div class="fera-admin-note"><strong>NOTE:</strong> Your customers will <b>not</b> see this panel or any admin buttons.</div><div class="fera-admin-option" id="feraToggleTestModeSection"><div>Test Mode<span class="fera-admin-panel-help" id="feraAdminPanel--testModeHelp">(?)</span> :</div>'+(e.testMode?'<label class="fera-toggle-switch"><input type="checkbox" checked id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>':'<label class="fera-toggle-switch"><input type="checkbox" id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>')+'</div><div class="fera-admin-option" id="feraNumContainersSection"><div>Fera Containers:<span class="fera-admin-panel-help" id="feraAdminPanel--numContainersHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--numContainersValue">n/a</span></div><div class="fera-admin-option" id="feraTimeOnCurrentPageSection"><div>Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--timeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraInactiveTimeOnCurrentPageSection"><div>Inactive Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--inactiveTimeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--inactiveTimeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraSessionTimeSection"><div>Time On Site<span class="fera-admin-panel-help" id="feraAdminPanel--sessionTimeHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--sessionTimeValue">n/a</span></div><div class="fera-admin-option" id="feraTimeSinceFirstSeenSection"><div>Time Since First Seen<span class="fera-admin-panel-help" id="feraAdminPanel--timeSinceFirstSeenHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeSinceFirstSeenValue">n/a</span></div><div class="fera-admin-option" id="feraResetUserTimersSection"><div>Reset Time<span class="fera-admin-panel-help" id="feraAdminPanel--resetUserTimersHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--resetUserTimers">Reset</div></div><div class="fera-admin-option" id="feraResetTimersSection"><div>Reset Cart Timers<span class="fera-admin-panel-help" id="feraAdminPanel--resetHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--reset">Reset</div></div><div class="fera-admin-option" id="feraClearShownHistorySection"><div>Reset Social Proof Events<span class="fera-admin-panel-help" id="feraAdminPanel--clearShownHistoryHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--clearShownHistory">Reset</div></div><div class="fera-admin-return"><a href="#" id="feraAdminPanel--goBackToAdmin">Go To Admin</a> <a href="#" id="feraAdminPanel--turnOff">Disable Admin Mode</a></div></div><style>'+F()+"</style>"+i+"</div>";o("body").append(n),t.$panel=o("#feraAdminPanel"),t.$panel.hide(),t.$toggleBtn=o("#feraAdminButton"),e.adminMode||t.$toggleBtn.hide()},F=function(){return'@keyframes radial-pulse{0%{box-shadow:0 0 0 0 rgba(0,0,0,.5)}to{box-shadow:0 0 0 30px transparent}}.fera-circle img,fera-button{-webkit-user-select:none;-ms-user-select:none}.fera-admin-panel{color:#1c1c1c;width:40%;min-width:450px;border-radius:0;position:fixed;z-index:999;font-size:12px;font-family:Helvetica,Arial,sans-serif!important}.fera-admin-panel-header-inner{margin:auto;font-size:18px;text-align:center;padding:5px 10px}.fera-admin-panel-header-side{top:0;bottom:0;padding:10px;font-weight:300;flex-shrink:0}.fera-admin-panel a{font-size:14px}.fera-admin-panel-logo{vertical-align:middle;width:18px;height:38px}.fera-admin-option{height:28px!important;margin:auto auto 12px;display:flex;flex-wrap:no-wrap;justify-content:space-between;font-size:14px;text-align:center}.fera-admin-option-value{flex-wrap:nowrap;font-weight:200;padding:2px 4px;margin-left:7px;border-bottom: 1px solid #c3c3c3;color:#404040;}.fera-admin-return{display:table;padding-top: 12px;width: 100%;}.fera-admin-return > a { display: table-cell !important;} .fera-admin-return > a:last-child {text-align: right !important;}.fera-admin-note{text-align:center;font-style:italic;font-weight:400;padding:10px; border: 1px solid #efefef;}@media (max-width:401px){.fera-admin-panel{display:none!important}}.fera-admin-panel-help{flex-wrap:nowrap;vertical-align:super;font-size:8px;margin-left:2px;text-decoration:none;cursor:pointer}.fera-admin-panel-help:hover{opacity:.7}.fera-toggle-switch{position:relative;display:inline-block;width:60px;height:28px}.fera-slider,.fera-slider:before{position:absolute;background-color:#fff;-webkit-transition:.4s;-ms-transition:.4s;transition:.4s}.fera-toggle-switch input{display:none}.fera-slider{cursor:pointer;top:0;right:0;box-shadow:0 1px 3px #969696 inset;left:0;bottom:0}.fera-slider:before{box-shadow:0 1px 3px #969696;content:"";height:24px;width:24px;left:2px;bottom:2px}.fera-reset-button{cursor:pointer;display:inline-block!important}.fera-button-wrapper,.fera-circle,.fera-circle-label{height:60px;width:60px}input:checked+.fera-slider{background-color:#00e640}input:focus+.fera-slider{box-shadow:0 1px 1px #969696}input:checked+.fera-slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(32px);transform:translateX(32px)}.fera-slider.round{border-radius:34px}.fera-slider.round:before{border-radius:50%}fera-button{user-select:none;border:0;outline:0}.fera-button-wrapper{z-index:100;position:fixed;bottom:100px;left:20px;top: initial !important;}.fera-circle{position:relative;padding:0;margin:0 auto;border-radius:50%;animation:radial-pulse 1.5s 1;transition:.2s;text-align:center;background-color:rgba(33,43,54,0.9);box-shadow:0 2px 2px 0 rgba(0,0,0,.2);}.fera-circle:active{-webkit-transform:scale(.9);-ms-transform:scale (.9);transform:scale(.9);box-shadow:0 2px 15px 0 rgba(0,0,0,.3)}.fera-circle:hover{cursor:pointer;background-color:#ff492a;box-shadow:0 8px 15px 0 rgba(0,0,0,.3)}.fera-hidden-trigger:checked~.fera-circle .fera-button-label{opacity: 0;}.fera-circle img{user-select:none;position:absolute;top:50%;left:50%;margin-left: -20px;margin-top: -16px; width: 40px;transition: .5s;filter: brightness(0%) invert(100%);}.fera-hidden-trigger{display:none!important}.fera-hidden-trigger:checked~.fera-circle img { filter: none; }.fera-button-label{position:absolute;left:8px;top:22px;font-weight:700;font-size:13px}.fera-admin-panel{box-shadow:1px -1px 4px 1px rgba(0,0,0,.2);left:80px;bottom:156px;top:inherit;background-color:#fff;padding:32px 54px;max-width:550px}.fera-admin-panel-header{display:table;width:100%}.fera-admin-panel a{color:#5b5bff!important;text-transform:uppercase;text-decoration:none!important;font-weight:400!important}.fera-button-label{text-transform:uppercase;text-shadow:-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff;color:#000}.fera-hidden-trigger:checked~.fera-circle{cursor:pointer;box-shadow:1px 4px 4px 1px rgba(0,0,0,.2);background-color:#fff;-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1);transform:scaleX(-1)}.fera-admin-panel a:hover{text-decoration:underline!important}.fera-reset-button{border-radius:1px;box-shadow:0 1px 2px #969696!important;padding:3px 18px;line-height:unset!important;text-transform:uppercase;background-color:#5b5bff!important;color:#fff}.fera-admin-note{border-top:none;border-bottom:none;background-color:#f9f9e7;font-size:12px;margin-bottom:12px}.fera-admin-panel-header-side{text-align:right;margin:0;vertical-align:middle;display:table-cell;width:50px}.fera-admin-option{width:100%}.fera-admin-panel-header-side:first-child{text-align:left}.fera-admin-panel-header-inner{vertical-align:middle;font-weight:400;display:table-cell} @media(max-width: 500px){ #feraAdminPanelContainer, #feraPreviewModeIndicator { display: none; }'};l()},Fera.AdminPreviewStyler=class{constructor(e){this._opts=e,this.app=this._opts.app}unhighlightPreviewSelectors(){this._findElement({selector:".fera-highlightingSelector, .fera-flashingSelector",success:e=>{e.data("highlighted",!1),e.data("flashing",!1),e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-highlightingSelector"),e.removeClass("fera-flashingSelector")}})}unhighlightPreviewSelector(e){this._findElement({selector:e,success:e=>{e.data("highlighted")&&(e.data("highlighted",!1),e.removeClass("fera-highlightingSelector")),e.data("flashing")&&(e.stop(),e.data("flashing",!1),e.removeClass("fera-flashingSelector")),e.css("outline",""),e.css("outline-offset","")}})}highlightPreviewSelector(e){this._findElement({selector:e,success:e=>{e.data("highlighted")||(e.data("highlighted",!0),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.addClass("fera-highlightingSelector"))}})}flashPreviewSelector(e){this._findElement({selector:e,success:e=>{e.data("highlighted")||e.data("flashing")||(e.data("flashing",!0),e.addClass("fera-flashingSelector"),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.css("outline-color","rgba(93, 156, 236, 0.6)").animate({"outline-color":"rgba(255, 255, 255, 0)"},1e3,"swing",(function(){e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-flashingSelector"),e.data("flashing",!1)})))}})}fetchStyle(e,t,i){this._findElement({selector:e.replace("&gt;",">"),success:e=>{i(e.css(t))},fail:()=>{Fera.logger.warn("Selectable element doesn't exist so initial value could not be detected by CurrentStyleDetector.",e,t),i(null)},addBack:!0})}_findPreviewContainer(){if(this.app.getContainers().toArray().length<1)return null;const e=this.app.getContainers().toArray()[0].abstractBlocks;if(!e)return null;const t=Object.keys(e);return e[t[0]]?e[t[0]].$el:null}_findElement({success:e,fail:t,addBack:i=!1,retries:n,selector:a}){const r=this._findPreviewContainer();if(!r)return t&&t(),!1;const o=r.parent().find(a);if(o&&o.length>0)e&&e(o);else{if(n&&!(n<6))return t&&t(),!1;setTimeout((()=>this._findElement({success:e,fail:t,addBack:i,retries:(n||0)+1})),200)}}};var Enlightenment=function(e){var t=this,i='<div class="enlightenment" style="display: none; z-index: 9999999; position: relative; opacity: 0.7;"></div>',n='<div class="enlightenment-side" style="transition: left .1s ease-in; -webkit-transition: left .1s ease-in; transition: top .1s ease-in; -webkit-transition: top .1s ease-in;position: absolute; display: block; width: 100%; height: 100%; background-color: black;" ></div>',a='<svg class="enlightenment-corner" style="position: absolute; width: 100%; height: 100%;" width="1" height="1" viewBox="0 0 1 1" fill="none" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0C0 0 0.00625002 0.4 0.3 0.7C0.59375 1 1 1 1 1H0V0Z" fill="black"/></svg>',r='<svg class="enlightenment-corner" style="position: absolute; width: 100%; height: 100%;" width="1" height="1" viewBox="0 0 1 1" fill="none" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 1C0 1 0.00625002 0.6 0.3 0.3C0.59375 -1.49012e-08 1 -1.49012e-08 1 -1.49012e-08H0V1Z" fill="black"/></svg>',o=["bottomLeft","bottomRight","topLeft","topRight"],s=["left","right","top","bottom"].concat(o),l=Fera.Util.$(),d=function(){t.opts=l.extend({},Enlightenment.DEFAULT_OPTIONS,e||{}),t.throttledReposition=T(t.reposition,t.opts.repositionThrottle,!0),g(),m(),f()};this.configure=function(e){return t.opts=l.extend(t.opts,e||{}),t},this.isVisible=function(e){return e?w(e):t.visible},this.then=function(e){return t.showOpts.onHidden=e,t},this.show=function(e,i,n){if(!(e=e||t.opts.$el))throw"Element must be provided in first param or constructor params.";return e.get||(e=l(e)),t.visible?t:u(e)?(console.log("not showing because is enlightenment el itself"),t):w(e)?(console.log("Already being shown on this element."),t):c(e)?(U(),y(),x(),t.$el&&t.built&&t.visible&&t.hide(),h(i,n),t.$el=e,t.reposition(!0),p(),"number"==typeof t.showOpts.for&&setTimeout((function(){t.hide()}),t.showOpts.for),t):(console.log("Element we want to show a lightbox around isn't even visible"),t)},this.hide=function(e){return t.built&&t.visible?(t.showOpts.onHide&&t.showOpts.onHide(t),t.$el.trigger("enlightenment.hide"),e="function"==typeof e?e:t.showOpts.onHidden,t.opts.hideAnimation?(t.$el.addClass("unlightening"),t.$container.fadeOut(t.opts.hideAnimationSpeed,(function(){P(),t.$el.removeClass("unlightening"),e&&e(t),t.$el.trigger("enlightenment.hidden")}))):(t.$container.hide(),e&&e(t),t.$el.trigger("enlightenment.hidden"),P()),t.$el.removeClass("enlightened"),t.visible=!1,t):t},this.reposition=function(e){if((e||t.visible)&&t.built&&t.$el&&t.attached){var i=t.$el;if(i.height()<=0)if(i.children().height())i=i.children();else if(i.children().children().height())i=i.children().children();else{if(!i.children().children().children().height())return;i=i.children().children().children()}t.left=i.offset().left,
t.top=i.offset().top,t.height=F(i),t.width=O(i),t.bottom=t.top+t.height,t.right=t.left+t.width;var n=A(),a=n.height,r=n.width;return _("bottomLeft","bottom-left",i),_("bottomRight","bottom-right",i),_("topLeft","top-left",i),_("topRight","top-right",i),t.$pads.left.css({left:0,top:0,width:t.left,height:a}),t.$pads.right.css({left:t.right,top:0,width:r-t.width-t.left,height:a}),t.$pads.top.css({left:t.left,top:0,width:t.width,height:t.top}),t.$pads.bottom.css({left:t.left,top:t.bottom,width:t.width,height:a-t.height-t.top}),t}};var h=function(e,i){t.showOpts="function"==typeof e?{onShown:e}:"number"==typeof e?{for:e}:"object"==typeof e?e:{},i&&(t.showOpts.onHidden=i)},p=function(){t.$el.trigger("enlightenment.show"),t.opts.showAnimation?(t.$el.addClass("enlightening"),t.$container.fadeIn(t.opts.showAnimationSpeed,(function(){t.$el.removeClass("enlightening"),t.showOpts.onShown&&t.showOpts.onShown(t),t.$el.trigger("enlightenment.shown")}))):(t.$container.hide(),t.showOpts.onShown(t),t.$el.trigger("enlightenment.shown")),t.visible=!0,t.$el.addClass("enlightened"),t.lastShownAt=(new Date).getTime()},c=function(e){var t=e.get?e:l(e);if((Object&&Object.getPrototypeOf?Object.getPrototypeOf(t).jquery:l&&l.zepto)&&!t.is(":visible"))return!1;if("none"==t.css("display")||"hidden"==t.css("visibility")||0==t.css("opacity"))return!1;if(0===t.height()&&0===t.children().height()&&0===t.children().children().height())return!1;for(var i=t.parent();i.length>0&&-1===["BODY","HTML"].indexOf(i.prop("tagName"));){if("hidden"==i.css("visibility")||0==i.css("opacity"))return!1;i=i.parent()}return!0},f=function(){l(document).on("mousedown","*",(function(e){e.currentTarget==e.target&&t.visible&&(w(e.target)||u(e.target))&&(!t.opts.hideOnInsideClick&&w(e.target)||!t.opts.hideOnOutsideClick&&u(e.target)||b()||(t.lastHiddenAt=(new Date).getTime(),t.hide()))}))},g=function(){l(window).on("resize",(function(){t.built&&t.visible&&t.throttledReposition()}))},m=function(){setInterval((function(){t.built&&t.visible&&(t.throttledReposition(),c(t.$el)||t.hide())}),t.opts.repositionThrottle)},u=function(e){var t=e.get?e:l(e);return t.hasClass("enlightenment")||t.hasClass("lightbox")||t.parents(".lightbox").length>0||t.parents(".enlightenment").length>0},w=function(e){if(!t.built)return!1;if(t.visible||v()){if(e==t.$el.get(0))return!0;var i=e.get?e:l(e);return i.hasClass("enlightened")||i.parents(".enlightened").length>0}},v=function(){return!!t.lastHiddenAt&&(new Date).getTime()<t.lastHiddenAt+t.opts.hideAnimationSpeed},b=function(){return!!t.lastShownAt&&(new Date).getTime()<t.lastShownAt+t.opts.showAnimationSpeed},x=function(){t.$pads.bottomLeft.children("path").attr("fill",t.opts.color),t.$pads.bottomRight.children("path").attr("fill",t.opts.color),t.$pads.topLeft.children("path").attr("fill",t.opts.color),t.$pads.topRight.children("path").attr("fill",t.opts.color),t.$pads.left.css("background-color",t.opts.color),t.$pads.right.css("background-color",t.opts.color),t.$pads.top.css("background-color",t.opts.color),t.$pads.bottom.css("background-color",t.opts.color)},P=function(){return t.attached&&t.$container?(t.$container.remove(),t.attached=!1,this):this},y=function(){return t.attached||(l("body").prepend(t.$container),t.attached=!0),this},_=function(e,i,n){var a=C(i,n);a.width/a.height>3||a.height/a.width>3?$(e):k(e),t.$pads[e].css(a),t.$pads[e].css(S(e))},S=function(e){if("bottomLeft"==e)return{top:t.bottom-t.$pads[e].height(),left:t.left};if("bottomRight"==e)return{top:t.bottom-t.$pads.bottomRight.height(),left:t.right-t.$pads.bottomRight.width()};if("topLeft"==e)return{top:t.top,left:t.left};if("topRight"==e)return{top:t.top,left:t.right-t.$pads.topRight.width()};throw"Invalid corner requested to calculate the offset of"},C=function(e,i){var n=i.css("border-"+e+"-radius");if(!n)return{width:0,height:0};var a=n.match(/^\d*(\.\d+)?(.*)$/),r=a[a.length-1],o=n.replace(r,"");if(!r&&!n)return{width:0,height:0};var s={};if("px"===r)s.width=s.height=parseInt(o);else if("rem"===r||"em"===r){var l=parseFloat(o);s.width=s.height=l&&l>=.0625?Math.ceil(l/.0625):0}else if("%"===r){var d=parseFloat(o)/100;s.width=d*t.width,s.height=d*t.height}else s.width=s.height=0;return s},k=function(e){var i="M0 0C0 0 0.00625002 0.4 0.3 0.7C0.59375 1 1 1 1 1H0V0Z";"bottomRight"!=e&&"topLeft"!=e||(i="M0 1C0 1 0.00625002 0.6 0.3 0.3C0.59375 -1.49012e-08 1 -1.49012e-08 1 -1.49012e-08H0V1Z"),t.$pads[e].attr("width","1").attr("height","1").get(0).setAttribute("viewBox","0 0 1 1"),t.$pads[e].children("path").attr("d",i),t.$pads[e].addClass("lightbox-corner--narrow").removeClass("lightbox-corner--wide")},$=function(e){var i="M0 0C0 0 0.412502 4 19.8 7C39.1875 10 66 10 66 10H0V0Z";"bottomRight"!=e&&"topLeft"!=e||(i="M0 10C0 10 0.412502 6 19.8 3C39.1875 0 66 0 66 0H0V10Z"),t.$pads[e].attr("width","66").attr("height","10").get(0).setAttribute("viewBox","0 0 66 10"),t.$pads[e].children("path").attr("d",i),t.$pads[e].addClass("lightbox-corner--wide").removeClass("lightbox-corner--narrow")},A=function(){var e=document.body,t=document.documentElement;return{height:Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight),width:Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)}},T=function(e,t,i){var n,a;return function(){var r=this,o=arguments,s=(new Date).getTime();if(!a||s>a+t)return a=(new Date).getTime(),e.apply(r,o);i&&(n=n||setTimeout((function(){n=null,a=(new Date).getTime(),e.apply(r,o)}),t-(s-a)))}},F=function(e){var t,i=0,n=0,a=e.get(0);if(navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 9.")){var r=a.offsetHeight,o=getComputedStyle(a);return r+parseFloat(o.marginTop)+parseFloat(o.marginBottom)}return t=document.defaultView.getComputedStyle(a,""),void 0!==a.offsetHeight?i=a.getBoundingClientRect().height:("number"!=typeof(i=(t=document.defaultView.getComputedStyle(a,"")).getPropertyValue("height"))&&(i=0),n=parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))),"border-box"!=t.getPropertyValue("box-sizing")&&(i+=H(t,"left")+H(t,"right")),parseFloat(i)+parseFloat(n)},H=function(e,t){var i=e.getPropertyValue("border-"+t+"-width");if(!i)return 0;var n=i.match(/^\d*(\.\d+)?(.*)$/),a=n[n.length-1],r=i.replace(a,"");if("px"===a)return parseFloat(r);if("rem"===a||"em"===a){var o=parseFloat(r);return o&&o>=.0625?Math.ceil(o/.0625):0}return 0},O=function(e){var t,i=0,n=0,a=e.get(0);if(navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 9.")){var r=a.offsetWidth,o=getComputedStyle(a);return r+parseFloat(o.marginLeft)+parseFloat(o.marginRight)}return t=document.defaultView.getComputedStyle(a,""),void 0!==a.offsetWidth?i=a.getBoundingClientRect().width:("number"!=typeof(i=(t=document.defaultView.getComputedStyle(a,"")).getPropertyValue("height"))&&(i=0),n=parseFloat(t.getPropertyValue("margin-left"))+parseFloat(t.getPropertyValue("margin-right"))),"border-box"!=t.getPropertyValue("box-sizing")&&(i+=H(t,"top")+H(t,"bottom")),parseFloat(i)+parseFloat(n)},U=function(){if(!t.built){t.$pads={},t.$pads.bottomLeft=l(a).addClass("lightbox-pad-bottomLeft"),t.$pads.topRight=l(a).css("transform","rotate(180deg)").addClass("lightbox-pad-topRight"),t.$pads.topLeft=l(r).addClass("lightbox-pad-topLeft"),t.$pads.bottomRight=l(r).css("transform","rotate(180deg)").addClass("lightbox-pad-bottomRight"),t.$pads.left=l(n).addClass("lightbox-pad-left"),t.$pads.right=l(n).addClass("lightbox-pad-right"),t.$pads.top=l(n).addClass("lightbox-pad-top"),t.$pads.bottom=l(n).addClass("lightbox-pad-bottom"),t.$container=l(i),t.opts.zIndex&&t.$container.css("z-index",t.opts.zIndex);for(var e=0;e<s.length;e++)t.$container.append(t.$pads[s[e]]);t.built=!0}};d()};Enlightenment.DEFAULT_OPTIONS={padding:0,hideOnInsideClick:!0,hideOnOutsideClick:!0,hideAnimation:!0,showAnimation:!0,color:"black",repositionThrottle:100,hideAnimationSpeed:200,showAnimationSpeed:200},Fera.AdminPreviewer=class{constructor(e,t=!0){this.containers=e.containers,this.optionsParser=e.optionsParser,this.app=e.app,this.$=Fera.Util.$(),this.$previewContainer=this.$(),this._initCss(),t&&this._ensureCartPreviewWorksHasProducts()||(this.styler=new Fera.AdminPreviewStyler(e),this.sandboxMessenger=new Fera.AdminSandboxMessenger({parentDomain:e.api.baseAppPath,previewer:this,styler:this.styler,configured:t,app:e.app,optionsParser:e.optionsParser}),this._assumeSectionBasedOnProductId(),this.app.getSection()?this.markReady():this.app.api.getSection((e=>{this.app.setSection(e),this.markReady()})))}markReady(){this.sandboxMessenger.ready(),"complete"===document.readyState?this.sandboxMessenger.send("document.ready",{}):this.$(document).on("ready",(()=>{this.sandboxMessenger.send("document.ready",{})})),this.$(window).on("beforeunload",(()=>{this.sandboxMessenger.send("window.unload",{})})),this.active=!0}selectLocation(e,t){if(unlighten(),this.elementSelector)this.elementSelector.resume(e,t);else{const i=this.$.extend({elementHeight:(this._testHeight()||30)+"px",closeAfter:!1,completedCallback:t},e||{});this.elementSelector=new Fera.AdminElementSelector(i)}}scrollToElement(e){const t=this.$(e);Fera.Util.isVisible(t)&&Fera.Util.scrollToElement(t,{duration:200})}pauseSelectLocation(){this.elementSelector&&this.elementSelector.pause()}getContent(e){this.sandboxMessenger.getContent(e)}getState(e){this.sandboxMessenger&&this.sandboxMessenger.getState(e)}updatePreview(e,t){const i=this.lastPreviewUpdate;this.lastPreviewUpdate=this.$.extend({},i||{},e||{},{isPreview:!0,cacheable:!1}),this.lastPreviewUpdate.store&&(this.app.storeSettings=this.lastPreviewUpdate.store),this._shouldNotRenderInThisSection()?this.setState("notVisibleInCurrentSection"):this.containers&&this.containers.globalBottom&&this.containers.globalBottom.abstractBlocks?(this.setState("checking"),this.app.refreshContent((()=>{const e=this.containers.globalBottom.abstractBlocks,n=e[Object.keys(e)[0]];if(!n)return void this._retryPreviewUpdate(t,"missingContainer");const a=["custom_popup","custom_notif"].some((e=>e==n.type));this.$previewContainer=n.$el,this.$previewContainer&&0!==this.$previewContainer.length?(a||this._debouncedHighlightPreview({scroll:this._shouldScroll(i,t)}),this.setState("success")):this._retryPreviewUpdate(t,"missingSelector")}))):this._retryPreviewUpdate(t,"missingContainer")}_shouldNotRenderInThisSection(){if(this.lastPreviewUpdate&&this.lastPreviewUpdate.settings&&this.lastPreviewUpdate.settings.store_sections&&this.lastPreviewUpdate.settings.store_sections!=[]&&this.lastPreviewUpdate.settings.store_sections!=["any"]&&this.lastPreviewUpdate.settings.store_sections.length>0&&-1===this.lastPreviewUpdate.settings.store_sections.indexOf(this.app.getSection()))return!0}_shouldScroll(e,t){const i=((this.lastPreviewUpdate||{}).settings||{}).integration_selector,n=((e||{}).settings||{}).integration_selector,a=((this.lastPreviewUpdate||{}).settings||{}).integration_selector_action,r=((e||{}).settings||{}).integration_selector_action;return(n!==i||r!==a||!!t||!1!==this._allowHighlights)&&".banana-globalBottom-container"!==i}_retryPreviewUpdate(e,t){(e||0)<5?(this.containers.locateNewContainers(),this.setState("checking"),setTimeout((()=>this.updatePreview({},(e||0)+1)),500)):this.setState(t)}findBestLocation(e){const t=new Fera.IntegrationLocator(this.app).findBestLocation(e);this.sandboxMessenger.send("previewer.findBestLocation.result",t)}findBestPresetLocations(e){const t={};for(const i in e)if("string"==typeof i)for(const n of e[i]){const e=this.$(n.selector);if(n.multi&&e.length>0||1==e.length){t[i]=n;break}}this.sandboxMessenger.send("previewer.findBestPresetLocations.result",t)}setState(e){if(this.state==e)return;this._oldState=this.state,this.state=e;const t={lastPreviewUpdate:this.lastPreviewUpdate,newState:this.state,oldState:this._oldState};this.sandboxMessenger.send("previewer.state.change",t)}stopPreview(){let e=window.location.toString();e=Fera.Util.updateURLParameter(e,"fera_preview",null),e=Fera.Util.updateURLParameter(e,"fera_test",null),e=Fera.Util.updateURLParameter(e,"fera_admin",null),e=Fera.Util.updateURLParameter(e,"test_mode",null),e=Fera.Util.updateURLParameter(e,"admin_mode",null),e=Fera.Util.updateURLParameter(e,"preview",null),e=Fera.Util.updateURLParameter(e,"fera",null),e=Fera.Util.updateURLParameter(e,"fera_sandbox",null),this.app.cookieJar.setCookie("Fera.SandboxTest.Enabled",!1,-1),this.sandboxMessenger.send("previewer.cancel"),window.location=e}_assumeSectionBasedOnProductId(){this.app.on("ready",(()=>{this.app.on("product.set",(()=>{var e=this.app.getSection();e&&"other"!==e&&"home"!==e||(this.app.setSection("product_view"),this.updatePreview())}));var e=this.app.getSection();!this.app.getProductId()||e&&"other"!==e&&"home"!==e||this.app.setSection("product_view")}))}_genBestLocationParams(e,t){const i=["display","width","position","transform","background-color","font-size","border","text-align","margin","padding"];return{found:!0,location:e,target:{css:t.css(i)},parent:{css:t.parent().css(i)},siblings:t.siblings().map(((e,t)=>({css:this.$(t).css(i)}))).toArray(),prev:t.prev().css(i),next:t.next().css(i)}}_removeMerchantMaskClasses(){["async-hide"].forEach((e=>this.$previewContainer&&this.$previewContainer.parents(`.${e}`).removeClass(`.${e}`)))}highlight(){this._highlightPreview({scroll:!0,force:!0})}_initCss(){this.$previewerCss=this.$(`<style id="feraAdminPreviewerCss">${this._previewerCss()}</style>`),this.$("body").append(this.$previewerCss)}_resetHighlight(e){this._allowHighlights=!0,e.data("fera-highlighted-container",!1)}_debouncedHighlightPreview(e={}){this._debouncedHightlightScroll=this._debouncedHightlightScroll||e.scroll,this._debouncedHighlightPreviewMethod||(this._debouncedHighlightPreviewMethod=Fera.Util.debounce((e=>this._highlightPreview(e)),500)),this._debouncedHighlightPreviewMethod(e)}_findElementToHighlight(){if(this.app.getContainers().toArray().length<1)return null;const e=this.app.getContainers().toArray()[0].abstractBlocks;if(!e)return null;const t=Object.keys(e);return e[t[0]]?e[t[0]].$el:null}_highlightPreview(e={}){(e=e||{}).scroll=e.scroll||this._debouncedHightlightScroll,this._debouncedHightlightScroll=null;let t=this._findElementToHighlight();if(!t)return;const i=t.parents(".fera-container,.banana-container");if(t=i.length>0?i.first():t.first(),this._removeMerchantMaskClasses(),e.force&&this._resetHighlight(t),e.scroll)return Fera.Util.scrollToElement(t,{duration:200,callback:()=>this._highlightPreview({scroll:!1})});!1!==this._allowHighlights&&(this._lastHighlighted$el=t,this._showLightBox(t),setTimeout((()=>{this._allowHighlights=!1}),300))}_showLightBox(e){e.data("fera-highlighted-container")||(enlighten(e,2e3),e.data("fera-highlighted-container",!0))}_scrollToPreview(e){if(".banana-globalBottom-container"===e)return;this.$(e).length<1||this._highlightPreview()}_testHeight(){if(this.elementHeight||!this.lastPreviewUpdate)return this.elementHeight;const e=this.$(this.lastPreviewUpdate.html.replace(/<!--[\s\S]*?-->/g,"").trim());return e.css("visibility","hidden"),this.$("body").append(e),this.elementHeight=e.height(),e.remove(),this.elementHeight}_ensureCartPreviewWorksHasProducts(){if(window.performance&&window.performance.navigation.type==window.performance.navigation.TYPE_BACK_FORWARD)return!1;if(this.optionsParser.sandboxMode&&this.optionsParser.sandboxError)return!1;if(!this.optionsParser.hasUrlFlag("ensure_loaded_cart"))return this._goToCheckoutOnFlag();const e=this.optionsParser.urlParams.sample_variant_id,t=this.optionsParser.urlParams.sample_product_id;return t?(e?this._addProductToCartIfEmpty(t,{variant_id:e}):this._addProductToCartIfEmpty(t,{}),!0):(Fera.logger.error("Expected sample product in the params but didn't get one so couldn't ensure that the cart was loaded. Please contact the fera.ai support team if you see this message.",this.optionsParser.urlParams),!1)}_addProductToCartIfEmpty(e,t){this.app.cart.addProductIfEmpty(e,t,{afterAdd:function(){const e=window.location.toString();setTimeout((function(){window.location=Fera.Util.updateURLParameter(e,"ensure_loaded_cart","0")}),1e3)}})}openCartDrawer(){"cart"!==this.app.getSection()&&setTimeout((()=>{const e=this.$("[data-drawer-id='sidebar-cart']:not([data-action='close-drawer']), [aria-controls='CartDrawer'], .ajax-cart__toggle, .js-drawer-open-cart")[0];e&&e.click()}),1e3)}_previewerCss(){return"@keyframes feraHighlightPulse-light {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    80% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    100% { box-shadow: none; }}@keyframes feraHighlightPulse {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    80% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    100% { box-shadow: none; }}body.fera-highlight-container-body .card--reveal {    transform: none !important;    -webkit-transform: none !important;    -ms-transform: none !important;    transition: none !important;}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;    animation-duration: 2s;    animation-iteration-count: 1;    animation-timing-function: linear;}.fera-highlight-container--dark {    animation-name: feraHighlightPulse;}a.fera-highlight-container-container {    overflow: visible;    z-index: 2;}body.fera-highlight-container-body > div {    overflow: visible;}body.fera-highlight-container-body #shopify-section-header,body.fera-highlight-container-body > header {    z-index: 0 !important;}body.fera-highlight-container-body .site-header--sticky {    position: static;}body.fera-highlight-container-body > main {    z-index: 0 !important;}"}_goToCheckoutOnFlag(){return!!this.optionsParser.hasUrlFlag("go_to_checkout")&&(this.$(window).on("load",(()=>{this.app.cart.startCheckout()})),!0)}},Fera.AdminSandboxMessenger=class{constructor(e){this.parentDomain=e.parentDomain,this.previewer=e.previewer,this.styler=e.styler,this.configured=e.configured,this.optionsParser=e.optionsParser,this.parentWindow=e.app.parentWindow,e.app.on("widget.create:after",(()=>{this.send("widget.create:after",{})})),this._getContentCallbacks=[],this._getStateCallbacks=[]}ready(){if(!this.parentWindow)return;const e=window.feraAdminSandboxStatus||200;let t=window.feraAdminSandboxMessage;t=t?decodeURIComponent(t):null,this.configured?(this._initIframeListener(),this._bindFocusListener(),this._readyForParent({status:e,message:t})):parseInt(e)<400?this._readyForParent({status:500,message:"bad_config"}):this._readyForParent({status:e,message:t})}getContent(e){this._getContentCallbacks.push(e),this.send("getContent")}getState(e){this._getStateCallbacks.push(e),this.send("getState")}setContent(e){for(;this._getContentCallbacks.length>0;){this._getContentCallbacks.shift()(e)}}setState(e){for(;this._getStateCallbacks.length>0;){this._getStateCallbacks.shift()(e)}}_initIframeListener(){window.addEventListener("message",(e=>{if(e.origin&&!e.origin.match(/(127\.0\.0\.1|localhost)(:[0-9]+)?/i)&&e.origin!==this.parentDomain)return;const t=JSON.parse(e.data);this.send("gotMessage",{id:t.id}),this._trigger(t)}))}_bindFocusListener(){window.addEventListener("focus",(()=>{this.send("focused")}),!0)}_readyForParent(e={}){this.send("ready",Fera.Util.$().extend({},{href:window.location.href,referrer:document.referrer,status:200},e||{}))}send(e,t){!this.parentWindow||this.parentWindow.length<0||this.parentWindow.postMessage(JSON.stringify({methodName:e,params:t}),this.parentDomain)}_trigger(e){"selectLocation"===e.methodName&&this.previewer.selectLocation(e.params,(e=>{window.stop(),this.send("window.stop",{}),this.send("locationSelected",e)})),"pauseSelectLocation"===e.methodName?this.previewer.pauseSelectLocation(e.params):"updatePreview"===e.methodName?this.previewer.updatePreview(e.params):"fetchStyle"===e.methodName?this.styler.fetchStyle(e.params.selector,e.params.attribute,(t=>{this.send("styleFetched",{callbackId:e.params.callbackId,value:t})})):"unhighlightPreviewSelectors"===e.methodName?this.styler.unhighlightPreviewSelectors():"unhighlightPreviewSelector"===e.methodName?this.styler.unhighlightPreviewSelector(e.params):"highlightPreviewSelector"===e.methodName?this.styler.highlightPreviewSelector(e.params):"flashPreviewSelector"===e.methodName?this.styler.flashPreviewSelector(e.params):"highlight"===e.methodName?this.previewer.highlight(e.params):"scrollToElement"===e.methodName?this.previewer.scrollToElement(e.params):"findBestLocation"===e.methodName?this.previewer.findBestLocation(e.params):"findBestPresetLocations"===e.methodName?this.previewer.findBestPresetLocations(e.params):"openCartDrawer"===e.methodName?this.previewer.openCartDrawer():"window.stop"===e.methodName?this.send("window.stop",{}):"extendSandboxCookie"===e.methodName?this.optionsParser.extendSandboxCookie():"function"==typeof this[e.methodName]&&this[e.methodName](e.params)}};