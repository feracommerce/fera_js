function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function __enlightenmentInstance(){return window.__enlighten=window.__enlighten||new Enlightenment,window.__enlighten}function enlighten(e,t,i){return __enlightenmentInstance().show(e,t,i)}function unlighten(e){return __enlightenmentInstance().hide(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Fera.AdminElementSelector=function(h){var n=this;h=h||{};var a,r,c=Fera.Util.$(),i=(h.closeAfter,h.elementHeight||"15px"),p=h.elementDisplayType||"block",t=h.elementMinWidth||150,o=[],s=[],e=function(){f(h),l(),w(),n.running=!0,n.stopped=!1,c(window).on("resize",u)},l=function(){var t,i=20;c("body","*").on("mousemove",function(e){n.running&&(10<(i+=1)&&(C(e),i=0),t&&clearTimeout(t),t=setTimeout(function(){i=20},250))}),c("body","*").on("click",function(e){if(n.running&&!n.stopped){var t=e||window.event;t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0);var i=c(".fera-highlight");i.hasClass("fera-highlight-invalid")?alert("This element cannot be used as an integration point because it does not have a specific enough class or ID. Please contact your developer or the Fera support team for help with modifying your store's content if you really want it at this location."):(a||b(i),v())}}),c(document).on("keyup keydown",function(e){var t=e.keyCode||e.which;n.stopped||27!==t||(n.pause(),n.stopped=!0,h.completedCallback()),n.stopped||16!==t||("keydown"===e.type?n.pause():(n.resume(),C(e)))})},d=function(e){var t=e.attr("class");if(!t)return e;t=t.split(" ");for(var i=[],n=0;n<t.length;n++)t[n]&&-1===t[n].indexOf("fera-")&&""!==t[n]&&i.push(t[n]);return e.attr("class",i.join(" ")),e};n.pause=function(){n.running=!1,d(c(".fera-highlight")),c(".fera-highlight-placeholder").remove(),c("body").removeClass("fera-choosingLocation"),c("#feraElementSelectorStyles").remove()},n.resume=function(e,t){f(e),void 0!==t&&(h.completedCallback=t),n.running=!0,n.stopped=!1,w()};var f=function(e){h!==e&&(h=c.extend(h,e||{})),g()},g=function(){if(t=h.elementMinWidth,h.elementMinWidth)t=h.elementMinWidth;else if(h.locationOpts&&h.locationOpts.min_width)if(-1!==h.locationOpts.min_width.indexOf("%")){var e=parseFloat(h.locationOpts.min_width.replace("%",""))/100;t=c(window).width()*e}else t=h.locationOpts.min_width;else t=150},u=Fera.Util.debounce(g,250),m=function(e){return e.width()>=t},v=function(){var e=c(c(a)[0].outerHTML)[0].outerHTML;if(!e)return!1;var t={css_path:a,position:r,html:e.replace(/fera-highlight[^\s'"]*/g,"").replace(/ class="\s?"/,"").replace(/\n\n+/g,"\n").trim(),recommended_classes:o,recommended_styles:s};n.pause(),n.stopped=!0,h.completedCallback(t)},w=function(){var e='<style id="feraElementSelectorStyles"> .fera-highlight{ cursor: crosshair !important; } .fera-highlight.fera-highlight-invalid{ cursor: not-allowed !important; outline: 1px solid red !important; } body.fera-load-waiting::after {content: "";background-color: rgba(255, 255, 255, 0.5);position: fixed;left: 0;top: 0;right: 0;bottom: 0;z-index: 99999999;}';if(h.chooseLocation){c("body").addClass("fera-choosingLocation");var t=parseInt(i.replace("px",""));t=150<t?150:t;Math.max((t-15)/2,2);e+="[data-fera-widget] { opacity: 0.3; cursor: not-allowed; } .fera-highlight{ outline: 1px solid #0000ff24 !important; } .fera-highlight-placeholder { text-align: center !important;\n    width: 100% !important;\n    font-weight: bold !important;\n    color: black !important;\n    display: block !important;\n    background-color: #f0f2ff !important;\n    border: 4px solid #1800ff !important;\n    text-transform: uppercase !important;\n    z-index: 9 !important;\n    position: relative !important;\n    margin-left: auto !important;\n    margin-right: auto !important;\n    font-size: 16px !important;\n    cursor: crosshair !important;\n    height: 0 !important;}.fera-choosingLocation [data-fera-widget] * {\n    pointer-events: none;\n}@keyframes feraHighlightPulse {\n    0% {        box-shadow: none;    }    20% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    80% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    100% {        box-shadow: none;    }}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;\n    animation-duration: 1.5s;\n    animation-iteration-count: 1;\n    animation-timing-function: linear;}.fera-highlight.fera-highlight-before, .fera-highlight.fera-highlight-prepend_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n\n.fera-highlight.fera-highlight-after, .fera-highlight.fera-highlight-append_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n"}else e+=".fera-highlight{ outline: 2px solid #0000ff !important; } .fera-highlight.btn:not(.disabled):hover::after { border: none !important; }";e+="</style>",c("body").append(e)},b=function(e,t){var i;t=t||" ";var n=e.get(0).tagName;if(-1!==["TR","THEAD","TFOOT","TBODY"].indexOf(n))return null;if(e.hasClass("shopify-payment-button__button"))return null;if(!m(e))return null;if("flex"===e.parent().css("display"))return null;var a=function(e){return-1===e.indexOf("data-fera.")&&1===c(t+e).length};if(e.data("fera-widget")||0<e.parents("[data-fera-widget]").length||e.data("fera-skill")||0<e.parents("[data-fera-skill]").length)return null;if(e.attr("id")&&(e.attr("id")&&a("#"+e.attr("id"))&&!e.attr("id").match(/product[_\-.][0-9a-z]+/i)))return i=t+"#"+e.attr("id");if(e.data("section-id"))return i='[data-section-id="'+e.data("section-id")+'"]';if("FORM"===n&&e.attr("action")){var r='form[action="'+e.attr("action")+'"]';if(a(r))return i=t+r}if(e.attr("class"))for(var o=e.attr("class").replace(/\s\s+/gm," ").trim().split(" "),s=0;s<o.length;s++){var l=o[s];if(-1===l.indexOf("fera-highlight")&&a("."+l))return i=t+"."+l}if(a(n))return i=t+n.toLowerCase();var d=new Fera.CssPathGenerator(e.get(0),{skipDataAttributes:!0,skipAttributes:!0});return a(i=d.getPath())?t+i:a(i=(d=new Fera.CssPathGenerator(e.get(0),{skipAttributes:!0,maxDataAttrSize:60})).getPath())?t+i:null},x=function(){c(".fera-highlight").removeClass("fera-highlight fera-highlight-prepend_to fera-highlight-append_to fera-highlight-invalid fera-highlight-after fera-highlight-before fera-highlight-left fera-highlight-right")},y=function(e,t){var i=t.css("display"),n=-1===["table-cell","table-row","li"].indexOf(i);-1!==["table-cell","table-row"].indexOf(i)&&(n=!1);var a=!0;"block"===p&&h.chooseLocation&&(-1!==["inline-block","inline","flex"].indexOf(i)&&(a=!1),-1!==["H1","H2","H3","H4","H5","H6","P","A","TABLE","SVG","IMG"].indexOf(t[0].tagName)&&(a=!1)),t.is(".slideshow,.slick-slider")&&(a=!1);var r=t.height()/4,o=e.offsetY>=2*r,s=(e.offsetY,e.offsetY>=3*r),l=e.offsetY>=2*r&&e.offsetY<3*r,d=e.offsetY>=r&&e.offsetY<2*r;e.offsetY;return n&&s?"after":a&&(n&&l||!n&&o)?"append_to":a&&d||!n?"prepend_to":"before"},P=function(e,t){-1!==["after","before"].indexOf(t)&&-1!==["left","right"].indexOf(e.css("float"))?s.push("float: "+e.css("float")):-1!==["prepend_to","append_to"].indexOf(t)&&-1!==["left","right"].indexOf(e.children(":not(.fera-highlight-placeholder)").css("float"))&&s.push("float: "+e.children(":not(.fera-highlight-placeholder)").css("float")),e.hasClass("container")&&o.push("container");var i=parseInt(e.css("padding-bottom"));i&&0<i&&"after"===t&&s.push("margin-bottom: "+e.css("padding-bottom"));var n=parseInt(e.css("padding-top"));n&&0<n&&"before"===t&&s.push("margin-top: "+e.css("padding-top"));var a=parseInt(e.css("margin-bottom"));a&&0<a&&"after"===t&&s.push("margin-bottom: "+e.css("margin-bottom"));var r=parseInt(e.css("margin-top"));r&&0<r&&"before"===t&&s.push("margin-top: "+e.css("margin-top"))},k=function(){if(h.chooseLocation){var e=c("<div></div>");e.attr("style",s.join(" !important; ")),e.attr("class","fera-highlight-placeholder "+o.join(" ")),e.insertBefore(".fera-highlight-before"),e.insertAfter(".fera-highlight-after"),e.prependTo(".fera-highlight-prepend_to"),e.appendTo(".fera-highlight-append_to")}},C=function(e){var t=c(e.target);if(t.hasClass("fera-highlight-placeholder"))return!1;c(".fera-highlight-placeholder").remove();var i=b(t);if(!i){var n=t.parents("div[id]");(i=b(t,"#"+n.first().attr("id")+" "))&&(t=c(i))}if(0<t.parents(".slideshow,.slick-slider").length&&(t=t.parents(".slideshow,.slick-slider").first()),x(),s=[],o=[],t.addClass("fera-highlight"),null===i)return t.addClass("fera-highlight-invalid"),a=r=null,!1;r=y(e,t),t.addClass("fera-highlight-"+r),h.chooseLocation&&P(t,r),a=i,k()};e()},Fera.AdminIntegrationChecker=function(e){e=e||{};var t=this,n=Fera.Util.$();t.check=function(e){var t="==== YOUR CUSTOMERS WILL >>NOT<< SEE THIS MESSAGE ====\n\n",i="Please contact our support team at help@fera.ai and someone will be able to help you get it working.";"product_list"==e&&0==n('.banana-container[data-container_type="list"]').length&&alert(t+"It doesn't look like Fera is integrated properly into your list/grid/collection pages. "+i)}},Fera.AdminPanel=function(n){this.version=n.app.version;var a=this;n=n||{};var e,t,i,r,o=Fera.Util.$(),s=!1,l=function(){n.logger.log("~~ Loaded fera.admin.js version "+a.version+" ~~")};a.initHelpers=function(){e=n.containers,t=n.markAllContainersAsDirtyCallback,T(),g(),u(),C(),k(),m(),v(),S(),_(),$(),A(),w(),b(),x(),setInterval(x,1e3),y(),managePreviewMode()};a.showPreviewMessage=function(e){d()&&i.html(": "+e)};var d=function(){return n.sandboxMode};a.managePreviewMode=function(){if(d()&&0===o("#feraPreviewModeIndicator").length){var e=".fera-preview-mode-indicator-container {\n  height: 0;\n  width: 0;\n}\n.fera-preview-mode-indicator {\n  z-index: 99999999999;\n  position: fixed;\n  top: 0;\n  left: 0;\n  background-color: white;\n  color: #ff3500;\n  border: 12px solid #f44714;\n  padding: 18px 60px;\n  vertical-align: middle;\n  box-shadow: 0px 0px 20px #00000014;\n  cursor: grabbing;\n}\n.fera-preview-mode-indicator.draggable { cursor: grabbing; } \n.fera-preview-mode-indicator img {\n  max-height: 22px;\n  display: inline-block;\n  vertical-align: middle;\n}\n.fera-preview-mode-indicator #adminPreviewModeMainCaption {\n  height: 24px;\n  display: inline-block;\n  vertical-align: middle;\n  line-height: unset;\n  margin-left: 12px;\n  font-weight: bold;\n  letter-spacing: 1px;\n  text-transform: uppercase;}\n.fera-preview-mode-indicator:hover a.close-preview {\n    display: block;\n}\n\n.fera-preview-mode-indicator .close-preview {\n  position: absolute;\n  right: 4px;\n  top: 2px;\n  font-size: 10px;\n  text-transform: uppercase;\n  color: #ff3500;\n  text-decoration-color: #ff35003d;\n}@media(max-width: 500px) {\n .fera-preview-mode-indicator #adminPreviewModeMessage,\n .fera-preview-mode-indicator #adminPreviewModeMainCaption {\n     display: none;\n }  \n .fera-preview-mode-indicator {\n     padding: 4px;\n     border-width: 2px;\n } \n  .fera-preview-mode-indicator .close-preview {\n      background-color: white;\n      font-size: 8px;\n      position: relative;\n      left: 0;\n  }\n}";r=o('<div id="feraPreviewModeIndicator" class="fera-preview-mode-indicator"><img src="'+n.api.baseCdnPath+'/img/branding/logo_icon.png" alt="Fera.ai Admin Preview"><span id="adminPreviewModeMainCaption">Widget Preview Mode</span><a class="close-preview" href="#">close preview</a><span id="adminPreviewModeMessage"></span><style>'+e+"</style></div>"),o("body").prepend(r),i=r.find("#adminPreviewModeMessage"),r.find(".close-preview").on("click",function(e){e.preventDefault(),h()}),c(),p(),o("#admin-bar-iframe").hide()}};var h=function(){return n.app.previewer.stopPreview(),!0},c=function(){o("a").each(function(){var e=o(this);if(!e.data("fera-preview-links-added")){var t=e.attr("href");"string"==typeof t&&""!==t&&0!==t.indexOf("#")&&(t=Fera.Util.updateURLParameter(t,"fera_test",n.testMode),t=Fera.Util.updateURLParameter(t,"fera_admin",n.adminMode),t=Fera.Util.updateURLParameter(t,"fera_preview",n.optionsParser.getPreviewId()),e.data("fera-preview-links-added",!0),e.attr("href",t))}})},p=function(){var t=r.width(),i=r.height(),n=null;r.on("mousedown",function(e){"close-preview"!==o(e.target).attr("class")&&(r.attr("unselectable","on").addClass("draggable"),n=r)}).on("mouseup",function(){n=null,r.removeAttr("unselectable").removeClass("draggable")}),o("body").on("mousemove",function(e){n&&n.offset({top:e.pageY-i/2,left:e.pageX-t/2})})},f=function(){s?(a.$panel.hide(),s=!1):(a.$panel.show(),s=!0)},g=function(){o("#feraAdminPanelToggle").on("change",function(e){e.preventDefault(),f()})},u=function(){a.$panel.find("#feraAdminPanel--hide").on("click",function(e){e.preventDefault(),o("#feraAdminPanelToggle").click()})},m=function(){a.$panel.find("#feraAdminPanel--clearShownHistoryHelp").on("click",function(e){return e.preventDefault(),alert('Fera only shows each social proof event (eg. "Someone has started buying X item") ONCE per customer.\n\nUse this action to clear Fera\'s "seen" history and re-display any shown social proof events for testing purposes.\n\nNote: Clearing of notifications will remain active until you switch to another page.'),!1})},v=function(){a.$panel.find("#feraAdminPanel--clearShownHistory").on("click",function(e){return e.preventDefault(),n.app.trigger("feeds.reset"),window.location=Fera.Util.updateURLParameter(window.location.toString(),"clear_notification_history",1),!1})},w=function(){a.$panel.find("#feraAdminPanel--numContainersHelp").on("click",function(e){return e.preventDefault(),alert("This shows you the number of Fera containers located on this page. The Fera containers are what show Fera content embedded within your pages. \n\nIf you're expecting to see Fera embedded content ON THIS PAGE but you're not seeing anything and this number is 0, that probably means Fera is not properly integrated into your store's theme. Please follow our integration guides or seek help from one of our support staff to get integration working on your store."),!1}),a.$panel.find("#feraAdminPanel--numContainersValue").text(e.size())},b=function(){a.$panel.find("#feraAdminPanel--sessionTimeHelp").on("click",function(e){return e.preventDefault(),alert("Shows how much time the user spent on site during the current session. Session resets after 1 hours of inactivity."),!1}),a.$panel.find("#feraAdminPanel--timeSinceFirstSeenHelp").on("click",function(e){return e.preventDefault(),alert("Shows how much time has passed since the user first visited the site (including any time in the past). This timer never resets (unless the shoppers session is lost)."),!1}),a.$panel.find("#feraAdminPanel--timeOnCurrentPageHelp").on("click",function(e){return e.preventDefault(),alert("Shows how much time the user spent on current page. This timer resets after the shopper navigates to any other page."),!1})},x=function(){n.timeTracker&&(a.$panel.find("#feraAdminPanel--sessionTimeValue").text(P(n.timeTracker.getSessionTime())),a.$panel.find("#feraAdminPanel--timeSinceFirstSeenValue").text(P(n.timeTracker.getTimeSinceFirstSeen())),a.$panel.find("#feraAdminPanel--timeOnCurrentPageValue").text(P(n.timeTracker.getTimeOnCurrentPage())),a.$panel.find("#feraAdminPanel--inactiveTimeOnCurrentPageValue").text(P(n.timeTracker.getInactiveTimeOnPage())))},y=function(){(a.$panel.find("#feraAdminPanel--resetUserTimersHelp").on("click",function(e){return e.preventDefault(),alert("Resets all timers: Session Time, Time on Current Page and Time Since 1st Seen."),!1}),n.timeTracker)&&a.$panel.find("#feraAdminPanel--resetUserTimers").on("click",function(e){return e.preventDefault(),n.timeTracker.reset(),t&&t(),x(),!1})},P=function(e){var t=e%60,i=(e=(e-t)/60)%60,n=(e-i)/60,a="";return 0<n&&(a+=n+"h "),(0<i||0<n)&&(a+=i+"min "),n<=0&&(a+=t+"sec "),a},k=function(){a.$panel.find("#feraAdminPanel--testModeHelp").on("click",function(e){return e.preventDefault(),alert("Test Mode allows admins to preview in-store campaigns using test data from our server. This is useful for you to see how a busy store will look to visitors."),!1})},C=function(){var e=a.$panel.find("#feraAdminPanel--toggleTestMode");n.testMode?e.checked=!0:e.checked=!1,e.on("change",function(e){e.preventDefault();var t=window.location.toString();return-1!==t.indexOf("fera_test")?-1!==(t=Fera.Util.updateURLParameter(t,"fera_test",n.testMode?0:1)).indexOf("test_mode")&&(t=Fera.Util.updateURLParameter(t,"test_mode",null)):t=Fera.Util.updateURLParameter(t,"fera_test",n.testMode?0:1),window.location=t,!1})},_=function(){a.$panel.find("#feraAdminPanel--resetHelp").on("click",function(e){return e.preventDefault(),alert("Resetting the timers will bring back any countdown timers to their starting position. This is useful to see how things look on your store to customers who have not had their timers expire yet."),!1})},S=function(){a.$panel.find("#feraAdminPanel--reset").on("click",function(e){return e.preventDefault(),n.app.trigger("timers.reset"),n.app.trigger("feeds.reset"),window.location.reload(),!1})},$=function(){a.$panel.find("#feraAdminPanel--goBackToAdmin").on("click",function(e){return e.preventDefault(),window.location=n.api.baseAppPath,!1})},A=function(){a.$panel.find("#feraAdminPanel--turnOff").on("click",function(){if(confirm("You can reactivate the storefront admin panel from your Fera account under the 'Store Settings' menu section.")){var e=window.location.toString();-1!==e.indexOf("fera_test")?-1!==(e=Fera.Util.updateURLParameter(e,"fera_test",0)).indexOf("test_mode")&&(e=Fera.Util.updateURLParameter(e,"test_mode",null)):e=Fera.Util.updateURLParameter(e,"fera_test",0),-1!==e.indexOf("fera_admin")?-1!==(e=Fera.Util.updateURLParameter(e,"fera_admin",0)).indexOf("admin_mode")&&(e=Fera.Util.updateURLParameter(e,"admin_mode",null)):e=Fera.Util.updateURLParameter(e,"fera_admin",0),window.location=e}})},T=function(){var e;o("#feraAdminPanelContainer").remove(),e=n.testMode?'<label class="fera-toggle-switch"><input type="checkbox" checked id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>':'<label class="fera-toggle-switch"><input type="checkbox" id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>';var t='<div><div class="fera-button-wrapper" id="feraAdminButton"><input class="fera-hidden-trigger" id="feraAdminPanelToggle" type="checkbox"><div class="fera-circle"><label class="fera-circle-label" for="feraAdminPanelToggle"><img src="'+n.api.baseCdnPath+'/img/branding/logo_icon.png" alt="Fera A.I. Admin Icon" /><div class="fera-button-label">Admin</div></label></div></div></div>',i='<div id="feraAdminPanelContainer"><div id="feraAdminPanel" class="fera-admin-panel"><div class="fera-admin-panel-header"><div class=fera-admin-panel-header-side></div><div class="fera-admin-panel-header-inner">Fera Admin Panel</div><div class="fera-admin-panel-header-side"><a href="#" id="feraAdminPanel--hide">Hide</a></div></div><div class="fera-admin-note"><strong>NOTE:</strong> Your customers will <b>not</b> see this panel or any admin buttons.</div><div class="fera-admin-option" id="feraToggleTestModeSection"><div>Test Mode<span class="fera-admin-panel-help" id="feraAdminPanel--testModeHelp">(?)</span> :</div>'+e+'</div><div class="fera-admin-option" id="feraNumContainersSection"><div>Fera Containers:<span class="fera-admin-panel-help" id="feraAdminPanel--numContainersHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--numContainersValue">n/a</span></div><div class="fera-admin-option" id="feraTimeOnCurrentPageSection"><div>Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--timeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraInactiveTimeOnCurrentPageSection"><div>Inactive Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--inactiveTimeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--inactiveTimeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraSessionTimeSection"><div>Time On Site<span class="fera-admin-panel-help" id="feraAdminPanel--sessionTimeHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--sessionTimeValue">n/a</span></div><div class="fera-admin-option" id="feraTimeSinceFirstSeenSection"><div>Time Since First Seen<span class="fera-admin-panel-help" id="feraAdminPanel--timeSinceFirstSeenHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeSinceFirstSeenValue">n/a</span></div><div class="fera-admin-option" id="feraResetUserTimersSection"><div>Reset Time<span class="fera-admin-panel-help" id="feraAdminPanel--resetUserTimersHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--resetUserTimers">Reset</div></div><div class="fera-admin-option" id="feraResetTimersSection"><div>Reset Cart Timers<span class="fera-admin-panel-help" id="feraAdminPanel--resetHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--reset">Reset</div></div><div class="fera-admin-option" id="feraClearShownHistorySection"><div>Reset Social Proof Events<span class="fera-admin-panel-help" id="feraAdminPanel--clearShownHistoryHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--clearShownHistory">Reset</div></div><div class="fera-admin-return"><a href="#" id="feraAdminPanel--goBackToAdmin">Go To Admin</a> <a href="#" id="feraAdminPanel--turnOff">Disable Admin Mode</a></div></div><style>'+F()+"</style>"+t+"</div>";o("body").append(i),a.$panel=o("#feraAdminPanel"),a.$panel.hide(),a.$toggleBtn=o("#feraAdminButton"),n.adminMode||a.$toggleBtn.hide()},F=function(){return'@keyframes radial-pulse{0%{box-shadow:0 0 0 0 rgba(0,0,0,.5)}to{box-shadow:0 0 0 30px transparent}}.fera-circle img,fera-button{-webkit-user-select:none;-ms-user-select:none}.fera-admin-panel{color:#1c1c1c;width:40%;min-width:450px;border-radius:0;position:fixed;z-index:999;font-size:12px;font-family:Helvetica,Arial,sans-serif!important}.fera-admin-panel-header-inner{margin:auto;font-size:18px;text-align:center;padding:5px 10px}.fera-admin-panel-header-side{top:0;bottom:0;padding:10px;font-weight:300;flex-shrink:0}.fera-admin-panel a{font-size:14px}.fera-admin-panel-logo{vertical-align:middle;width:18px;height:38px}.fera-admin-option{height:28px!important;margin:auto auto 12px;display:flex;flex-wrap:no-wrap;justify-content:space-between;font-size:14px;text-align:center}.fera-admin-option-value{flex-wrap:nowrap;font-weight:200;padding:2px 4px;margin-left:7px;border-bottom: 1px solid #c3c3c3;color:#404040;}.fera-admin-return{display:table;padding-top: 12px;width: 100%;}.fera-admin-return > a { display: table-cell !important;} .fera-admin-return > a:last-child {text-align: right !important;}.fera-admin-note{text-align:center;font-style:italic;font-weight:400;padding:10px; border: 1px solid #efefef;}@media (max-width:401px){.fera-admin-panel{display:none!important}}.fera-admin-panel-help{flex-wrap:nowrap;vertical-align:super;font-size:8px;margin-left:2px;text-decoration:none;cursor:pointer}.fera-admin-panel-help:hover{opacity:.7}.fera-toggle-switch{position:relative;display:inline-block;width:60px;height:28px}.fera-slider,.fera-slider:before{position:absolute;background-color:#fff;-webkit-transition:.4s;-ms-transition:.4s;transition:.4s}.fera-toggle-switch input{display:none}.fera-slider{cursor:pointer;top:0;right:0;box-shadow:0 1px 3px #969696 inset;left:0;bottom:0}.fera-slider:before{box-shadow:0 1px 3px #969696;content:"";height:24px;width:24px;left:2px;bottom:2px}.fera-reset-button{cursor:pointer;display:inline-block!important}.fera-button-wrapper,.fera-circle,.fera-circle-label{height:60px;width:60px}input:checked+.fera-slider{background-color:#00e640}input:focus+.fera-slider{box-shadow:0 1px 1px #969696}input:checked+.fera-slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(32px);transform:translateX(32px)}.fera-slider.round{border-radius:34px}.fera-slider.round:before{border-radius:50%}fera-button{user-select:none;border:0;outline:0}.fera-button-wrapper{z-index:100;position:fixed;bottom:100px;left:20px;top: initial !important;}.fera-circle{position:relative;padding:0;margin:0 auto;border-radius:50%;animation:radial-pulse 1.5s 1;transition:.2s;text-align:center;background-color:rgba(33,43,54,0.9);box-shadow:0 2px 2px 0 rgba(0,0,0,.2);}.fera-circle:active{-webkit-transform:scale(.9);-ms-transform:scale (.9);transform:scale(.9);box-shadow:0 2px 15px 0 rgba(0,0,0,.3)}.fera-circle:hover{cursor:pointer;background-color:#ff492a;box-shadow:0 8px 15px 0 rgba(0,0,0,.3)}.fera-hidden-trigger:checked~.fera-circle .fera-button-label{opacity: 0;}.fera-circle img{user-select:none;position:absolute;top:50%;left:50%;margin-left: -20px;margin-top: -16px; width: 40px;transition: .5s;filter: brightness(0%) invert(100%);}.fera-hidden-trigger{display:none!important}.fera-hidden-trigger:checked~.fera-circle img { filter: none; }.fera-button-label{position:absolute;left:8px;top:22px;font-weight:700;font-size:13px}.fera-admin-panel{box-shadow:1px -1px 4px 1px rgba(0,0,0,.2);left:80px;bottom:156px;top:inherit;background-color:#fff;padding:32px 54px;max-width:550px}.fera-admin-panel-header{display:table;width:100%}.fera-admin-panel a{color:#5b5bff!important;text-transform:uppercase;text-decoration:none!important;font-weight:400!important}.fera-button-label{text-transform:uppercase;text-shadow:-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff;color:#000}.fera-hidden-trigger:checked~.fera-circle{cursor:pointer;box-shadow:1px 4px 4px 1px rgba(0,0,0,.2);background-color:#fff;-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1);transform:scaleX(-1)}.fera-admin-panel a:hover{text-decoration:underline!important}.fera-reset-button{border-radius:1px;box-shadow:0 1px 2px #969696!important;padding:3px 18px;line-height:unset!important;text-transform:uppercase;background-color:#5b5bff!important;color:#fff}.fera-admin-note{border-top:none;border-bottom:none;background-color:#f9f9e7;font-size:12px;margin-bottom:12px}.fera-admin-panel-header-side{text-align:right;margin:0;vertical-align:middle;display:table-cell;width:50px}.fera-admin-option{width:100%}.fera-admin-panel-header-side:first-child{text-align:left}.fera-admin-panel-header-inner{vertical-align:middle;font-weight:400;display:table-cell} @media(max-width: 500px){ #feraAdminPanelContainer, #feraPreviewModeIndicator { display: none; }'};l()};var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Fera.AdminPreviewStyler=function(){function t(e){_classCallCheck(this,t),this.previewer=e}return _createClass(t,[{key:"unhighlightPreviewSelectors",value:function e(){this._findElement({selector:".fera-highlightingSelector, .fera-flashingSelector",success:function t(e){e.data("highlighted",!1),e.data("flashing",!1),e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-highlightingSelector"),e.removeClass("fera-flashingSelector")}})}},{key:"unhighlightPreviewSelector",value:function i(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")&&(e.data("highlighted",!1),e.removeClass("fera-highlightingSelector")),e.data("flashing")&&(e.stop(),e.data("flashing",!1),e.removeClass("fera-flashingSelector")),e.css("outline",""),e.css("outline-offset","")}})}},{key:"highlightPreviewSelector",value:function n(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")||(e.data("highlighted",!0),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.addClass("fera-highlightingSelector"))}})}},{key:"flashPreviewSelector",value:function a(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")||e.data("flashing")||(e.data("flashing",!0),e.addClass("fera-flashingSelector"),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.css("outline-color","rgba(93, 156, 236, 0.6)").animate({"outline-color":"rgba(255, 255, 255, 0)"},1e3,"swing",function(){e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-flashingSelector"),e.data("flashing",!1)}))}})}},{key:"fetchStyle",value:function r(e,t,i){this._findElement({selector:e.replace("&gt;",">"),success:function n(e){i(e.css(t))},fail:function a(){Fera.logger.warn("Selectable element doesn't exist so initial value could not be detected by CurrentStyleDetector.",e,t),i(null)},addBack:!0})}},{key:"_findElement",value:function o(e){var t=this;if(!this.previewer.$previewContainer)return e.fail&&e.fail(),!1;var i=this.previewer.$previewContainer.find(e.selector);e.addBack&&(i=this.previewer.$previewContainer.parent().find(e.selector)),0<i.length?e.success(i):!e.retries||e.retries<6?setTimeout(function(){return t._findElement(_extends({},e,{retries:(e.retries||0)+1}))},200):e.fail&&e.fail()}}]),t}();var Enlightenment=function(e){var d=this,t='<div class="enlightenment" style="display: none; z-index: 9999999; position: relative; opacity: 0.7;"></div>',i='<div class="enlightenment-side" style="transition: left .1s ease-in; -webkit-transition: left .1s ease-in; transition: top .1s ease-in; -webkit-transition: top .1s ease-in;position: absolute; display: block; width: 100%; height: 100%; background-color: black;" ></div>',n='<svg class="enlightenment-corner" style="position: absolute; width: 100%; height: 100%;" width="1" height="1" viewBox="0 0 1 1" fill="none" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0C0 0 0.00625002 0.4 0.3 0.7C0.59375 1 1 1 1 1H0V0Z" fill="black"/></svg>',a='<svg class="enlightenment-corner" style="position: absolute; width: 100%; height: 100%;" width="1" height="1" viewBox="0 0 1 1" fill="none" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 1C0 1 0.00625002 0.6 0.3 0.3C0.59375 -1.49012e-08 1 -1.49012e-08 1 -1.49012e-08H0V1Z" fill="black"/></svg>',r=["bottomLeft","bottomRight","topLeft","topRight"],o=["left","right","top","bottom"].concat(r),s=function(){d.opts=$.extend({},Enlightenment.DEFAULT_OPTIONS,e||{}),d.throttledReposition=T(d.reposition,d.opts.repositionThrottle,!0),f(),g(),p()};this.configure=function(e){return d.opts=$.extend(d.opts,e||{}),d},this.isVisible=function(e){return e?m(e):d.visible},this.then=function(e){return d.showOpts.onHidden=e,d},this.show=function(e,t,i){if(!(e=e||d.opts.$el))throw"Element must be provided in first param or constructor params.";return e.get||(e=$(e)),d.visible||(u(e)?console.log("not showing because is enlightenment el itself"):m(e)?console.log("Already being shown on this element."):c(e)?(L(),y(),b(),d.$el&&d.built&&d.visible&&d.hide(),l(t,i),d.$el=e,d.reposition(!0),h(),d.showOpts["for"]&&setTimeout(function(){d.hide()},d.showOpts["for"])):console.log("Element we want to show a lightbox around isn't even visible")),d},this.hide=function(e){return d.built&&d.visible&&(d.showOpts.onHide&&d.showOpts.onHide(d),d.$el.trigger("enlightenment.hide"),e="function"==typeof e?e:d.showOpts.onHidden,d.opts.hideAnimation?(d.$el.addClass("unlightening"),d.$container.fadeOut(d.opts.hideAnimationSpeed,function(){x(),d.$el.removeClass("unlightening"),e&&e(d),d.$el.trigger("enlightenment.hidden")})):(
d.$container.hide(),e&&e(d),d.$el.trigger("enlightenment.hidden"),x()),d.$el.removeClass("englightened"),d.visible=!1),d},this.reposition=function(e){if((e||d.visible)&&d.built&&d.$el&&d.attached){var t=d.$el;if(t.height()<=0)if(t.children().height())t=t.children();else if(t.children().children().height())t=t.children().children();else{if(!t.children().children().children().height())return;t=t.children().children().children()}d.left=t.offset().left,d.top=t.offset().top,d.height=F(t),d.width=H(t),d.bottom=d.top+d.height,d.right=d.left+d.width;var i=A(),n=i.height,a=i.width;return P("bottomLeft","bottom-left",t),P("bottomRight","bottom-right",t),P("topLeft","top-left",t),P("topRight","top-right",t),d.$pads.left.css({left:0,top:0,width:d.left,height:n}),d.$pads.right.css({left:d.right,top:0,width:a-d.width-d.left,height:n}),d.$pads.top.css({left:d.left,top:0,width:d.width,height:d.top}),d.$pads.bottom.css({left:d.left,top:d.bottom,width:d.width,height:n-d.height-d.top}),d}};var l=function(e,t){d.showOpts="function"==typeof e?{onShown:e}:"number"==typeof e?{"for":e}:"object"==typeof e?e:{},t&&(d.showOpts.onHidden=t)},h=function(){d.$el.trigger("enlightenment.show"),d.opts.showAnimation?(d.$el.addClass("enlightening"),d.$container.fadeIn(d.opts.showAnimationSpeed,function(){d.$el.removeClass("enlightening"),d.showOpts.onShown&&d.showOpts.onShown(d),d.$el.trigger("enlightenment.shown")})):(d.$container.hide(),d.showOpts.onShown(d),d.$el.trigger("enlightenment.shown")),d.visible=!0,d.$el.addClass("englightened"),d.lastShownAt=(new Date).getTime()},c=function(e){var t=e.get?e:$(e);if((Object&&Object.getPrototypeOf?Object.getPrototypeOf(t).jquery:$&&$.zepto)&&!t.is(":visible"))return!1;if("none"==t.css("display")||"hidden"==t.css("visibility")||0==t.css("opacity"))return!1;if(0===t.height()&&0===t.children().height()&&0===t.children().children().height())return!1;for(var i=t.parent();0<i.length&&-1===["BODY","HTML"].indexOf(i.prop("tagName"));){if("hidden"==i.css("visibility")||0==i.css("opacity"))return!1;i=i.parent()}return!0},p=function(){$(document).on("mousedown","*",function(e){e.currentTarget==e.target&&d.visible&&(!d.opts.hideOnInsideClick&&m(e.target)||!d.opts.hideOnOutsideClick&&u(e.target)||w()||(d.lastHiddenAt=(new Date).getTime(),d.hide()))})},f=function(){$(window).on("resize",function(){d.built&&d.visible&&d.throttledReposition()})},g=function(){setInterval(function(){d.built&&d.visible&&(d.throttledReposition(),c(d.$el)||d.hide())},d.opts.repositionThrottle)},u=function(e){var t=e.get?e:$(e);return t.hasClass("lightbox")||0<t.parents(".lightbox").length},m=function(e){if(!d.built)return!1;if(d.visible||v()){if(e==d.$el.get(0))return!0;var t=e.get?e:$(e);return t.hasClass("englightened")||0<t.parents(".englightened").length}},v=function(){return!!d.lastHiddenAt&&(new Date).getTime()<d.lastHiddenAt+d.opts.hideAnimationSpeed},w=function(){return!!d.lastShownAt&&(new Date).getTime()<d.lastShownAt+d.opts.showAnimationSpeed},b=function(){d.$pads.bottomLeft.children("path").attr("fill",d.opts.color),d.$pads.bottomRight.children("path").attr("fill",d.opts.color),d.$pads.topLeft.children("path").attr("fill",d.opts.color),d.$pads.topRight.children("path").attr("fill",d.opts.color),d.$pads.left.css("background-color",d.opts.color),d.$pads.right.css("background-color",d.opts.color),d.$pads.top.css("background-color",d.opts.color),d.$pads.bottom.css("background-color",d.opts.color)},x=function(){return d.attached&&d.$container&&(d.$container.remove(),d.attached=!1),this},y=function(){return d.attached||($("body").prepend(d.$container),d.attached=!0),this},P=function(e,t,i){var n=C(t,i);3<n.width/n.height||3<n.height/n.width?S(e):_(e),d.$pads[e].css(n),d.$pads[e].css(k(e))},k=function(e){if("bottomLeft"==e)return{top:d.bottom-d.$pads[e].height(),left:d.left};if("bottomRight"==e)return{top:d.bottom-d.$pads.bottomRight.height(),left:d.right-d.$pads.bottomRight.width()};if("topLeft"==e)return{top:d.top,left:d.left};if("topRight"==e)return{top:d.top,left:d.right-d.$pads.topRight.width()};throw"Invalid corner requested to calculate the offset of"},C=function(e,t){var i=t.css("border-"+e+"-radius");if(!i)return{width:0,height:0};var n=i.match(/^\d*(\.\d+)?(.*)$/),a=n[n.length-1],r=i.replace(a,"");if(!a&&!i)return{width:0,height:0};var o={};if("px"===a)o.width=o.height=parseInt(r);else if("rem"===a||"em"===a){var s=parseFloat(r);o.width=o.height=s&&.0625<=s?Math.ceil(s/.0625):0}else if("%"===a){var l=parseFloat(r)/100;o.width=l*d.width,o.height=l*d.height}else o.width=o.height=0;return o},_=function(e){var t="M0 0C0 0 0.00625002 0.4 0.3 0.7C0.59375 1 1 1 1 1H0V0Z";"bottomRight"!=e&&"topLeft"!=e||(t="M0 1C0 1 0.00625002 0.6 0.3 0.3C0.59375 -1.49012e-08 1 -1.49012e-08 1 -1.49012e-08H0V1Z"),d.$pads[e].attr("width","1").attr("height","1").get(0).setAttribute("viewBox","0 0 1 1"),d.$pads[e].children("path").attr("d",t),d.$pads[e].addClass("lightbox-corner--narrow").removeClass("lightbox-corner--wide")},S=function(e){var t="M0 0C0 0 0.412502 4 19.8 7C39.1875 10 66 10 66 10H0V0Z";"bottomRight"!=e&&"topLeft"!=e||(t="M0 10C0 10 0.412502 6 19.8 3C39.1875 0 66 0 66 0H0V10Z"),d.$pads[e].attr("width","66").attr("height","10").get(0).setAttribute("viewBox","0 0 66 10"),d.$pads[e].children("path").attr("d",t),d.$pads[e].addClass("lightbox-corner--wide").removeClass("lightbox-corner--narrow")},A=function(){var e=document.body,t=document.documentElement;return{height:Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight),width:Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)}},T=function(n,a,r){var o,s;return function(){var e=this,t=arguments,i=(new Date).getTime();if(!s||s+a<i)return s=(new Date).getTime(),n.apply(e,t);r&&(o=o||setTimeout(function(){o=null,s=(new Date).getTime(),n.apply(e,t)},a-(i-s)))}},F=function(e){var t,i=0,n=0,a=e.get(0);if(navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 9.")){var r=a.offsetHeight,o=getComputedStyle(a);return r+parseFloat(o.marginTop)+parseFloat(o.marginBottom)}return t=document.defaultView.getComputedStyle(a,""),"undefined"!=typeof a.offsetHeight?i=a.getBoundingClientRect().height:("number"!=typeof(i=(t=document.defaultView.getComputedStyle(a,"")).getPropertyValue("height"))&&(i=0),n=parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))),"border-box"!=t.getPropertyValue("box-sizing")&&(i+=O(t,"left")+O(t,"right")),parseFloat(i)+parseFloat(n)},O=function(e,t){var i=e.getPropertyValue("border-"+t+"-width");if(!i)return 0;var n=i.match(/^\d*(\.\d+)?(.*)$/),a=n[n.length-1],r=i.replace(a,"");if("px"===a)return parseFloat(r);if("rem"!==a&&"em"!==a)return 0;var o=parseFloat(r);return o&&.0625<=o?Math.ceil(o/.0625):0},H=function(e){var t,i=0,n=0,a=e.get(0);if(navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 9.")){var r=a.offsetWidth,o=getComputedStyle(a);return r+parseFloat(o.marginLeft)+parseFloat(o.marginRight)}return t=document.defaultView.getComputedStyle(a,""),"undefined"!=typeof a.offsetWidth?i=a.getBoundingClientRect().width:("number"!=typeof(i=(t=document.defaultView.getComputedStyle(a,"")).getPropertyValue("height"))&&(i=0),n=parseFloat(t.getPropertyValue("margin-left"))+parseFloat(t.getPropertyValue("margin-right"))),"border-box"!=t.getPropertyValue("box-sizing")&&(i+=O(t,"top")+O(t,"bottom")),parseFloat(i)+parseFloat(n)},L=function(){if(!d.built){d.$pads={},d.$pads.bottomLeft=$(n).addClass("lightbox-pad-bottomLeft"),d.$pads.topRight=$(n).css("transform","rotate(180deg)").addClass("lightbox-pad-topRight"),d.$pads.topLeft=$(a).addClass("lightbox-pad-topLeft"),d.$pads.bottomRight=$(a).css("transform","rotate(180deg)").addClass("lightbox-pad-bottomRight"),d.$pads.left=$(i).addClass("lightbox-pad-left"),d.$pads.right=$(i).addClass("lightbox-pad-right"),d.$pads.top=$(i).addClass("lightbox-pad-top"),d.$pads.bottom=$(i).addClass("lightbox-pad-bottom"),d.$container=$(t),d.opts.zIndex&&d.$container.css("z-index",d.opts.zIndex);for(var e=0;e<o.length;e++)d.$container.append(d.$pads[o[e]]);d.built=!0}};s()};Enlightenment.DEFAULT_OPTIONS={padding:0,hideOnInsideClick:!0,hideOnOutsideClick:!0,hideAnimation:!0,showAnimation:!0,color:"black",repositionThrottle:100,hideAnimationSpeed:200,showAnimationSpeed:200};_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Fera.AdminPreviewer=function(){function a(e,t){var i=this,n=arguments.length<=1||t===undefined||t;_classCallCheck(this,a),this.containers=e.containers,this.optionsParser=e.optionsParser,this.app=e.app,this.$=Fera.Util.$(),this.$previewContainer=this.$(),this._initCss(),n&&this._ensureCartPreviewWorksHasProducts()||(this.styler=new Fera.AdminPreviewStyler(this),this.sandboxMessenger=new Fera.AdminSandboxMessenger({parentDomain:e.api.baseAppPath,previewer:this,styler:this.styler,configured:n,app:e.app,optionsParser:e.optionsParser}),this._assumeSectionBasedOnProductId(),this.app.getSection()?this.markReady():this.app.api.getSection(function(e){i.app.setSection(e),i.markReady()}))}return _createClass(a,[{key:"markReady",value:function t(){var e=this;this.sandboxMessenger.ready(),"complete"===document.readyState?this.sandboxMessenger.send("document.ready",{}):this.$(document).on("ready",function(){e.sandboxMessenger.send("document.ready",{})}),this.$(window).on("beforeunload",function(){e.sandboxMessenger.send("window.unload",{})}),this.active=!0}},{key:"selectLocation",value:function n(e,t){if(unlighten(),this.elementSelector)this.elementSelector.resume(e,t);else{var i=this.$.extend({elementHeight:(this._testHeight()||30)+"px",closeAfter:!1,completedCallback:t},e||{});this.elementSelector=new Fera.AdminElementSelector(i)}}},{key:"pauseSelectLocation",value:function e(){this.elementSelector&&this.elementSelector.pause()}},{key:"getContent",value:function i(e){this.sandboxMessenger.getContent(e)}},{key:"getState",value:function r(e){this.sandboxMessenger.getState(e)}},{key:"updatePreview",value:function o(e,i){var n=this,a=this.lastPreviewUpdate;this.lastPreviewUpdate=_extends({},a||{},e,{isPreview:!0,cacheable:!1}),this.lastPreviewUpdate.store&&(this.app.storeSettings=this.lastPreviewUpdate.store),this._shouldNotRenderInThisSection()?this.setState("notVisibleInCurrentSection"):this.containers&&this.containers.globalBottom&&this.containers.globalBottom.abstractBlocks?(this.setState("checking"),this.app.refreshContent(function(){var e=n.containers.globalBottom.abstractBlocks,t=e[Object.keys(e)[0]];t?(n.$previewContainer=t.$el,n.$previewContainer&&0!==n.$previewContainer.length?(n._debouncedHighlightPreview(n.$previewContainer,{scroll:n._shouldScroll(a,i)}),n.setState("success")):n._retryPreviewUpdate(i,"missingSelector")):n._retryPreviewUpdate(i,"missingContainer")})):this._retryPreviewUpdate(i,"missingContainer")}},{key:"_shouldNotRenderInThisSection",value:function s(){if(this.lastPreviewUpdate.settings.store_sections&&this.lastPreviewUpdate.settings.store_sections!=[]&&this.lastPreviewUpdate.settings.store_sections!=["any"]&&0<this.lastPreviewUpdate.settings.store_sections.length&&-1===this.lastPreviewUpdate.settings.store_sections.indexOf(this.app.getSection()))return!0}},{key:"_shouldScroll",value:function l(e,t){var i=((this.lastPreviewUpdate||{}).settings||{}).integration_selector,n=((e||{}).settings||{}).integration_selector,a=((this.lastPreviewUpdate||{}).settings||{}).integration_selector_action,r=((e||{}).settings||{}).integration_selector_action;return(n!==i||r!==a||!!t||!1!==this._allowHighlights)&&".banana-globalBottom-container"!==i}},{key:"_retryPreviewUpdate",value:function d(e,t){var i=this;(e||0)<5?(this.containers.locateNewContainers(),this.setState("checking"),setTimeout(function(){return i.updatePreview({},(e||0)+1)},500)):this.setState(t)}},{key:"findBestLocation",value:function h(e){var t=new Fera.IntegrationLocator(this.app).findBestLocation(e);this.sandboxMessenger.send("previewer.findBestLocation.result",t)}},{key:"findBestPresetLocations",value:function c(e){var t={};for(var i in e){var n=!0,a=!1,r=undefined;try{for(var o,s=e[i][Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,d=this.$(l.selector);if(l.multi&&0<d.length||1==d.length){t[i]=l;break}}}catch(h){a=!0,r=h}finally{try{!n&&s["return"]&&s["return"]()}finally{if(a)throw r}}}this.sandboxMessenger.send("previewer.findBestPresetLocations.result",t)}},{key:"setState",value:function p(e){if(this.state!=e){this._oldState=this.state,this.state=e;var t={lastPreviewUpdate:this.lastPreviewUpdate,newState:this.state,oldState:this._oldState};this.sandboxMessenger.send("previewer.state.change",t)}}},{key:"stopPreview",value:function f(){var e=window.location.toString();e=Fera.Util.updateURLParameter(e,"fera_preview",null),e=Fera.Util.updateURLParameter(e,"fera_test",null),e=Fera.Util.updateURLParameter(e,"fera_admin",null),e=Fera.Util.updateURLParameter(e,"test_mode",null),e=Fera.Util.updateURLParameter(e,"admin_mode",null),e=Fera.Util.updateURLParameter(e,"preview",null),e=Fera.Util.updateURLParameter(e,"fera",null),e=Fera.Util.updateURLParameter(e,"fera_sandbox",null),this.app.cookieJar.setCookie("Fera.SandboxTest.Enabled",!1,-1),this.sandboxMessenger.send("previewer.cancel"),window.location=e}},{key:"_assumeSectionBasedOnProductId",value:function g(){var t=this;this.app.on("ready",function(){t.app.on("product.set",function(){var e=t.app.getSection();e&&"other"!==e&&"home"!==e||(t.app.setSection("product_view"),t.updatePreview())});var e=t.app.getSection();!t.app.getProductId()||e&&"other"!==e&&"home"!==e||t.app.setSection("product_view")})}},{key:"_genBestLocationParams",value:function u(e,t){var i=this,n=["display","width","position","transform","background-color","font-size","border","text-align","margin","padding"];return{found:!0,location:e,target:{css:t.css(n)},parent:{css:t.parent().css(n)},siblings:t.siblings().map(function(e,t){return{css:i.$(t).css(n)}}).toArray(),prev:t.prev().css(n),next:t.next().css(n)}}},{key:"_removeMerchantMaskClasses",value:function m(){var t=this;["async-hide"].forEach(function(e){return t.$previewContainer.parents("."+e).removeClass("."+e)})}},{key:"highlight",value:function v(){var e=this._lastHighlighted$el||this.$previewContainer;return!!e&&(!(e.length<1)&&void this._highlightPreview(e,{scroll:!0,force:!0}))}},{key:"_initCss",value:function w(){this.$previewerCss=this.$('<style id="feraAdminPreviewerCss">'+this._previewerCss()+"</style>"),this.$("body").append(this.$previewerCss)}},{key:"_resetHighlight",value:function b(e){this._allowHighlights=!0,e.data("fera-highlighted-container",!1)}},{key:"_debouncedHighlightPreview",value:function x(e,t){var i=this,n=arguments.length<=1||t===undefined?{}:t;this._debouncedHightlightScroll=this._debouncedHightlightScroll||n.scroll,this._debouncedHighlightPreviewMethod||(this._debouncedHighlightPreviewMethod=Fera.Util.debounce(function(e,t){return i._highlightPreview(e,t)},500)),this._debouncedHighlightPreviewMethod(e,n)}},{key:"_highlightPreview",value:function y(e,t){var i=this,n=arguments.length<=1||t===undefined?{}:t;(n=n||{}).scroll=n.scroll||this._debouncedHightlightScroll,this._debouncedHightlightScroll=null;var a=e.parents(".fera-container,.banana-container");if(e=0<a.length?a.first():e.first(),this._removeMerchantMaskClasses(),n.force&&this._resetHighlight(e),n.scroll)return Fera.Util.scrollToElement(e,{duration:200,callback:function r(){return i._highlightPreview(e,{scroll:!1})}});!1!==this._allowHighlights&&(this._lastHighlighted$el=e,this._showLightBox(e),setTimeout(function(){i._allowHighlights=!1},300))}},{key:"_showLightBox",value:function P(e){e.data("fera-highlighted-container")||(enlighten(e,2e3),e.data("fera-highlighted-container",!0))}},{key:"_scrollToPreview",value:function k(e){if(".banana-globalBottom-container"!==e){var t=this.$(e);t.length<1||this._highlightPreview(t)}}},{key:"_testHeight",value:function C(){if(this.elementHeight||!this.lastPreviewUpdate)return this.elementHeight;var e=this.$(this.lastPreviewUpdate.html.replace(/<!--[\s\S]*?-->/g,"").trim());return e.css("visibility","hidden"),this.$("body").append(e),this.elementHeight=e.height(),e.remove(),this.elementHeight}},{key:"_ensureCartPreviewWorksHasProducts",value:function _(){if(window.performance&&window.performance.navigation.type==window.performance.navigation.TYPE_BACK_FORWARD)return!1;if(this.optionsParser.sandboxMode&&this.optionsParser.sandboxError)return!1;if(!this.optionsParser.hasUrlFlag("ensure_loaded_cart"))return this._goToCheckoutOnFlag();var e=this.optionsParser.urlParams.sample_variant_id,t=this.optionsParser.urlParams.sample_product_id;return t?(e?this._addProductToCartIfEmpty(t,{variant_id:e}):this._addProductToCartIfEmpty(t,{}),!0):(Fera.logger.error("Expected sample product in the params but didn't get one so couldn't ensure that the cart was loaded. Please contact the fera.ai support team if you see this message.",this.optionsParser.urlParams),!1)}},{key:"_addProductToCartIfEmpty",value:function S(e,t){this.app.cart.addProductIfEmpty(e,t,{afterAdd:function i(){var e=window.location.toString();setTimeout(function(){window.location=Fera.Util.updateURLParameter(e,"ensure_loaded_cart","0")},1e3)}})}},{key:"openCartDrawer",value:function $(){var t=this;"cart"!==this.app.getSection()&&setTimeout(function(){var e=t.$("[data-drawer-id='sidebar-cart']:not([data-action='close-drawer']), [aria-controls='CartDrawer'], .ajax-cart__toggle, .js-drawer-open-cart")[0];e&&e.click()},1e3)}},{key:"_previewerCss",value:function A(){return"@keyframes feraHighlightPulse-light {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    80% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    100% { box-shadow: none; }}@keyframes feraHighlightPulse {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    80% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    100% { box-shadow: none; }}body.fera-highlight-container-body .card--reveal {    transform: none !important;    -webkit-transform: none !important;    -ms-transform: none !important;    transition: none !important;}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;    animation-duration: 2s;    animation-iteration-count: 1;    animation-timing-function: linear;}.fera-highlight-container--dark {    animation-name: feraHighlightPulse;}a.fera-highlight-container-container {    overflow: visible;    z-index: 2;}body.fera-highlight-container-body > div {    overflow: visible;}body.fera-highlight-container-body #shopify-section-header,body.fera-highlight-container-body > header {    z-index: 0 !important;}body.fera-highlight-container-body .site-header--sticky {    position: static;}body.fera-highlight-container-body > main {    z-index: 0 !important;}"}},{key:"_goToCheckoutOnFlag",value:function T(){var e=this;return!!this.optionsParser.hasUrlFlag("go_to_checkout")&&(this.$(window).on("load",function(){e.app.cart.startCheckout()}),!0)}}]),a}();_createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Fera.AdminSandboxMessenger=function(){function i(e){var t=this;_classCallCheck(this,i),this.parentDomain=e.parentDomain,this.previewer=e.previewer,this.styler=e.styler,this.configured=e.configured,this.optionsParser=e.optionsParser,this.parentWindow=e.app.parentWindow,e.app.on("widget.create:after",function(){t.send("widget.create:after",{})}),this._getContentCallbacks=[],this._getStateCallbacks=[]}return _createClass(i,[{key:"ready",value:function n(){if(this.parentWindow){var e=window.feraAdminSandboxStatus||200,t=window.feraAdminSandboxMessage;t=t?decodeURIComponent(t):null,this.configured?(this._initIframeListener(),this._bindFocusListener(),this._readyForParent({status:e,message:t})):parseInt(e)<400?this._readyForParent({status:500,message:"bad_config"}):this._readyForParent({status:e,message:t})}}},{key:"getContent",value:function t(e){this._getContentCallbacks.push(e),this.send("getContent")}},{key:"getState",value:function a(e){this._getStateCallbacks.push(e),this.send("getState")}},{key:"setContent",value:function r(e){for(;0<this._getContentCallbacks.length;){this._getContentCallbacks.shift()(e)}}},{key:"setState",value:function o(e){for(;0<this._getStateCallbacks.length;){this._getStateCallbacks.shift()(e)}}},{key:"_initIframeListener",value:function e(){var i=this;window.addEventListener("message",function(e){if(!e.origin||e.origin.match(/(127\.0\.0\.1|localhost)(:[0-9]+)?/i)||e.origin===i.parentDomain){var t=JSON.parse(e.data);i.send("gotMessage",{id:t.id}),i._trigger(t)}})}},{key:"_bindFocusListener",value:function s(){var e=this;window.addEventListener("focus",function(){e.send("focused")},!0)}},{key:"_readyForParent",value:function l(e){var t=arguments.length<=0||e===undefined?{}:e;this.send("ready",Fera.Util.$().extend({},{href:window.location.href,referrer:document.referrer,status:200},t||{}))}},{key:"send",value:function d(e,t){!this.parentWindow||this.parentWindow.length<0||this.parentWindow.postMessage(JSON.stringify({methodName:e,params:t}),this.parentDomain)}},{key:"_trigger",value:function h(t){var i=this;"selectLocation"===t.methodName&&this.previewer.selectLocation(t.params,function(e){window.stop(),i.send("window.stop",{}),i.send("locationSelected",e)}),"pauseSelectLocation"===t.methodName?this.previewer.pauseSelectLocation(t.params):"updatePreview"===t.methodName?this.previewer.updatePreview(t.params):"fetchStyle"===t.methodName?this.styler.fetchStyle(t.params.selector,t.params.attribute,function(e){i.send("styleFetched",{callbackId:t.params.callbackId,value:e})}):"unhighlightPreviewSelectors"===t.methodName?this.styler.unhighlightPreviewSelectors():"unhighlightPreviewSelector"===t.methodName?this.styler.unhighlightPreviewSelector(t.params):"highlightPreviewSelector"===t.methodName?this.styler.highlightPreviewSelector(t.params):"flashPreviewSelector"===t.methodName?this.styler.flashPreviewSelector(t.params):"highlight"===t.methodName?this.previewer.highlight(t.params):"findBestLocation"===t.methodName?this.previewer.findBestLocation(t.params):"findBestPresetLocations"===t.methodName?this.previewer.findBestPresetLocations(t.params):"openCartDrawer"===t.methodName?this.previewer.openCartDrawer():"window.stop"===t.methodName?this.send("window.stop",{}):"extendSandboxCookie"===t.methodName?this.optionsParser.extendSandboxCookie():"function"==typeof this[t.methodName]&&this[t.methodName](t.params)}}]),i}();