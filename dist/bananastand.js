function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Fera=Fera||{},BananaStand=BananaStand||Fera;Fera.App=function(opts){this.version="2.2.1.3";var self=this,containers,config,api,currProductId,customerId,visitorId,platformAdapter,section,contentUpdatesStarted=!1,isViewingProductPage=!1,pushedViewEvent=!1,showedDevGreeting=!1,pushMethodReady=!1,currProduct,compiledCss="",variantId;opts=opts||{};var updateRequestInProgress=!1,eventListeners={"timers.reset":[],"feeds.reset":[],"cart.emptied":[],"cart.changed":[],"variant.change":[],"product.change":[],"skill.create":[],"skill.create:before":[],"skill.create:after":[],"skill.update":[],"notification.show":[],init:[]},init=function(){(opts.app=self).parentWindow=opts.parentWindow,messageStatusToParent("fera_starting"),self.cookieJar=opts.cookieJar=new Fera.CookieJar,self.localStorage=opts.localStorage=new Fera.LocalStorageJar(opts),self.opts=opts.optionsParser=new Fera.OptionsParser(opts),parseModes(),self.logger=Fera.logger=opts.logger=new Fera.Logger(opts),self.timeTracker=opts.timeTracker=new Fera.TimeTracker(opts),opts.containersDirtyScheduler=new Fera.ContainersUpdateScheduler(opts),self.engagementTracker=opts.engagementTracker=new Fera.EngagementRegistry(opts),opts.optionsParser.hasUrlFlag("clear_cache")&&self.clearCache(),Fera.Util.ie()&&opts.logger.warn("Fera.ai is not optimized for Microsoft Internet Explorer. You should really update to a more modern browser!"),opts.logger.log("~~ Loaded app.js version "+self.version+" ~~"),waitFor$(function e(){self.geo=opts.geo=new Fera.Geo(opts),self.inactivityDetector=opts.inactivityDetector=new Fera.InactivityDetector({logger:opts.logger}),self.geo.getLocationInfo(function n(e){opts.shopperLocation=e,delete opts.shopperLocation.ip,loadSupportModules(),self.api=opts.api=api=new Fera.Api(opts),loadPushBuffer({only:"configure"}),ensureVisitorId(),opts.visitorId=visitorId,ensureBodyContainersPresent(),loadPushBuffer({only:"loadPlatformAdapter"}),abortLoading()?loadAdmin(!1):(self.cart=new Fera.Cart(opts),platformAdapter&&platformAdapter.cartAdapter&&self.cart.setAdapter(platformAdapter.cartAdapter),self.api.checkConfig()?(self.verifier=new Fera.Verifier(opts),loadContainers(),loadPushBuffer({except:["loadPlatformAdapter","configure"]}),api.waitForApiConfig(function t(){api.checkConfig()?(self.clickTracker=opts.clickTracker=new Fera.ClickRegistry(opts),contentUpdatesStarted||setTimeout(startServerUpdating,1),self.trigger("init"),loadAdmin(!0)):loadAdmin(!1)})):loadAdmin(!1))},!0)})},abortLoading=function(){if(window.location.pathname&&(0===window.location.pathname.indexOf("/password")&&!opts.sandboxMode||"undefined"!=typeof Shopify&&Shopify.Checkout&&Shopify.Checkout.isOrderStatusPage))return Fera.logger.log("Intentionally aborted loading, likely due to a missing API key on the page."),self.aborted=!0;return self.opts.sandboxMode&&self.opts.sandboxError},loadAdmin=function(e){if(opts.adminMode){if((e=void 0===e||e)||opts.api.configure({api_url:decodeURIComponent(opts.cookieJar.getCookie("Fera.Admin.BaseAppUrl")),store_pk:opts.cookieJar.getCookie("Fera.Admin.Store.PublicKey")}),"undefined"!=typeof Fera.AdminPanel)return setupAdmin(e);var t="";-1!==opts.api.baseAppPath.indexOf("app.")?t+=opts.api.baseAppPath.replace("app.","cdn.")+"/js/fera.admin.js?v="+self.version:t=-1!==opts.api.baseAppPath.indexOf("ngrok.")||-1!==opts.api.baseAppPath.indexOf("localhost")||-1!==opts.api.baseAppPath.indexOf("test-")||-1!==opts.api.baseAppPath.indexOf("127.0.0.1")?opts.api.baseAppPath+"/assets/public/fera.admin.js?v="+self.version:"https://cdn.jsdelivr.net/gh/feracommerce/ferajs@"+self.version+"/dist/fera.admin.js";var n=opts.debugMode?1:900;new FeraCachedAsset({name:"Fera.Admin.Js",url:t,expiresIn:n}).load(function(){setupAdmin(e)})}},setupAdmin=function(e){try{messageStatusToParent("fera_admin_starting"),opts.app.previewer=opts.previewer=new Fera.AdminPreviewer(opts,e);var t=opts.optionsParser.parseCheckIntegration();t&&new Fera.AdminIntegrationChecker(opts).check(t)}catch(n){if(opts.debugMode)throw n}},messageStatusToParent=function(e){try{var t=opts.api&&opts.api.baseAppPath?opts.api.baseAppPath:"*";opts.parentWindow&&opts.parentWindow.postMessage(JSON.stringify({methodName:"sandbox_previewer.status.update",params:{status:e}}),t)}catch(n){}};self.push=function(e,t){if(pushMethodReady){if(opts.debugMode)return _push(e,t);try{return _push(e,t)}catch(n){window.console&&!Fera.Util.ie()&&window.console.error(n)}}else opts.pushBuffer=opts.pushBuffer||[],opts.pushBuffer.push(e),t!==undefined&&opts.pushBuffer.push(t)},self.setSection=function(e){return section=e,self},self.getSection=function(){return section},self.dispatchEvent=function(e,t,n){n=n||function(){},containers.dispatchEvent(e,t,n)},self.loadPlatformAdapter=function(code,params){var _opts=opts||{};if(_opts.params=params,_opts.addToCartCallback=self.pushAddToCartEvent,-1!==opts.supportedPlatforms.indexOf(code)){var adapterKlass=eval("Fera."+Fera.Util.capitalizeFirstLetter(code)+"Adapter");platformAdapter=new adapterKlass(_opts)}else{if("function"!=typeof code)return opts.logger.logWarning("Unknown platform code supplied: '"+code+"'. Valid codes are: "+opts.supportedPlatforms.join(",")),self.loadPlatformAdapter("custom",params);platformAdapter=code(_opts)}},self.setProduct=function(e){var t=currProduct;return"undefined"!=typeof(currProduct=e).id&&self.setProductId(currProduct.id),isViewingProductPage=!0,t&&t!=currProduct&&(self.trigger("product.change",{old:t,"new":currProduct}),self.refreshContent()),self},self.setProductId=function(e){var t=currProductId;return isViewingProductPage=!0,t!=(currProductId=e)&&(contentUpdatesStarted&&self.trigger("product.change",{old:{id:t},"new":{id:currProductId}}),self.getVariantId()&&t&&self.setVariantId(null,!1)),self},self.getProductId=function(){return currProductId},self.getProduct=function(){return currProduct},self.setVariantId=function(e){var t=variantId;return variantId=e,t&&t!==variantId&&self.trigger("variant.change",{old:{id:t},"new":{id:variantId}}),self},self.showContentSubmission=function(e){return getContentSubmitter().show(e)},self.showContentSubmitter=self.showContentSubmission,self.showContentSubmit=self.showContentSubmission,self.getVariantId=function(){return variantId},self.setCart=function(e){return self.cart.loadCartData(e),self},self.setShopper=function(e){if(1024<Fera.Util.sizeOfParams(e))opts.logger.error("Error: parameter size is larger than 1024 bytes");else{var t=getShopperAttributes();opts.cookieJar.setCookieObject(shopperAttributesKey(),Object.assign({},t,e),1)}};var getShopperAttributes=function(){return opts.cookieJar.getCookieObject(shopperAttributesKey())},shopperAttributesKey=function(){return"Fera.App.currentShopper"};self.getVisitorId=function(){return visitorId},self.getShopperId=self.getVisitorId,self.pushOrder=function(e,t){var n;"undefined"!=typeof e.data?n=e:(n={type:"order_create"},"undefined"!=typeof e.order?n.data=e:n.data={order:e}),api.pushEvent(n,t)},self.pushConversion=self.pushOrderEvent=self.pushConversionEvent=self.pushOrder,self.setCustomerId=function(e){return customerId=e,self},self.configure=function(e){config=e,api.configure(config)},self.pushAddToCartEvent=function(e){var t={type:"product_add_to_cart"};e&&(e.data?t.data=e.data:t.data=e),self.pushEvent(t)},self.addProductToCart=function(e,t){platformAdapter&&"function"==typeof platformAdapter.addProductToCart&&platformAdapter.addProductToCart(e,t)},self.triggerSkill=function(e,t){containers.triggerSkill(e,t)},self.trigger=function(e,t){e=e.split(" ");for(var n=0;n<e.length;n++){var i=e[n],r=eventListeners[i]||[];/skill.\d+.(create|update)/.test(i)&&r.concat(eventListeners[i.replace(/skill.\d+./,"skill.")||[]]);for(var a=0;a<r.length;a++)r[a](t)}},self.on=function(e,t){e=e.split(" ");for(var n=0;n<e.length;n++){var i=e[n].trim();if(eventListeners[i])eventListeners[i].push(t);else if(/skill.\d+.(create|update)/.test(i))eventListeners[i]=[t];else{var r=Object.keys(eventListeners).join(", ");self.logger.warn("Invalid event code requested: '"+i+"'. Valid event codes are: "+r)}}},self.getState=function(){var e={customer_id:customerId||"",location:opts.shopperLocation||{},interaction_time:opts.timeTracker.getTotalInteractionTime(),time_since_first_seen:opts.timeTracker.getTimeSinceFirstSeen(),session_time:opts.timeTracker.getSessionTime(),time_on_current_page:opts.timeTracker.getTimeOnCurrentPage(),inactive_time_on_current_page:opts.timeTracker.getInactiveTimeOnPage(),current_page:{url:window.location.toString(),referrer:document.referrer,title:document.title}};return section&&(e.section=section),currProductId&&(e.product_id=currProductId),currProduct&&(e.product=currProduct),variantId&&(e.variant_id=variantId),self.cart&&self.cart.hasData()&&(self.cart.validateData()?e.cart=self.cart.getData():opts.logger.warn("Invalid cart data",self.cart)),e},self.updateContainers=function(e,t,n){var i={};if(!updateRequestInProgress&&!opts.sandboxMode){t=t||function(){},void 0===e&&(e=!1);var r=$(".fera-view-container[data-product_id],.banana-view-container[data-product_id]");if(1===r.length&&r.data("product_id")&&(self.getProductId()||self.setProductId(r.data("product_id"))),i.state=self.getState(),i.push_view_event=e,i.content_requests=void 0===n?containers.getContentRequest({defaultProductId:currProductId}):n,i.content_requests.length<1&&!e)return t();i.content_requests_json=JSON.stringify(i.content_requests),delete i.content_requests,pushedViewEvent||(i.push_view_event=!0,isViewingProductPage&&(i.associated_to="product"),pushedViewEvent=!0),updateRequestInProgress=!0;var a=getShopperAttributes();a&&(i.shopper_attributes=a),loadCompiledCssFromCache(),containers.updateContentFromCache(),api.getContent(i,function(e){e&&(updateRequestInProgress=!1,self.displayDevGreeting(),updateCompiledCssFromServer(e),containers.updateContent(e,currProductId,t))},function(){setTimeout(function(){updateRequestInProgress=!1},calculateTimeoutForErrorRetry())})}},self.clearCache=function(){new Fera.LocalStorageJar({namespace:"Fera.AssetCache"}).clear(),new Fera.LocalStorageJar({namespace:"BananaStand.AssetCache"}).clear(),new Fera.LocalStorageJar({namespace:"Fera.Cache"}).clear(),waitFor$(function e(){Fera.Util.$()('script[src*="fera.js"],script[src*="bananastand.js"]').each(function(){var e=this.src.replace("https://cdn.jsdelivr.net/gh/feracommerce/ferajs@latest/dist/","https://cdn.fera.ai/js/");Fera.Util.$().ajax({method:"GET",type:"GET",url:e,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})})}),Fera.logger.log("CLEARED Fera cache.")},self.markAllContainersAsDirty=function(){containers&&(opts.containersDirtyScheduler.reset(),containers.markAllContainersAsDirty())},self.refreshContent=function(e){if(containers)return containers.markAllContainersAsDirty(),self.updateContainers(!1,e),self},self.updateAllContainers=self.refreshContent,self.clearSeenHistory=function(){containers.each(function(e){e.clearSeenHistory&&e.clearSeenHistory()})},self.getContainers=function(){return containers},self.getContainerById=function(e){return containers.getContainerById(e)},self.pushEvent=function(e,t){return e.state=self.getState(),e.visitor_id=visitorId,"add_to_cart"===e.type&&(e.type="product_add_to_cart"),e.shopper_attributes=getShopperAttributes(),"function"==typeof e.callback&&t&&"function"!=typeof t.callback&&(t.callback=e.callback,delete e.callback),"object"==typeof e.data&&"function"==typeof e.data.callback&&t&&"function"!=typeof t.callback&&(t.callback=e.data.callback,delete e.data.callback),api.pushEvent(e,t),self},self.checkIn=function(e,t){e=e||{};var n={callback:t||e.callback};api.checkIn(e,n)},self.getCurrentShopperId=function(e){return e&&"function"==typeof e.callback?e.callback(visitorId):visitorId},self.displayDevGreeting=function(){if(showedDevGreeting)return!1;if(window.console&&!Fera.Util.ie()&&(!self.opts.feraParams||!self.opts.feraParams.quiet))return(opts.debugMode?opts.logger.log:window.console.log)("\ud83d\udc4b Hello developer! We've optimized performance and encapsulated functionality to ensure our system never breaks anything. Shoot a message to dev"+String.fromCharCode(64)+"fera.ai if you've got any questions.\nLearn more about Fera @ https://fera.ai?dev=1\nHappy coding!\ud83d\udc4b"),showedDevGreeting=!0},self.getShopper=function(e){api.getShopper(visitorId,e)},self.deleteShopper=function(e){api.deleteShopper(visitorId,e)};var getContentSubmitter=function(){return self.contentSubmitter||(self.contentSubmitter=new Fera.ContentSubmission.Submitter(opts)),self.contentSubmitter},scheduleNextContainerUpdateCheck=function(e,t){try{opts.containersDirtyScheduler.markExpiredContainersAsDirty(),self.updateContainers(e,t)}catch(n){opts.logger.log(n),opts.api.requestFailCount+=1}finally{setTimeout(function(){scheduleNextContainerUpdateCheck(!1,t)},calculateTimeoutForNextContainersUpdateCheck())}},calculateTimeoutForNextContainersUpdateCheck=function(){return defaultContainersCheckForUpdatePeriod()+defaultContainersCheckForUpdatePeriod()*opts.api.requestFailCount*2},defaultContainersCheckForUpdatePeriod=function(){return 1e3},calculateTimeoutForErrorRetry=function(){return Math.round(1e3*(opts.api.requestFailCount+1)+3e3*Math.random())*opts.api.requestFailCount},_push=function(e,t){var n,i="function"==typeof(n="object"==typeof e?e:{action:e,data:t,callback:"object"==typeof t?t.callback:undefined}).callback?n.callback:function(){};if("configure"==n.action)self.configure(n.data);else if("setCustomerId"==n.action)"string"==typeof n.customer_id||"number"==typeof n.customer_id?self.setCustomerId(n.customer_id):"string"==typeof n.id||"number"==typeof n.id?self.setCustomerId(n.id):void 0!==t?self.setCustomerId(t.id||t):opts.logger.error("Invalid syntax for method call setCustomerId: ",n);else if("setProduct"==e||"setCurrentProduct"==e)self.setProduct(t);else if("showContentSubmission"==e||"showContentSubmit"==e)self.showContentSubmission(t);else if("setProductId"===n.action)"string"==typeof t||"number"==typeof t?self.setProductId(t):n?"undefined"!=typeof n.product_id?self.setProductId(n.product_id):"undefined"!=typeof n.id?self.setProductId(n.id):"undefined"!=typeof n.data?"undefined"!=typeof n.data.product_id?self.setProductId(n.data.product_id):"undefined"!=typeof n.data.id?self.setProductId(n.data.id):self.setProductId(n.data):self.setProductId(null):opts.logger.error("Invalid syntax for method call setProductId: ",n);else if("setVariantId"===n.action)"string"==typeof t||"number"==typeof t?self.setVariantId(t):n?"undefined"!=typeof n.variant_id?self.setVariantId(n.variant_id):"undefined"!=typeof n.id?self.setVariantId(n.id):"undefined"!=typeof n.data?"undefined"!=typeof n.data.variant_id?self.setVariantId(n.data.variant_id):"undefined"!=typeof n.data.id?self.setVariantId(n.data.id):self.setVariantId(n.data):self.setVariantId(null):opts.logger.error("Invalid syntax for method call setVariantId: ",n);else if("getCurrentShopperId"==n.action||"getShopperId"==n.action)self.getCurrentShopperId(n.data);else if("triggerSkill"==n.action)self.triggerSkill(t.id||t.skill_id||t.skillId,t.data||t.optionalData||t.optional_data);else if("setCart"==n.action)self.setCart(n.cart||n.data||t||("object"==typeof t?t.cart:null));else if(-1!==["pushOrder","pushOrderEvent","order","orderEvent","conversion","conversionEvent","pushConversion","pushConversionEvent"].indexOf(e))self.pushOrder(t);else if(-1!==["pushAddToCart","pushAddToCartEvent","addToCart","add_to_cart","product_add_to_cart"].indexOf(e))self.pushAddToCartEvent(t);else if("pushEvent"==n.action||"event"==n.action)self.pushEvent(t);else if("loadPlatformAdapter"==n.action)"string"==typeof e&&"string"==typeof t?self.loadPlatformAdapter(t,{}):self.loadPlatformAdapter(n.code||n.adapter,n);else if("updateContainers"==n.action)self.updateContainers(!1,i);else if("startProductPageViewing"==n.action)self.startProductPageViewing(i);else if("dispatchEvent"==n.action)self.dispatchEvent(n.code,n.data,i);else if("getShopper"==n.action)self.getShopper(i);else if("deleteShopper"==n.action)self.deleteShopper(i);else if("on"===n.action)self.on(n.data.event,n.data.callback);else if("setShopper"==n.action){n.data||n.shopper;self.setShopper(n.data||n.shopper)}else self[n.action],self[n.action](n.data)},$=function(e){return Fera.Util.$()(e)},addBodyContainers=function(){var e=$("body");0<e.find(".banana-globalBottom-container").length||e.append('<div class="banana-container banana-globalBottom-container" data-container_type="global_bottom" style="display: none;"></div>')},ensureBodyContainersPresent=function(){setInterval(addBodyContainers,1),addBodyContainers()},updateCompiledCssFromServer=function(e){if(e&&e.content_responses){var t=e.compiled_css;t&&(-1===compiledCss.indexOf(t)&&(compiledCss=(compiledCss+" "+t).trim(),updateCompiledCss(compiledCss)),saveCompiledCssToCache(compiledCss))}},saveCompiledCssToCache=function(e){self.localStorage.setItem("Cache.CompiledCss",e,36e5)},loadCompiledCssFromCache=function(){if(self.opts.testMode||self.opts.adminMode||self.opts.previewMode)return!1;var e=self.localStorage.getItem("Cache.CompiledCss","");return!!e&&(updateCompiledCss(e),!0)},updateCompiledCss=function(e){var t=$("#feraCompiledCss");t.length<1&&(t=$('<span id="feraCompiledCss"></span>'),$("body").append(t)),t.html("<style>"+e+"</style>")},startServerUpdating=function(e){opts.logger.log("Starting server update timer..."),e=e||function(){},contentUpdatesStarted?opts.logger.log("startServerUpdating was already called, so returning..."):(startCheckIns(),contentUpdatesStarted=!0,scheduleNextContainerUpdateCheck(!pushedViewEvent,e),self.on("cart.changed",function(){self.markAllContainersAsDirty()}))},startCheckIns=function(){var e=config.page_view_check_interval||3e5,t=e;setInterval(function(){(t-=1e3)<=0&&opts.inactivityDetector.isActive()&&(isViewingProductPage&&currProductId&&self.checkIn(),t=e)},1e3)},parseModes=function(){self.opts.debugMode=opts.debugMode=opts.optionsParser.parseDebugMode(),self.opts.testMode=opts.testMode=opts.optionsParser.parseTestMode(),self.opts.adminMode=opts.adminMode=opts.optionsParser.parseAdminMode(),self.opts.sandboxMode=opts.sandboxMode=opts.optionsParser.parseSandboxMode(),self.opts.showErrors=opts.showErrors=self.opts.debugMode||opts.optionsParser.parseShowErrors()},loadContainers=function(){if((containers=new Fera.ContainerCollection(opts)).updateContainers=self.updateContainers,opts.contentUpdater=containers,opts.containers=containers,!currProductId){var e=containers.findCurrentlyViewingProductId();null!=e&&(self.setProductId(e),isViewingProductPage=!0)}},waitFor$=function(e){var t=0,n=10,i=100,r=!1;if(opts.standaloneMode)Fera.Util.addZepto(opts),r=!0,i+=1e3,n=1;else if(window.jQuery||window.Zepto||window.$)return e();opts.logger.log("Waiting for jQuery or Zepto to load...");var a=setInterval(function(){if((window.jQuery||window.Zepto||window.$)&&(window.Zepto&&window.Zepto.expr&&window.Zepto.expr[":"]&&!window.Zepto.expr[":"].input&&(Zepto.expr[":"].input=function(){if("disabled"in this||"true"===this.contentEditable)return this}),clearInterval(a),e()),(t+=n)==i){if(r)throw clearInterval(a),"Fera requires jQuery or Zepto and neither or found or able to be dynamically loaded.";i+=1e3,Fera.Util.addZepto(opts),r=!0,opts.logger.log("Loading Zepto library because jQuery was not found within "+i+" milliseconds.")}},n)},loadPushBuffer=function(e){var t="undefined"!=typeof(e=e||{}).except&&e.except,n="undefined"!=typeof e.only&&e.only;if(opts.pushBuffer=opts.pushBuffer||[],pushMethodReady=!0,"object"==typeof opts.pushBuffer&&opts.pushBuffer.length&&0<opts.pushBuffer.length)for(var i=!1,r=0;r<opts.pushBuffer.length;r++)if(i)i=!1;else{var a=opts.pushBuffer[r];if(t){for(var o=!1,s=0;s<e.except.length;s++)if("string"==typeof a){if(a===e.except[s]){i=o=!0;break}}else if(a.action===e.except[s]){o=!0;break}if(o)continue}if("string"==typeof a){if(n&&a!==e.only)continue;self.push(a,opts.pushBuffer[r+1]),i=!0}else{if(n&&a.action!==e.only)continue;self.push(a)}}},ensureVisitorId=function(){var e=new Fera.VisitorManager(opts);visitorId=e.ensureVisitorId()},loadSupportModules=function(){new Fera.InstantClickSupport(opts)};self.startProductPageViewing=function(e){isViewingProductPage=!0,startServerUpdating(e)},init()},Fera.Api=function(o){var i,s=this,l=Fera.Util.$();o=o||{},s.requestFailCount=0;var r=!1,c="fera.js-"+o.app.version,t="https://app.fera.ai",e=function(){l(document).ready(function(){r=!0})};s.configure=function(e){(!(i=e).api_url||i.api_url.length<=0)&&(i.api_url=t+"/api/v2/"),i.api_url=i.api_url.replace("/api/v1/","/api/v2/"),"/"!==i.api_url[i.api_url.length-1]&&(i.api_url=i.api_url+"/"),s.baseAppPath=i.api_url.split("/api")[0],s.eventsApiUrl=i.api_url,-1!==s.baseAppPath.indexOf("app.")?(s.baseCdnPath=s.baseAppPath.replace("app.","cdn."),s.baseFrontendPath=s.baseAppPath.replace("app.","www."),s.eventsApiUrl=s.eventsApiUrl.replace("app.","events.")):(o.debugMode?s.baseCdnPath=s.baseAppPath+"/cdn":s.baseCdnPath="https://cdn.fera.ai",s.baseFrontendPath="https://www.fera.ai")},s.checkConfig=function(){return!!s.validConfig()||(o.logger.error("Missing Fera API key. This usually means the footer script is missing (usually because your store theme was changed by someone or something).\nTry navigating to "+t+"/installation?reinstall=1 to fix this or contact our support team for help."),!1)},s.waitForApiConfig=function(e){var t,n=1e4,i=0,r=1,a=function(){return s.validConfig()?(t&&clearInterval(t),e(),!0):((i+=r)===n&&o.logger.warn("Waited more than "+n/1e3+" seconds for Fera api credentials and still don't have them. Please contact our support team for help if this is unexpected."),!1)};a()||(t=setInterval(a,r))},s.validConfig=function(){return!(!i||!i.store_pk)},s.checkIn=function(e,t){var n="undefined"==typeof(t=t||{}).callback?function(){}:t.callback,i=JSON.parse(JSON.stringify(e));i.id=o.visitorId,e.productId&&(i.product_id=e.productId,delete i.productId),e.customerId&&(i.customer_id=e.customerId,delete i.customerId),o.testMode?o.logger.warn("[TEST MODE] Not checking in because test mode is enabled, but the rest of the JS will think we did..",i):d("check.gif",i,n)},s.mergeShoppers=function(e,t){return l.ajax({method:"POST",type:"POST",data:{},headers:{"API-CLIENT":c},dataType:"html",url:s.url("shoppers/"+e+"/merge",{other_id:t})})},s.pushEvent=function(e,t){var n=(t=t||{}).callback||t.then||function(){};"view"===e.type&&("undefined"!=typeof e.state.product_id&&(e.associated_to="product"),e.state=e.state||{},e.state.event_history=u(e)),o.testMode?o.logger.warn("[TEST MODE] Not pushing event to the api because test mode is enabled, but the rest of the JS will think we did.",e):("object"==typeof e.state&&(e.state_json=JSON.stringify(e.state),delete e.state),"object"==typeof e.data&&(e.data_json=JSON.stringify(e.data),delete e.data),r?f(e,n):l(document).ready(function(){f(e,n)}))},s.getFeeds=function(t,n,e){o.testMode?(t.test_mode=o.testMode,s.cachedTestFeedResponse?n(a(t.types)):p("GET",s.url("feeds.json",t),function(e){s.cachedTestFeedResponse=e,n(a(t.types))},e)):p("GET",s.url("feeds.json",t),n,e)};var a=function(e){for(var t=[],n=0;n<s.cachedTestFeedResponse.length;n++)e&&!e.includes(s.cachedTestFeedResponse[n].type)||t.push(l.extend(!0,{},s.cachedTestFeedResponse[n]));return t};s.getReviews=function(i,r,e){if(o.testMode){if(i.test_mode=o.testMode,i.page=i.page||1,s.cachedTestReviewResponse&&s.cachedTestReviewResponse[i.page])return r(s.cachedTestReviewResponse[i.page],s.cachedTestReviewTotalCount);p("GET",s.url("reviews.json",i),function(e,t,n){s.cachedTestReviewResponse=s.cachedTestReviewResponse||{},s.cachedTestReviewResponse[i.page]=e,s.cachedTestReviewTotalCount=parseInt(n.getResponseHeader("Total-Count"))||0,r(s.cachedTestReviewResponse[i.page],s.cachedTestReviewTotalCount)},e)}else p("GET",s.url("reviews.json",i),function(e,t,n){var i=parseInt(n.getResponseHeader("Total-Count"))||0;return r&&r(e,i)},e)},s.getContent=function(e,i,t){if(i=i||function(){},e.visitor_id=o.visitorId,e.api_client=encodeURIComponent(c),e.state=e.state||{},e.push_view_event){var n=l.extend(e,{type:"view"});e.state.event_history=u(n)}o.testMode&&(e.test_mode=o.testMode),o.optionsParser.hasPreviewFilterById()&&(e.fera_preview=o.optionsParser.getPreviewId());var r=s.url("content.json");e.state_json=JSON.stringify(e.state),delete e.state;var a=Fera.Util.sizeOfParams(e)>Fera.Util.maxGetRequestChars()?"POST":"GET";return l.ajax({method:a,type:a,data:e,url:r,success:function(e,t,n){n.getResponseHeader("api-client-outdated")&&o.app.clearCache(),s.requestFailCount=0,i(e,t,n)},error:function(e){s.requestFailCount+=1,t&&t(e)}})},s.submitContent=function(e){l.ajax({url:s.url("content_submissions",e.params),method:"POST",type:"POST",data:e.data,contentType:!1,processData:!1,success:e.success,error:e.error})},s.requestContentSubmissionTemplate=function(e){var t=s.url("content_submissions/template",l.extend({visitor_id:o.app.getVisitorId()},e.params));p("GET",t,e.success,e.error)},s.triggerActions=function(e,i){return e=l.extend({},o.app.getState(),e),i=i||{},e.visitor_id=o.visitorId,o.testMode&&(e.test_mode=o.testMode),o.optionsParser.hasPreviewFilterById()&&(e.fera_preview=o.optionsParser.getPreviewId()),l.ajax({method:"POST",type:"POST",data:e,url:s.url("shoppers/"+o.visitorId+"/trigger_skill_actions"),success:function(e,t,n){s.requestFailCount=0,i.success&&i.success(e,t,n)},error:function(e){s.requestFailCount+=1,i.error&&i.error(e)}})},s.url=function(e,t,n){return n=n||i.api_url,(t=t||{}).public_key=i.store_pk,o.adminMode&&(t.adminSessionToken&&(t.admin_session_token=o.adminSessionToken),t.admin=o.adminMode),o.debugMode&&(t.debug_mode=!0),(n+="public/")+(e=e||"")+"?"+l.param(t)},s.getShopper=function(e,t){return p("GET",s.url("shoppers/"+e,{},s.eventsApiUrl),t,t)},s.deleteShopper=function(e,t){return p("DELETE",s.url("shoppers/"+e,{},s.eventsApiUrl),t,t)};var u=function(e){var t=o.localStorage.getObject("EventHistory",{}),n=(new Date).getTime(),i=e.associated_to||("undefined"!=typeof e.state.product_id?"product":"any"),r="any"===i?"any":i+"-"+e.state.product_id;return t[e.type]=t[e.type]||{},t[e.type][r]=t[e.type][r]||[],t[e.type][r].push(n/1e3),2<t[e.type][r].length&&t[e.type][r].splice(1,1),o.localStorage.setObject("EventHistory",t),t[e.type][r]},
d=function(e,t,n){var i=document.createElement("img");t.api_client=c,i.src=s.url(e,t,s.eventsApiUrl),l(i).on("load error",function(){n(l(i))})},f=function(i,e){e=e||function(){};var t=o.debugMode?"POST":Fera.Util.httpMethodToUse(i),r=function(){};if("GET"!==t)return l.ajax({method:t,type:t,headers:{"API-CLIENT":c},data:JSON.stringify(i),url:s.url("events.json",{},s.eventsApiUrl),dataType:"html",success:r,error:function(e){if(e.status<300)return r(e);var t="unknown error";try{t=JSON.parse(e.responseText).error_message}catch(n){}o.logger.warn("Event failed to send: "+t,i,e)},complete:e});d("e.gif",i,e)},p=function(e,t,n,i){l.ajax({method:e,type:e,headers:{"API-CLIENT":c},url:t,success:n,error:i})};e()},Fera.VisitorManager=function(t){var n,i=this,r=(t=t||{}).cookieJar,a=1825,e=function(){};i.ensureVisitorId=function(){return n=i.getId(),o(),n?s():l(),n},i.setId=function(e){-1!==(n=e).indexOf(" path=/")&&(n=n.replace(" path=/","")),r.setCookie("banana_stand_visitor_id",n,a)},i.getId=function(){return r.getCookie("banana_stand_visitor_id")};var o=function(){var e=t.optionsParser.feraParams.shopper;e&&(e=e.toLowerCase(),n?n!==e&&(Fera.logger.log("Shopper (visitor) ID was changed from URL. Merge operation impending.",n,e),t.api.mergeShoppers(n,e)):Fera.logger.log("Shopper (visitor) ID was set from URL.",n),n=e)},s=function(){i.setId(n)},l=function(){var e=Fera.Util.generateUUID();i.setId(e)};e()},Fera.Notification=function(a,o){var t,s,e=this,r=o.app.geo,l=Fera.Util.$(),n=function(){(e.data=a).rendered_html&&(t=a.rendered_html)};this.getId=function(){return parseInt(a.id)},this.getHtml=function(){return t||(f()?t:"")},this.getEl=function(){return s||(s=l(e.getHtml()),i()),s};var c=function(e){if(e.split(",").length<2)return e;if(!r.hasStoredInfo()||!r.ipResult||!r.ipResult.country_name)return e;var t=new RegExp("^(.+,\\s?)?(.+?),\\s?"+r.ipResult.country_code+"$","i");e=e.replace(t,"$1$2");var n=[r.ipResult.country_name];"US"===r.ipResult.country_code&&n.push("U\\.S\\.A","United States","United States of America","U\\.S\\.A\\.","U\\.S","U\\.S\\.","USA","US");var i=new RegExp("^(.+)?,\\s?("+n.join("|")+")$","i");return e=e.replace(i,"$1")},i=function(){s.find(".banana-product-caption, .fera-product-caption").each(function(){var e=l(this),t=e.find(".banana-product-link, .fera-product-link");0===t.length&&(t=e);var n=e.data("max_product_name_length")||30,i=t.text();if(n<3)Fera.logger.warn("Max product name length was entered in as less than 3, so may have been a mistake. Product name was not truncated.",e,n);else if(i.length>n+3){var r,a=i.substr(0,n)+"...";t.text(a),s.on("mouseenter",function(){t.text(i)}),s.on("mouseleave",function(){r&&clearTimeout(r),r=setTimeout(function(){t.text(a)},1e3)})}})},u=function(){var e=l.extend(!0,{},o.settings,a);e.customer_name_display=a.shopper.name,e.show_name="Someone"!==a.shopper.name&&o.settings.show_name;var t=o.isPreview&&Math.random()<.3,n="Someone"==e.customer_name_display||!e.show_name||e.customer_name_display==o.settings.string_templates.someone||t;e.cust_profile_img=a.shopper.picture,e.cust_profile_img&&(n&&("female_only"===e.profile_pic_fallback_mode?-1===e.cust_profile_img.indexOf("female")&&(e.cust_profile_img=e.cust_profile_img.replace("male","female")):"male_only"===e.profile_pic_fallback_mode?e.cust_profile_img=e.cust_profile_img.replace("female","male"):"user_defined"===e.profile_pic_fallback_mode?e.cust_profile_img=e.profile_pic_custom_url:"none"===e.profile_pic_fallback_mode&&(e.cust_profile_img="",e.display_picture_html="",e.cust_profile_tag=null)),e.cust_profile_img&&(e.cust_profile_tag='<img src="'+e.cust_profile_img+'" alt="'+(n?"Anonymous profile picture":e.customer_name_display)+'" class="fera-profileImage">',"shopper_profile_pic"===o.settings.picture_mode?e.display_picture_html=e.cust_profile_tag:"product_image"===o.settings.picture_mode&&a.product&&a.product.thumbnail?e.display_picture_html='<img src="'+a.product.thumbnail+'" alt="'+a.product.name+'" class="banana-profile-image banana-profile-image-product fera-profile-image fera-profile-image-product">':e.display_picture_html=""));var i=new Fera.TimeAgo({tpl:o.settings.string_templates.time_ago,time:e.created_at});if("Someone"!==e.customer_name_display&&(e.customer_name_display=Fera.Util.toTitleCase(e.customer_name_display)),e.location_string=a.shopper.location,e.location_string&&(e.location_string=Fera.Util.toTitleCase(e.location_string),e.location_string=c(e.location_string)),a.shopper.location_details&&(e.shopper.location=a.shopper.location_details),e.seconds_ago=i.toSeconds(),e.product_display=a.product?a.product.name:"",e.event_time=i.toString(),e.use_product_name=!(o.app.getProductId()&&e.product&&o.app.getProductId()==e.product.id),e.action_type="product_order"===a.type?"customer_ordered_product":"customer_added_to_cart",e.event_type=a.type,o.settings.popout&&(e.popout=!0),e.options=o.settings,e.shopper_name=n?o.settings.string_templates.someone||"Someone":'<span class="banana-customer-name fera-customer-name">'+e.customer_name_display+"</span>",e.shopper_location='<span class="banana-location fera-location">'+e.location_string+"</span>",e.product_name='<span class="banana-product-caption fera-product-caption" data-max_product_name_length="'+e.max_product_name_length+'">',e.product&&e.product.name?(e.product.url&&(e.product_name+='<a href="'+e.product.url+'" target="'+e.product.id+'" class="banana-product-link fera-product-link">'),e.product_name+=e.product.name,e.product.url&&(e.product_name+="</a>")):e.product_name+="a product",o.settings.string_templates&&o.settings.string_templates.actions){var r=o.settings.string_templates.actions[e.event_type];e.statement=d(r,e).trim().replace(/\.$/,"")}return e},d=function(e,t){var n=e.replace(new RegExp(/\s*({%-)/g,"g"),"{%").replace(new RegExp(/(-%})\s*/,"g"),"%}").trim();if(!n)return Fera.logger.error("Template is empty or not valid.",e,t),"";var i=Fera.Liquid.parse(n);return i?i.render(t):(Fera.logger.error("Failed to parse template: ",i,t),"")},f=function(){var e=u();return""!==(t=d(o.settings.notification_template,e))};n()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.Base=function(){function e(){_classCallCheck(this,e),this.$=Fera.Util.$()}return _createClass(e,[{key:"_log",value:function t(){return Fera.logger.log.apply(this,arguments)}},{key:"_warn",value:function n(){return Fera.logger.warn.apply(this,arguments)}},{key:"_error",value:function i(){return Fera.logger.error.apply(this,arguments)}},{key:"_logWarning",value:function r(){return Fera.logger.logWarning.apply(this,arguments)}}]),e}();var FeraCachedAsset=function(i){var n=this;this.version="0.2.3";var r=i.name||i.url.split("?")[0].split("#")[0],a="Fera.AssetCache."+r,o=(new Date).getTime()/1e3,s=i.type||(-1!==i.url.indexOf(".html")?"text/template":-1!==i.url.indexOf(".css")?"text/css":"text/javascript");n.load=function(t){return t=t||function(){},n.content?t(n.content):(e()?t(n.content):c(i.url,function(e){n.content=e,l(e),n.save(e),t(e)}),!0)},n.save=function(e){var t=o+(i.expiresIn||900);if(!u()||!e)return!1;var n={name:r,url:i.url,expires:t,content:e};return window.localStorage.setItem(a,JSON.stringify(n)),!0},n.clear=function(){return window.localStorage.removeItem(a),!1};var e=function(){if(!u())return!1;var e=window.localStorage.getItem(a);if(!e||"string"!=typeof e)return null;var t=JSON.parse(e);return t.expires<o||t.url!==i.url?n.clear():(n.content=t.content,l(n.content),!0)},l=function(e){if(!document.getElementById(a)){var t=document.createElement("text/css"===s?"style":"script");t.type=s,t.id=a,t.async=!0,t.innerHTML=e,document.body.appendChild(t)}},c=function(e,t){var n=new XMLHttpRequest;n.async=!0,n.onreadystatechange=function(){4==n.readyState&&n.status<300&&t(n.responseText)},n.open("GET",e,!0),n.send()},u=function(){var e="test";try{return window.localStorage.setItem(e,"t"),window.localStorage.removeItem(e),1}catch(t){return 0}}},BananaStandCachedAsset=FeraCachedAsset;Fera.Cart=function(r){var a,o,s=this,n=!1,t=!1,i=r.app.localStorage,l=[],c="Cart",e=6048e4,u=function(){p(),setTimeout(function(){t||s.update(!0)},5e3)};s.setAdapter=function(e){o=e},s.addProductIfEmpty=function(e,t,n){s.ifEmpty(function i(){"function"==typeof n.beforeAdd&&n.beforeAdd(),s.addProduct(e,t,n)},n.afterAdd)},s.removeProduct=function(e,t,n){return t=t||{},n=n||{},!!s.containsProduct(e,t)&&o.removeProduct(e,t,n)},s.ifEmpty=function(e,t){s.update(function(){a&&0!==a.item_count?t&&t():e&&e()},!0)},s.containsProducts=function(e){for(var t=0;t<e.length;t++)if(s.containsProduct(e[t]))return!0;return!1},s.containsProduct=function(e){if(!a||!a.items||a.items.length<1)return!1;for(var t=0;t<a.items.length;t++)if(a.items[t].product_id+""==e+"")return!0;return!1},s.getProductQuantity=function(e){if(!a||!a.items||a.items.length<1)return 0;for(var t=0,n=0;n<a.items.length;n++)a.items[n].product_id+""==e+""&&(t+=a.items[n].quantity||0);return t},s.update=function(t,e){if("boolean"==typeof t&&void 0===e&&(e=t,t=null),t=t||function(){},void 0===e&&(e=!1),e&&n||!o)return t();o.downloadData(function(e){s.loadData(e),n=!0,setTimeout(function(){n=!1},5e3),t()})},s.startCheckout=function(){if(!o)throw"No cart adapter specified so checkout cannot be triggered.";return o.startCheckout()},s.hasData=function(){return a},s.getData=function(){return a},s.loadItemData=function(e){var t=o?o.parseItemData(e):e;return s.addItem(t),s},s.loadData=function(e){return a=o?o.parseCartData(e):e,t=!0,d(a)&&(l.push({event:"change",at:(new Date).getTime()}),r.app.trigger("cart.changed")),f(),s},s.loadCartData=s.loadData,s.addProduct=function(e,t,n){if(!o)throw"No cart adapter specified so can't add product to the cart.";if(t=t||{},"function"==typeof(n=n||{})){var i=n;(n={}).afterAdd=i}return o.addProduct(e,t,n)},s.validateData=function(){if(!a)return r.logger.error("Cart data is empty."),!1;a.items||(r.logger.log("cart.items should be an array of items."),a.items=[]),a.total_weight||(a.total_weight=0),a.total_discount||(a.total_discount=0),a.currency||(r.logger.log("Missing cart.currency, assumed USD"),a.currency="USD");for(var e=0,t=0,n=0;n<a.items.length;n++){var i=a.items[n];if((!i.quantity||parseInt(i.quantity)<=0)&&(a.items[n].quantity=1),i.total||(i.price?a.items[n].total=a.items[n].quantity*i.price:a.items[n].total=0),!i.product_id){if(!i.id)return r.logger.error("Missing cart.items["+n+"].product_id"),!1;i.product_id=i.id}i.variant_id||(a.items[n].variant_id=null),e+=a.items[n].quantity,t+=a.items[n].total}return a.item_count||(a.item_count=e),a.total||(a.total=t),a.grand_total||(a.grand_total=a.total),!0},s.addItem=function(e){a.item_count=a.item_count+e.quantity,a.total=a.total+e.total,a.total_weight=a.total_weight+e.weight,a.total_discount=a.total_discount+e.total_discount,delete e.weight,delete e.total_discount,a.items.push(e),l.push({event:"add",at:(new Date).getTime()}),f()},s.isEmpty=function(){return!a||0===Object.keys(a).length&&a.constructor===Object||0===a.item_count},s.getItemsString=function(){for(var e=[],t=0;t<a.items.length;t++)e.push(a.items[t].product_id+"x"+a.items[t].quantity);return e.join(",")},s.getHistory=function(){return l||[]},s.reset=function(){a=null,i&&i.removeItem(c),t=!0,l.push({event:"empty",at:(new Date).getTime()}),f(),r.app.trigger("cart.emptied")},s.clear=function(){o.clear(function(){s.reset()})};var d=function(e){var t=h();if(!t)return!1;if(!e&&t)return!0;if("undefined"!=typeof e.item_count&&e.item_count!=t.item_count)return!0;if("undefined"!=typeof e.total&&e.total!=t.total)return!0;for(var n=0;n<t.items.length;n++)if("undefined"==typeof e.items[n]){if("undefined"!=typeof e.items[n].total&&e.items[n].total!=t.items[n].total)return!0;if("undefined"!=typeof e.items[n].product_id&&e.items[n].product_id!=t.items[n].product_id)return!0;if("undefined"!=typeof e.items[n].variant_id&&e.items[n].variant_id!=t.items[n].variant_id)return!0}return!1},f=function(){i&&i.setObject(c,{data:a,history:l},e)},p=function(){if(i){var e=i.getObject(c,{});a=e.data||e,l=e.history||[]}},h=function(){if(i)return i.getObject(c,{}).data};u()},Fera.ContainersUpdateScheduler=function(r){var e=this,a=[],o=(new Date).getTime()/1e3,t=function(){};e.collect=function(e,t){var n=e||s(),i=o+n;i=l(i);var r=a.find(function(e){return e.updateAt===i});r||(r={updateAt:i,containers:[]},a.push(r)),r.containers.push(t),a.sort(function(e,t){return e.updateAt-t.updateAt})},e.markExpiredContainersAsDirty=function(){if(a&&!(a.length<=0)){for(var e=(new Date).getTime()/1e3,t=[],n=0;n<a.length;n++){var i=a[n];e>=i.updateAt?r.containers.markAllContainersAsDirty():t.push(i)}a=t}},e.reset=function(){a=[],o=(new Date).getTime()/1e3};var s=function(){return 300},n=function i(){return 1},l=function(e){return e-e%n()+n()};t()},Fera.CookieJar=function(e){var o=this;e=e||{};var t=function(){o.namespace=e.prefix||e.namespace||""};o.setCookie=function(e,t,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toUTCString()}var a=o.namespace+e+"="+t+i+"; path=/; SameSite=None";0===window.location.toString().indexOf("https")&&(a+="; Secure"),document.cookie=a},o.getCookie=function(e,t){t=t||null;for(var n=e+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var a=i[r];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(n))return a.substring(n.length,a.length)}return 0===e.indexOf("Fera.")?o.getCookie(e.replace("Fera.","BananaStand."),t):0===e.indexOf("fera_")?o.getCookie(e.replace("fera_","bs_"),t):0===e.indexOf("fera-")?o.getCookie(e.replace("fera-","banana_stand-"),t):t},o.getCookieObject=function(e,t){var n=o.getCookie(e,t);return"string"==typeof n&&(n=JSON.parse(decodeURIComponent(atob(n)))),n},o.setCookieObject=function(e,t,n){return t=btoa(encodeURIComponent(JSON.stringify(t))),o.setCookie(e,t,n)},t()},Fera.EngagementRegistry=function(t){t=t||{};var n,i=this,r=[],a=[],o=[],e=function(){l()};i.register=function(e){if(!e)throw"Campaign ID can't be blank";s(e)?-1===r.indexOf(e)&&-1===a.indexOf(e)&&a.push(e):r.push(e),o.push(e),u()},i.pushEvent=function(){if(!(r.length<1&&a.length<1)){var e={type:"campaign_engagement",data:{engagements:{first_time:r,recurring:a}}};t.app.pushEvent(e),i.flush()}},i.state=function(){return{firstTime:r,recurring:a,historicalEngagements:o}},i.reset=function(){r=[],a=[],o=[],c()},i.flush=function(){r=[],a=[],c()};var s=function(e){return-1!==o.indexOf(e)},l=function(){o=t.localStorage.getObject("Fera.EngagementRegistry.historicalEngagements")||[]},c=function(){t.localStorage.setObject("Fera.EngagementRegistry.historicalEngagements",o)},u=function(){n&&clearTimeout(n),n=setTimeout(function(){try{i.pushEvent()}catch(e){throw n&&clearTimeout(n),t.logger.warn("Aborted watching for engagements since we got an error: ",e.message),e}},1500)};e()},Fera.ExitIntentDetector=function(t){t=t||{};var n,e=Fera.Util.$(),i=t.sensitivity||300,r=function(){e(window).on("mouseleave",a),e(window).on("mouseenter",o)},a=function(e){0<e.clientY||(n&&clearTimeout(n),i<=0?t.onExitIntent&&(Fera.logger.log("Exit intent detected."),t.onExitIntent()):n=setTimeout(function(){n=null,t.onExitIntent&&(Fera.logger.log("Exit intent detected."),t.onExitIntent())},i))},o=function(){n&&(clearTimeout(n),n=null)};r()},Fera.Geo=function(e){var n=this,i="https://geo.bananastand.io/json/",r=Fera.Util.$(),t=e.localStorage||new Fera.LocalStorageJar(e),a=function(){n.ipResult=null,o()};this.hasStoredInfo=function(){return null!==n.ipResult},this.getLocationInfo=function(e){n.ipResult?e(n.ipResult):n.geolocateIp(e)},this.geolocateIp=function(t,e){t=t||function(){},r.ajax({method:"GET",type:"GET",url:i,success:function(e){s(e),t(n.ipResult)},dataType:"jsonp",error:function(){e&&t({})}})};var o=function(){if(void 0!==t)try{n.ipResult=t.getObject(l())}catch(e){}},s=function(e){n.ipResult=e,void 0!==t&&t.setObject(l(),n.ipResult,72e5)},l=function(){return"Geo.geolocateIp.result"};a()},Fera.InactivityDetector=function(n){n=n||{};var t,i=this,r=!1,a=Fera.Util.$(),o="undefined"==typeof n.reactToWindowBlurs||n.reactToWindowBlurs,s=[],l=[],c=!0,e=function(){n.timeLimit=n.timeLimit||6e4,f()};i.attachToFrames=function(){for(var e=0;e<window.frames.length;e++)try{p(window.frames[e],window.frames[e].document)}catch(t){n.logger.log("Failed to attach to frame. Likely due to it being of a different origin than the main frame.",e)}},i.addInactivityListener=function(e){s.push(e)},i.addReactivityListener=function(e){l.push(e)},i.isActive=function(){return c};var u=function(){for(var e=0;e<l.length;e++)l[e](i);c=!0},d=function(){for(var e=0;e<s.length;e++)s[e](i);c=!1},f=function(){a(window).on("load",h),p(window,document),i.attachToFrames()},p=function(e,t){a(t).on("mousemove keypress mousedown touchstart click scroll",h),o&&(a(e).on("blur",g),a(e).on("focus",m))},h=function(){m(),t=setTimeout(g,n.timeLimit)},g=function(){var e=r;r=!0,e||d()},m=function(){t&&clearTimeout(t);var e=r;r=!1,e&&u()};e()},Fera.Liquid={registerFilters:function(e){Fera.Liquid.Template.registerFilter(e)},parse:function(e){return Fera.Liquid.Template.parse(e)}},Fera.Liquid.extensions={},Fera.Liquid.extensions.object={},Fera.Liquid.extensions.object.update=function(e){for(var t in e)this[t]=e[t];return this},Fera.Liquid.extensions.object.hasKey=function(e){return!!this[e]},Fera.Liquid.extensions.object.hasValue=function(e){for(var t in this)if(this[t]==e)return!0;return!1},Fera.Liquid.extensions.object.isEmpty=function(e){if(!e||""===Fera.Liquid.extensions.stringTools.strip(e.toString()))return!0;if(e.length&&0<e.length)return!1;if("number"==typeof e)return!1;for(var t in e)if(e[t])return!1;return!0},Fera.Liquid.extensions.stringTools={},Fera.Liquid.extensions.stringTools.capitalize=function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()},Fera.Liquid.extensions.stringTools.strip=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},Fera.Liquid.extensions.arrayTools={},Fera.Liquid.extensions.arrayTools.last=function(e){return e[e.length-1]},Fera.Liquid.extensions.arrayTools.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1},Fera.Liquid.extensions.arrayTools.map=function(e,t,n){var i=e.length;if("function"!=typeof t)throw"Fera.Liquid.extensions.arrayTools.map requires first argument to be a function";for(var r=new Array(i),a=n,o=0;o<i;o++)o in e&&(r[o]=t.call(a,e[o],o,e));return r},Fera.Liquid.extensions.arrayTools.flatten=function(e){for(var t=e.length,n=[],i=0;i<t;i++)e[i]instanceof Array?n=n.concat(e[i]):n.push(e[i]);return n},Fera.Liquid.extensions.arrayTools.each=function(e,t,n){var i=e.length;if("function"!=typeof t)throw"Fera.Liquid.extensions.arrayTools.each requires first argument to be a function";for(var r=n,a=0;a<i;a++)a in e&&t.call(r,e[a],a,e);return null},Fera.Liquid.extensions.arrayTools.include=function(e,t){e.length;return 0<=Fera.Liquid.extensions.arrayTools.indexOf(e,t)},function(){var a=!1,o=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},this.Class.extend=function(e){function t(){!a&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;a=!0;var n=new this;for(var i in a=!1,e)n[i]="function"==typeof e[i]&&"function"==typeof r[i]&&o.test(e[i])?function(n,i){return function(){var e=this._super;this._super=r[n];var t=i.apply(this,arguments);return this._super=e,t}}(i,e[i]):e[i];return t.prototype=n,(t.prototype.constructor=t).extend=arguments.callee,t}}.call(Fera.Liquid),Fera.Liquid.Tag=Fera.Liquid.Class.extend({init:function(e,t,n){this.tagName=e,this.markup=t,this.nodelist=this.nodelist||[],this.parse(n)},parse:function(){},render:function(){return""}}),Fera.Liquid.Block=Fera.Liquid.Tag.extend({init:function(e,t,n){this.blockName=e,this.blockDelimiter="end"+this.blockName,this._super(e,t,n)},parse:function(e){this.nodelist||(this.nodelist=[]),this.nodelist.length=0;var t=e.shift();for(e.push("");e.length;){if(/^\{\%/.test(t)){this.whitespaceHandler(t,e);var n=t.match(/^\{\%-?\s*(\w+)\s*(.*?)-?\%\}$/);if(!n)throw"Tag '"+t+"' was not properly terminated with: %}";if(this.blockDelimiter==n[1])return void this.endTag();n[1]in Fera.Liquid.Template.tags?this.nodelist.push(new Fera.Liquid.Template.tags[n[1]](n[1],n[2],e)):this.unknownTag(n[1],n[2],e)}else/^\{\{/.test(t)?(this.whitespaceHandler(t,e),this.nodelist.push(this.createVariable(t))):this.nodelist.push(t);t=e.shift()}this.assertMissingDelimitation()},endTag:function(){},unknownTag:function(e){switch(e){case"else":throw this.blockName+" tag does not expect else tag";case"end":throw"'end' is not a valid delimiter for "+this.blockName+" tags. use "+this.blockDelimiter;default:throw"Unknown tag: "+e}},createVariable:function(e){var t=e.match(/^\{\{-?(.*?)-?\}\}$/);if(t)return new Fera.Liquid.Variable(t[1]);throw"Variable '"+e+"' was not properly terminated with: }}"},render:function(e){return this.renderAll(this.nodelist,e)},renderAll:function(e,i){return Fera.Liquid.extensions.arrayTools.map(e||[],function(e){var t="";try{t=e.render?e.render(i):e}catch(n){t=i.handleError(n)}return t})},assertMissingDelimitation:function(){throw this.blockName+" tag was never closed"},whitespaceHandler:function(e,t){"-"==e[2]&&0<this.nodelist.length&&""===this.nodelist[this.nodelist.length-1].trim()&&this.nodelist.pop(),"-"===e[e.length-3]&&0<t.length&&""===t[0].trim()&&t.shift()}}),Fera.Liquid.Document=Fera.Liquid.Block.extend({init:function(e){this.blockDelimiter=[],this.parse(e)},assertMissingDelimitation:function(){}}),Fera.Liquid.Strainer=Fera.Liquid.Class.extend({init:function(e){this.context=e},respondTo:function(e){return!(e=e.toString()).match(/^__/)&&(!Fera.Liquid.extensions.arrayTools.include(Fera.Liquid.Strainer.requiredMethods,e)&&e in this)}}),Fera.Liquid.Strainer.filters={},Fera.Liquid.Strainer.globalFilter=function(e){for(var t in e)Fera.Liquid.Strainer.filters[t]=e[t]},Fera.Liquid.Strainer.requiredMethods=["respondTo","context"],Fera.Liquid.Strainer.create=function(e){var t=new Fera.Liquid.Strainer(e);for(var n in Fera.Liquid.Strainer.filters)t[n]=Fera.Liquid.Strainer.filters[n];return t},Fera.Liquid.Context=Fera.Liquid.Class.extend({init:function(e,t,n){this.scopes=[e||{}],this.registers=t||{},this.errors=[],this.rethrowErrors=n,this.strainer=Fera.Liquid.Strainer.create(this)},get:function(e){return this.resolve(e)},set:function(e,t){this.scopes[0][e]=t},hasKey:function(e){return!!this.resolve(e)},push:function(){var e={};return this.scopes.unshift(e),e},merge:function(e){return Fera.Liquid.extensions.object.update.call(this.scopes[0],e)},pop:function(){if(1==this.scopes.length)throw"Context stack error";return this.scopes.shift()},stack:function(e,t){var n=null;this.push();try{n=e.apply(t||this.strainer)}finally{this.pop()}return n},invoke:function(e,t){return this.strainer.respondTo(e)?this.strainer[e].apply(this.strainer,t):0==t.length?null:t[0]},resolve:function(e){switch(e){case null:case"nil":case"null":case"":return null;case"true":return!0;case"false":return!1;case"blank":case"empty":return"";default:if(/^'(.*)'$/.test(e))return e.replace(/^'(.*)'$/,"$1");if(/^"(.*)"$/.test(e))return e.replace(/^"(.*)"$/,"$1");if(/^(\d+)$/.test(e))return parseInt(e.replace(/^(\d+)$/,"$1"));if(/^(\d[\d\.]+)$/.test(e))return parseFloat(e.replace(/^(\d[\d\.]+)$/,"$1"));if(/^\((\S+)\.\.(\S+)\)$/.test(e)){var t=e.match(/^\((\S+)\.\.(\S+)\)$/),n=parseInt(t[1]),i=parseInt(t[2]),r=[];if(isNaN(n)){var a=this.resolve(t[1]);if(n=parseInt(a),isNaN(n))throw new Error("Incorrect param for range: "+e)}if(isNaN(i)){var o=this.resolve(t[2]);if(i=parseInt(o),isNaN(i))throw new Error("Incorrect param for range: "+e)}for(var s=i-n+1,l=0;l<s;l++)r.push(l+n);return r}return this.variable(e)}},findVariable:function(e){for(var t=0;t<this.scopes.length;t++){var n=this.scopes[t];if(n&&"undefined"!=typeof n[e]){var i=n[e];return"function"==typeof i&&(i=i.apply(this),n[e]=i),i&&this._isObject(i)&&"toFera.Liquid"in i&&(i=i.toFera.Liquid()),i&&this._isObject(i)&&"setContext"in i&&i.setContext(self),i}}return null},variable:function(e){if("string"!=typeof e)return null;var t=e.match(/\[[^\]]+\]|(?:[\w\-]\??)+/g),n=t.shift(),i=n.match(/^\[(.*)\]$/);i&&(n=this.resolve(i[1]));var r=this.findVariable(n),a=this;return r&&Fera.Liquid.extensions.arrayTools.each(t,function(e){var t=e.match(/^\[(.*)\]$/);if(t){e=a.resolve(t[1]);"function"==typeof r[e]&&(r[e]=r[e].apply(this)),r=r[e],a._isObject(r)&&"toFera.Liquid"in r&&(r=r.toFera.Liquid())}else{if((a._isObject(r)||"hash"==typeof r)&&e in r){var n=r[e];"function"==typeof n&&(n=r[e]=n.apply(a)),r=a._isObject(n)&&"toFera.Liquid"in n?n.toFera.Liquid():n}else if(/^\d+$/.test(e)){var i=parseInt(e);"function"==typeof r[i]&&(r[i]=r[i].apply(a)),r=a._isObject(r)&&a._isObject(r[i])&&"toFera.Liquid"in r[i]?r[i].toFera.Liquid():r[i]}else{if(!r||"function"!=typeof r[e]||!Fera.Liquid.extensions.arrayTools.include(["length","size","first","last"],e))return r=null;"toFera.Liquid"in(r=r[e].apply(e))&&(r=r.toFera.Liquid())}a._isObject(r)&&"setContext"in r&&r.setContext(a)}}),r},addFilters:function(e){e=Fera.Liquid.extensions.arrayTools.flatten(e),Fera.Liquid.extensions.arrayTools.each(e,function(e){if(!this._isObject(e))throw"Expected object but got: "+typeof e;this.strainer.addMethods(e)})},handleError:function(e){if(this.errors.push(e),this.rethrowErrors)throw e;return"Fera.Liquid error: "+(e.message?e.message:e.description?e.description:e)},_isObject:function(e){return null!=e&&"object"==typeof e}}),Fera.Liquid.Template=Fera.Liquid.Class.extend({init:function(){this.root=null,this.registers={},this.assigns={},this.errors=[],this.rethrowErrors=!1},parse:function(e){return this.root=new Fera.Liquid.Document(Fera.Liquid.Template.tokenize(e)),this},render:function(e,t,n){if(!this.root)return"";var i={ctx:e,filters:t,registers:n},r=null;i.ctx instanceof Fera.Liquid.Context?(r=i.ctx,this.assigns=r.assigns,this.registers=r.registers):(i.ctx&&Fera.Liquid.extensions.object.update.call(this.assigns,i.ctx),i.registers&&Fera.Liquid.extensions.object.update.call(this.registers,i.registers),r=new Fera.Liquid.Context(this.assigns,this.registers,this.rethrowErrors)),i.filters&&r.addFilters(arg.filters);try{return this.root.render(r).join("")}finally{this.errors=r.errors}},renderWithErrors:function(){var e=this.rethrowErrors;this.rethrowErrors=!0;var t=this.render.apply(this,arguments);return this.rethrowErrors=e,t}}),Fera.Liquid.Template.tags={},Fera.Liquid.Template.registerTag=function(e,t){Fera.Liquid.Template.tags[e]=t},Fera.Liquid.Template.registerFilter=function(e){Fera.Liquid.Strainer.globalFilter(e)},Fera.Liquid.Template.tokenize=function(e){var t=e.split(/(\{\%.*?\%\}|\{\{.*?\}\}?)/);return""==t[0]&&t.shift(),t},Fera.Liquid.Template.parse=function(e){return(new Fera.Liquid.Template).parse(e)},Fera.Liquid.Variable=Fera.Liquid.Class.extend({init:function(e){this.markup=e,this.name=null,this.filters=[];var r=this,t=e.match(/\s*("[^"]+"|'[^']+'|[^\s,|]+)/);if(t){this.name=t[1];var n=e.match(/\|\s*(.*)/);if(n){var i=n[1].split(/\|/);Fera.Liquid.extensions.arrayTools.each(i,function(e){var t=e.match(/\s*(\w+)/);if(t){var n=t[1],i=[];Fera.Liquid.extensions.arrayTools.each(Fera.Liquid.extensions.arrayTools.flatten(e.match(/(?:[:|,]\s*)("[^"]+"|'[^']+'|[^\s,|]+)/g)||[]),function(e){var t=e.match(/^[\s|:|,]*(.*?)[\s]*$/);t&&i.push(t[1])}),r.filters.push([n,i])}})}}},render:function(i){if(null==this.name)return"";var r=i.get(this.name);return Fera.Liquid.extensions.arrayTools.each(this.filters,function(e){var t=e[0],n=Fera.Liquid.extensions.arrayTools.map(e[1]||[],function(e){return i.get(e)});n.unshift(r),r=i.invoke(t,n)}),r}}),Fera.Liquid.Condition=Fera.Liquid.Class.extend({init:function(e,t,n){this.left=e,this.operator=t,this.right=n,this.childRelation=null,this.childCondition=null,this.attachment=null},evaluate:function(e){e=e||new Fera.Liquid.Context;var t=this.interpretCondition(this.left,this.right,this.operator,e);switch(this.childRelation){case"or":return t||this.childCondition.evaluate(e);case"and":return t&&this.childCondition.evaluate(e);default:return t}},or:function(e){this.childRelation="or",this.childCondition=e},and:function(e){this.childRelation="and",this.childCondition=e},attach:function(e){return this.attachment=e,this.attachment},isElse:!1,interpretCondition:function(e,t,n,i){if(!n)return i.get(e);if(e=i.get(e),t=i.get(t),!(n=Fera.Liquid.Condition.operators[n]))throw"Unknown operator "+n;return n(e,t)},toString:function(){return"<Condition "+this.left+" "+this.operator+" "+this.right+">"}}),Fera.Liquid.Condition.operators={"==":function(e,t){return e==t},"=":function(e,t){return e==t},"!=":function(e,t){return e!=t},"<>":function(e,t){return e!=t},"<":function(e,t){return e<t},">":function(e,t){return t<e},"<=":function(e,t){return e<=t},">=":function(e,t){return t<=e},contains:function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?0<=Fera.Liquid.extensions.arrayTools.indexOf(e,t):e.match(t)},hasKey:function(e,t){return Fera.Liquid.extensions.object.hasKey.call(e,t)},hasValue:function(e,t){return Fera.Liquid.extensions.object.hasValue.call(e,t)}},Fera.Liquid.ElseCondition=Fera.Liquid.Condition.extend({isElse:!0,evaluate:function(){return!0},toString:function(){return"<ElseCondition>"}}),Fera.Liquid.Drop=Fera.Liquid.Class.extend({setContext:function(e){this.context=e},beforeMethod:function(){},invokeDrop:function(e){var t=this.beforeMethod();return!t&&e in this&&(t=this[e].apply(this)),t},hasKey:function(){return!0}});var hackObjectEach=function(e,t){if("function"!=typeof e)throw"Object.each requires first argument to be a function";var n=0,i=t;for(var r in this){var a=this[r],o=[r,a];o.key=r,o.value=a,e.call(i,o,n,this),n++}return null},split;Fera.Liquid.Template.registerTag("assign",Fera.Liquid.Tag.extend({tagSyntax:/((?:\(?[\w\-\.\[\]]\)?)+)\s*=\s*(.+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(!i)throw"Syntax error in 'assign' - Valid syntax: assign [var] = [source]";this.to=i[1],this.from=i[2],this._super(e,t,n)},render:function(e){var t=new Fera.Liquid.Variable(this.from);return Fera.Liquid.extensions.arrayTools.last(e.scopes)[this.to.toString()]=t.render(e),""}})),Fera.Liquid.Template.registerTag("cache",Fera.Liquid.Block.extend({tagSyntax:/(\w+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(!i)throw"Syntax error in 'cache' - Valid syntax: cache [var]";this.to=i[1],this._super(e,t,n)},render:function(e){var t=this._super(e);return Fera.Liquid.extensions.arrayTools.last(e.scopes)[this.to]=Fera.Liquid.extensions.arrayTools.flatten([t]).join(""),""}})),Fera.Liquid.Template.registerTag("capture",Fera.Liquid.Block.extend({tagSyntax:/(\w+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(!i)throw"Syntax error in 'capture' - Valid syntax: capture [var]";this.to=i[1],this._super(e,t,n)},render:function(e){var t=this._super(e);return Fera.Liquid.extensions.arrayTools.last(e.scopes)[this.to.toString()]=Fera.Liquid.extensions.arrayTools.flatten([t]).join(""),""}})),Fera.Liquid.Template.registerTag("case",Fera.Liquid.Block.extend({tagSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)/,tagWhenSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)(?:(?:\s+or\s+|\s*\,\s*)("[^"]+"|'[^']+'|[^\s,|]+.*))?/,init:function(e,t,n){this.blocks=[],this.nodelist=[];var i=t.match(this.tagSyntax);if(!i)throw"Syntax error in 'case' - Valid syntax: case [condition]";this.left=i[1],this._super(e,t,n)},unknownTag:function(e,t,n){switch(e){case"when":this.recordWhenCondition(t);break;case"else":this.recordElseCondition(t);break;default:this._super(e,t,n)}},render:function(n){var i=this,r=[],a=!0;return n.stack(function(){for(var e=0;e<i.blocks.length;e++){var t=i.blocks[e];if(t.isElse)return 1==a&&(r=Fera.Liquid.extensions.arrayTools.flatten([r,i.renderAll(t.attachment,n)])),r;t.evaluate(n)&&(a=!1,r=Fera.Liquid.extensions.arrayTools.flatten([r,i.renderAll(t.attachment,n)]))}}),r},recordWhenCondition:function(e){for(;e;){var t=e.match(this.tagWhenSyntax);if(!t)throw"Syntax error in tag 'case' - Valid when condition: {% when [condition] [or condition2...] %} ";e=t[2];var n=new Fera.Liquid.Condition(this.left,"==",t[1]);this.blocks.push(n),this.nodelist=n.attach([])}},recordElseCondition:function(e){if(""!=Fera.Liquid.extensions.stringTools.strip(e||""))throw"Syntax error in tag 'case' - Valid else condition: {% else %} (no parameters) ";var t=new Fera.Liquid.ElseCondition;this.blocks.push(t),this.nodelist=t.attach([])}})),Fera.Liquid.Template.registerTag("comment",Fera.Liquid.Block.extend({render:function(){return""}})),Fera.Liquid.Template.registerTag("cycle",Fera.Liquid.Tag.extend({tagSimpleSyntax:/"[^"]+"|'[^']+'|[^\s,|]+/,
tagNamedSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)\s*\:\s*(.*)/,init:function(e,t,n){var i;if(i=t.match(this.tagNamedSyntax))this.variables=this.variablesFromString(i[2]),this.name=i[1];else{if(!(i=t.match(this.tagSimpleSyntax)))throw"Syntax error in 'cycle' - Valid syntax: cycle [name :] var [, var2, var3 ...]";this.variables=this.variablesFromString(t),this.name="'"+this.variables.toString()+"'"}this._super(e,t,n)},render:function(n){var i=this,r=n.get(i.name),a="";return n.registers.cycle||(n.registers.cycle={}),n.registers.cycle[r]||(n.registers.cycle[r]=0),n.stack(function(){var e=n.registers.cycle[r],t=n.get(i.variables[e]);(e+=1)==i.variables.length&&(e=0),n.registers.cycle[r]=e,a=t}),a},variablesFromString:function(e){return Fera.Liquid.extensions.arrayTools.map(e.split(","),function(e){var t=e.match(/\s*("[^"]+"|'[^']+'|[^\s,|]+)\s*/);return t[1]?t[1]:null})}})),Fera.Liquid.Template.registerTag("for",Fera.Liquid.Block.extend({tagSyntax:/(\w+)\s+in\s+((?:\(?[\w\-\.\[\]]\)?)+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(!i)throw"Syntax error in 'for loop' - Valid syntax: for [item] in [collection]";this.variableName=i[1],this.collectionName=i[2],this.name=this.variableName+"-"+this.collectionName,this.attributes={};t.replace(this.tagSyntax,"");var r=t.match(/(\w*?)\s*\:\s*("[^"]+"|'[^']+'|[^\s,|]+)/g);r&&Fera.Liquid.extensions.arrayTools.each(r,function(e){e=e.split(":"),this.attributes[Fera.Liquid.extensions.stringTools.strip(e[0])]=Fera.Liquid.extensions.stringTools.strip(e[1])},this),this._super(e,t,n)},render:function(i){var r=this,a=[],e=i.get(this.collectionName)||[],t=[0,e.length];if(i.registers["for"]||(i.registers["for"]={}),this.attributes.limit||this.attributes.offset){var n=0,o=0,s=0,l=null;t=[n="continue"==this.attributes.offset?i.registers["for"][this.name]:i.get(this.attributes.offset)||0,(s=(o=i.get(this.attributes.limit))?n+o+1:e.length)-1],i.registers["for"][this.name]=s}return(l=e.slice(t[0],t[1]))&&0!=l.length?(i.stack(function(){var n=l.length;Fera.Liquid.extensions.arrayTools.each(l,function(e,t){i.set(r.variableName,e),i.set("forloop",{name:r.name,length:n,index:t+1,index0:t,rindex:n-t,rindex0:n-t-1,first:0==t,last:t==n-1}),a.push((r.renderAll(r.nodelist,i)||[]).join(""))})}),Fera.Liquid.extensions.arrayTools.flatten([a]).join("")):""}})),Fera.Liquid.Template.registerTag("if",Fera.Liquid.Block.extend({tagSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)\s*([=!<>a-z_]+)?\s*("[^"]+"|'[^']+'|[^\s,|]+)?/,init:function(e,t,n){this.nodelist=[],this.blocks=[],this.pushBlock("if",t),this._super(e,t,n)},unknownTag:function(e,t,n){Fera.Liquid.extensions.arrayTools.include(["elsif","else"],e)?this.pushBlock(e,t):this._super(e,t,n)},render:function(n){var i=this,r="";return n.stack(function(){for(var e=0;e<i.blocks.length;e++){var t=i.blocks[e];if(t.evaluate(n))return void(r=i.renderAll(t.attachment,n))}}),Fera.Liquid.extensions.arrayTools.flatten([r]).join("")},pushBlock:function(e,t){var n;if("else"==e)n=new Fera.Liquid.ElseCondition;else{var i=t.split(/\b(and|or)\b/).reverse();if(!(a=i.shift().match(this.tagSyntax)))throw"Syntax Error in tag '"+e+"' - Valid syntax: "+e+" [expression]";for(var r=new Fera.Liquid.Condition(a[1],a[2],a[3]);0<i.length;){var a,o=i.shift();if(!(a=i.shift().match(this.tagSyntax)))throw"Syntax Error in tag '"+e+"' - Valid syntax: "+e+" [expression]";var s=new Fera.Liquid.Condition(a[1],a[2],a[3]);s[o](r),r=s}n=r}n.attach([]),this.blocks.push(n),this.nodelist=n.attachment}})),Fera.Liquid.Template.registerTag("ifchanged",Fera.Liquid.Block.extend({render:function(t){var n=this,i="";return t.stack(function(){var e=n.renderAll(n.nodelist,t).join("");e!=t.registers.ifchanged&&(i=e,t.registers.ifchanged=i)}),i}})),Fera.Liquid.Template.registerTag("include",Fera.Liquid.Tag.extend({tagSyntax:/((?:"[^"]+"|'[^']+'|[^\s,|]+)+)(\s+(?:with|for)\s+((?:"[^"]+"|'[^']+'|[^\s,|]+)+))?/,init:function(e,t,n){var i=(t||"").match(this.tagSyntax);if(!i)throw"Error in tag 'include' - Valid syntax: include '[template]' (with|for) [object|collection]";this.templateName=i[1],this.templateNameVar=this.templateName.substring(1,this.templateName.length-1),this.variableName=i[3],this.attributes={};var r=t.match(/(\w*?)\s*\:\s*("[^"]+"|'[^']+'|[^\s,|]+)/g);r&&Fera.Liquid.extensions.arrayTools.each(r,function(e){e=e.split(":"),this.attributes[Fera.Liquid.extensions.stringTools.strip(e[0])]=Fera.Liquid.extensions.stringTools.strip(e[1])},this),this._super(e,t,n)},render:function(t){var n=this,e=Fera.Liquid.readTemplateFile(t.get(this.templateName)),i=Fera.Liquid.parse(e),r=t.get(this.variableName||this.templateNameVar),a="";return t.stack(function(){n.attributes.each=hackObjectEach,n.attributes.each(function(e){t.set(e.key,t.get(e.value))}),r instanceof Array?a=Fera.Liquid.extensions.arrayTools.map(r,function(e){return t.set(n.templateNameVar,e),i.render(t)}):(t.set(n.templateNameVar,r),a=i.render(t))}),a=Fera.Liquid.extensions.arrayTools.flatten([a]).join("")}})),Fera.Liquid.Template.registerTag("unless",Fera.Liquid.Template.tags["if"].extend({render:function(n){var i=this,r="";return n.stack(function(){if((t=i.blocks[0]).evaluate(n))for(var e=1;e<i.blocks.length;e++){var t;if((t=i.blocks[e]).evaluate(n))return void(r=i.renderAll(t.attachment,n))}else r=i.renderAll(t.attachment,n)}),Fera.Liquid.extensions.arrayTools.flatten([r]).join("")}})),Fera.Liquid.Template.registerTag("raw",Fera.Liquid.Block.extend({parse:function(e){this.nodelist||(this.nodelist=[]),this.nodelist.length=0;var t=e.shift();for(e.push("");e.length;){if(/^\{\%/.test(t)){var n=t.match(/^\{\%\s*(\w+)\s*(.*)?\%\}$/);if(n&&this.blockDelimiter==n[1])return void this.endTag()}this.nodelist.push(t||""),t=e.shift()}this.assertMissingDelimitation()},render:function(){return this.nodelist.join("")}})),Fera.Liquid.Template.registerTag("increment",Fera.Liquid.Tag.extend({tagSyntax:/((?:\(?[\w\-\.\[\]]\)?)+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(console.log(e,t,n),console.log(i[1]),!i)throw"Syntax error in 'assign' - Valid syntax: increment [var]";this.name=i[1],this._super(e,t,n)},render:function(e){var t=this.name,n="";return e.registers.increment||(e.registers.increment={}),e.registers.increment[t]||(e.registers.increment[t]=0),n=String(e.registers.increment[t]),e.registers.increment[t]++,n}})),Fera.Liquid.Template.registerTag("decrement",Fera.Liquid.Tag.extend({tagSyntax:/((?:\(?[\w\-\.\[\]]\)?)+)/,init:function(e,t,n){var i=t.match(this.tagSyntax);if(console.log(e,t,n),console.log(i[1]),!i)throw"Syntax error in 'assign' - Valid syntax: decrement [var]";this.name=i[1],this._super(e,t,n)},render:function(e){var t=this.name,n="";return e.registers.decrement||(e.registers.decrement={}),e.registers.decrement[t]||(e.registers.decrement[t]=-1),n=String(e.registers.decrement[t]),e.registers.decrement[t]--,n}})),Fera.Liquid.Template.registerFilter({_HTML_ESCAPE_MAP:{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"},size:function(e){return e.length?e.length:0},downcase:function(e){return e.toString().toLowerCase()},upcase:function(e){return e.toString().toUpperCase()},capitalize:function(e){return Fera.Liquid.extensions.stringTools.capitalize(e.toString())},escape:function(e){var t=this;return e.replace(/[&<>"']/g,function(e){return t._HTML_ESCAPE_MAP[e]})},h:function(e){var t=this;return e.replace(/[&<>"']/g,function(e){return t._HTML_ESCAPE_MAP[e]})},"default":function(e,t){return Fera.Liquid.extensions.object.isEmpty(e)?t:e},truncate:function(e,t,n){if(!e||""==e)return"";t=t||50,n=n||"...";e.slice(0,t);return e.length>t?e.slice(0,t)+n:e},truncatewords:function(e,t,n){if(!e||""==e)return"";t=parseInt(t||15),n=n||"...";var i=e.toString().split(" "),r=Math.max(t,0);return i.length>r?i.slice(0,r).join(" ")+n:e},truncate_words:function(e,t,n){if(!e||""==e)return"";t=parseInt(t||15),n=n||"...";var i=e.toString().split(" "),r=Math.max(t,0);return i.length>r?i.slice(0,r).join(" ")+n:e},strip_html:function(e){return e.toString().replace(/<.*?>/g,"")},strip_newlines:function(e){return e.toString().replace(/\n/g,"")},join:function(e,t){return t=t||" ",e.join(t)},split:function(e,t){return t=t||" ",e.split(t)},sort:function(e){return e.sort()},reverse:function(e){return e.reverse()},replace:function(e,t,n){return n=n||"",e.toString().replace(new RegExp(t,"g"),n)},replace_first:function(e,t,n){return n=n||"",e.toString().replace(new RegExp(t,""),n)},newline_to_br:function(e){return e.toString().replace(/\n/g,"<br/>\n")},date:function(e,t){var n;return e instanceof Date&&(n=e),n instanceof Date||"now"!=e||(n=new Date),n instanceof Date||"number"!=typeof e||(n=new Date(1e3*e)),n instanceof Date||"string"!=typeof e||(n=new Date(Date.parse(e))),n instanceof Date?n.strftime(t):e},first:function(e){return e[0]},last:function(e){return(e=e)[e.length-1]},minus:function(e,t){return(Number(e)||0)-(Number(t)||0)},plus:function(e,t){return(Number(e)||0)+(Number(t)||0)},times:function(e,t){return(Number(e)||0)*(Number(t)||0)},divided_by:function(e,t){return(Number(e)||0)/(Number(t)||0)},modulo:function(e,t){return(Number(e)||0)%(Number(t)||0)},map:function(e,t){e=e||[];for(var n=[],i=0;i<e.length;i++)n.push(e[i][t]);return n},escape_once:function(e){var t=this;return e.replace(/["><']|&(?!([a-zA-Z]+|(#\d+));)/g,function(e){return t._HTML_ESCAPE_MAP[e]})},remove:function(e,t){return e.toString().replace(new RegExp(t,"g"),"")},remove_first:function(e,t){return e.toString().replace(t,"")},prepend:function(e,t){return""+(t||"").toString()+(e||"").toString()},append:function(e,t){return""+(e||"").toString()+(t||"").toString()}}),(new Date).strftime||(Date.ext={},Date.ext.util={},Date.ext.util.xPad=function(e,t,n){for(void 0===n&&(n=10);parseInt(e,10)<n&&1<n;n/=10)e=t.toString()+e;return e.toString()},Date.prototype.locale="en-GB",document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang&&(Date.prototype.locale=document.getElementsByTagName("html")[0].lang),Date.ext.locales={},Date.ext.locales.en={a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %T %Z",p:["AM","PM"],P:["am","pm"],x:"%d/%m/%y",X:"%T"},"undefined"!=typeof JSON?Date.ext.locales["en-US"]=JSON.parse(JSON.stringify(Date.ext.locales.en)):Date.ext.locales["en-US"]=Date.ext.locales.en,Date.ext.locales["en-US"].c="%a %d %b %Y %r %Z",Date.ext.locales["en-US"].x="%D",Date.ext.locales["en-US"].X="%r",Date.ext.locales["en-GB"]=Date.ext.locales.en,Date.ext.locales["en-AU"]=Date.ext.locales["en-GB"],Date.ext.formats={a:function(e){return Date.ext.locales[e.locale].a[e.getDay()]},A:function(e){return Date.ext.locales[e.locale].A[e.getDay()]},b:function(e){return Date.ext.locales[e.locale].b[e.getMonth()]},B:function(e){return Date.ext.locales[e.locale].B[e.getMonth()]},c:"toLocaleString",C:function(e){return Date.ext.util.xPad(parseInt(e.getFullYear()/100,10),0)},d:["getDate","0"],e:["getDate"," "],g:function(e){return Date.ext.util.xPad(parseInt(Date.ext.util.G(e)/100,10),0)},G:function(e){var t=e.getFullYear(),n=parseInt(Date.ext.formats.V(e),10),i=parseInt(Date.ext.formats.W(e),10);return n<i?t++:0===i&&52<=n&&t--,t},H:["getHours","0"],I:function(e){var t=e.getHours()%12;return Date.ext.util.xPad(0===t?12:t,0)},j:function(e){var t=e-new Date(e.getFullYear()+"/1/1 GMT");t+=6e4*e.getTimezoneOffset();var n=parseInt(t/6e4/60/24,10)+1;return Date.ext.util.xPad(n,0,100)},m:function(e){return Date.ext.util.xPad(e.getMonth()+1,0)},M:["getMinutes","0"],p:function(e){return Date.ext.locales[e.locale].p[12<=e.getHours()?1:0]},P:function(e){return Date.ext.locales[e.locale].P[12<=e.getHours()?1:0]},S:["getSeconds","0"],u:function(e){var t=e.getDay();return 0===t?7:t},U:function(e){var t=parseInt(Date.ext.formats.j(e),10),n=6-e.getDay(),i=parseInt((t+n)/7,10);return Date.ext.util.xPad(i,0)},V:function(e){var t=parseInt(Date.ext.formats.W(e),10),n=new Date(e.getFullYear()+"/1/1").getDay(),i=t+(4<n||n<=1?0:1);return 53==i&&new Date(e.getFullYear()+"/12/31").getDay()<4?i=1:0===i&&(i=Date.ext.formats.V(new Date(e.getFullYear()-1+"/12/31"))),Date.ext.util.xPad(i,0)},w:"getDay",W:function(e){var t=parseInt(Date.ext.formats.j(e),10),n=7-Date.ext.formats.u(e),i=parseInt((t+n)/7,10);return Date.ext.util.xPad(i,0,10)},y:function(e){return Date.ext.util.xPad(e.getFullYear()%100,0)},Y:"getFullYear",z:function(e){var t=e.getTimezoneOffset();return(0<t?"-":"+")+Date.ext.util.xPad(parseInt(Math.abs(t/60),10),0)+Date.ext.util.xPad(t%60,0)},Z:function(e){return e.toString().replace(/^.*\(([^)]+)\)$/,"$1")},"%":function(){return"%"}},Date.ext.aggregates={c:"locale",D:"%m/%d/%y",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"locale",X:"locale"},Date.ext.aggregates.z=Date.ext.formats.z(new Date),Date.ext.aggregates.Z=Date.ext.formats.Z(new Date),Date.ext.unsupported={},Date.prototype.strftime=function(e){this.locale in Date.ext.locales||(this.locale.replace(/-[a-zA-Z]+$/,"")in Date.ext.locales?this.locale=this.locale.replace(/-[a-zA-Z]+$/,""):this.locale="en-GB");for(var i=this;e.match(/%[cDhnrRtTxXzZ]/);)e=e.replace(/%([cDhnrRtTxXzZ])/g,function(e,t){var n=Date.ext.aggregates[t];return"locale"==n?Date.ext.locales[i.locale][t]:n});var t=e.replace(/%([aAbBCdegGHIjmMpPSuUVwWyY%])/g,function(e,t){var n=Date.ext.formats[t];return"string"==typeof n?i[n]():"function"==typeof n?n.call(i,i):"object"==typeof n&&"string"==typeof n[0]?Date.ext.util.xPad(i[n[0]](),n[1]):t});return i=null,t}),split=split||function(u){var n,d=String.prototype.split,f=/()??/.exec("")[1]===u;return n=function(e,t,n){if("[object RegExp]"!==Object.prototype.toString.call(t))return d.call(e,t,n);var i,r,a,o,s=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),c=0;t=new RegExp(t.source,l+"g");for(e+="",f||(i=new RegExp("^"+t.source+"$(?!\\s)",l)),n=n===u?-1>>>0:n>>>0;(r=t.exec(e))&&!(c<(a=r.index+r[0].length)&&(s.push(e.slice(c,r.index)),!f&&1<r.length&&r[0].replace(i,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===u&&(r[e]=u)}),1<r.length&&r.index<e.length&&Array.prototype.push.apply(s,r.slice(1)),o=r[0].length,c=a,s.length>=n));)t.lastIndex===r.index&&t.lastIndex++;return c===e.length?!o&&t.test("")||s.push(""):s.push(e.slice(c)),s.length>n?s.slice(0,n):s},String.prototype.split=function(e,t){return n(this,e,t)},n}(),Fera.LocalStorageJar=function(e){var r=this;r.localStorageEnabled=!1;var t=function(){r.localStorageEnabled=n(),r.cookieJar=e.cookieJar||new Fera.CookieJar,r.namespace=e.namespace||"Fera"};r.clear=function(){if(!r.localStorageEnabled)return!0;for(var e=Object.keys(window.localStorage),t=0;t<e.length;t++)0===e[t].indexOf(r.namespace)&&window.localStorage.removeItem(e[t])},r.setItem=function(e,t,n){r.localStorageEnabled?(e=a(e),t={value:t,timestamp:n?(new Date).getTime()+n:null},t=Fera.Util.encode(JSON.stringify(t)),window.localStorage.setItem(e,t)):n?r.cookieJar.setCookie(e,t,n/24*60*60*1e3):r.cookieJar.setCookie(e,t)},r.getItem=function(e,t){try{if(e=a(e),t=t||null,r.localStorageEnabled){var n=window.localStorage.getItem(e);return n||-1===e.indexOf("Fera.")||(n=window.localStorage.getItem(e.replace("Fera.","BananaStand."))),n||0!==e.indexOf("Fera.")||(n=window.localStorage.getItem(e.replace("Fera.","Fera-Fera."))),n||0!==e.indexOf("Fera.Skill.")||(n=window.localStorage.getItem(e.replace("Fera.Skill","fera-skill-"))),n||0!==e.indexOf("Fera-")||(n=window.localStorage.getItem(e.replace("Fera-","Fera.").replace("Fera.Fera.","Fera."))),n?(n=JSON.parse(Fera.Util.decode(n))).timestamp?(new Date).getTime()<n.timestamp?n.value:t:n.value:t}return r.cookieJar.getCookie(e)}catch(i){return null}},r.setObject=function(e,t,n){return r.setItem(e,t,n)},r.getObject=function(e,t){return r.getItem(e,t)},r.removeItem=function(e){e=a(e),r.localStorageEnabled&&(window.localStorage.removeItem(e),window.localStorage.removeItem(e.replace("Fera.","BananaStand.")),window.localStorage.removeItem(e.replace("Fera.","Fera-Fera.")),window.localStorage.removeItem(e.replace("Fera.","Fera.Fera.")),window.localStorage.removeItem(e.replace("Fera.","Fera-Fera.")))};var a=function(e){return""!==r.namespace&&(e=r.namespace+"."+e),e},n=function(){var e="Fera.LocalStorageJar.test";try{return window.localStorage.setItem(e,"test"),window.localStorage.removeItem(e),!0}catch(t){return!1}};t()},Fera.Logger=function(t){t=t||{};var e=this,n=function(){};e.info=function(e){!t.optionsParser.hasUrlFlag("fera_quiet")&&t.debugMode&&window.console&&!Fera.Util.ie()&&("string"==typeof e&&(e="[Fera.ai] "+e),console.info.apply(this,arguments))},e.log=function(e){!t.optionsParser.hasUrlFlag("fera_quiet")&&t.debugMode&&window.console&&!Fera.Util.ie()&&("string"==typeof e&&(e="[Fera.ai] "+e),console.log.apply(this,arguments))},e.logWarning=function(e){!t.optionsParser.hasUrlFlag("fera_quiet")&&t.debugMode&&window.console&&!Fera.Util.ie()&&("string"==typeof e&&(e="[Fera.ai] "+e),console.warn.apply(this,arguments))},e.warn=function(e){t.optionsParser.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||("string"==typeof e&&(e="[Fera.ai] "+e),console.warn.apply(this,arguments))},e.error=function(e){window.console&&!Fera.Util.ie()&&("string"==typeof e&&(e="[Fera.ai] "+e),console.error.apply(this,arguments))},n()},Fera.OptionsParser=function(t){t=t||{};var a=this,e=function(){a.urlParams=a.getJsonFromUrl(),a.previewMode=a.hasPreviewFilterById(),a.feraParams=i(),a.urlParams.fera&&t.app.push(a.urlParams.fera,a.getFeraActionParams()),n()};a.getFeraActionParams=function(){for(var e=Object.keys(a.feraParams),t={},n=0;n<e.length;n++){var i=e[n];-1===["debug","test","preview","admin","shopper"].indexOf(i)&&(t[i]=a.feraParams[i])}return t},a.getJsonFromUrl=function(e){var t;if(e){var n=location.href.indexOf("?");if(-1==n)return[];t=location.href.substr(n+1)}else t=location.search.substr(1);var s={};return t.split("&").forEach(function(e){if(e){var t=(e=e.split("+").join(" ")).indexOf("="),n=-1<t?e.substr(0,t):e,i=-1<t?decodeURIComponent(e.substr(t+1)):"",r=n.indexOf("[");if(-1==r)s[decodeURIComponent(n)]=i;else{var a=n.indexOf("]",r),o=decodeURIComponent(n.substring(r+1,a));n=decodeURIComponent(n.substring(0,r)),s[n]||(s[n]=[]),o?s[n][o]=i:s[n].push(i)}}}),s},a.showContainer=function(e,t){var n=a.urlParams.fera_preview||a.urlParams.preview;return!n||(a.hasPreviewFilterById()?parseInt(n)===t:n===e)},a.getPreviewId=function(){return parseInt(a.urlParams.fera_preview||a.urlParams.preview)},a.hasPreviewFilterById=function(){var e=a.urlParams.fera_preview||a.urlParams.preview;return/^[0-9]+$/i.test(e)},a.hasUrlFlag=function(e){var t=new RegExp("((.*)(([?&])"+e+"=)(t|1|y|true|yes|on))(.*)","i");return-1!==window.location.toString().search(t)},a.hasUrlFlagOff=function(e){var t=new RegExp("((.*)(([?&])"+e+"=)(f|0|n|false|no|off))(.*)","i");return-1!==window.location.toString().search(t)},a.parseTestMode=function(){return a.hasUrlFlag("test_mode")||a.hasUrlFlag("fera_test")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("TEST Mode activated via URL params."),!0):t.testMode?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("TEST Mode activated via initialization options."),!0):"t"===t.cookieJar.getCookie("Fera.SandboxTest.Enabled")&&(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("TEST Mode activated via sandbox cookie."),t.cookieJar.setCookie("Fera.SandboxTest.Enabled","t",1),!0)},a.parseSandboxMode=function(){return a.hasUrlFlag("fera_sandbox")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("SANDBOX Mode activated via URL params."),t.cookieJar.setCookie("Fera.SandboxTest.Enabled","t",1),!0):-1!==["yes","true","1","t","on",!0,1].indexOf(t.cookieJar.getCookie("Fera.SandboxTest.Enabled",!1))?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("SANDBOX Mode activated via sandbox cookie."),!0):void 0},a.parseShowErrors=function(){return!!window.feraShowErrors||(!!t.cookieJar.getCookie("Fera.ShowErrors",!1)||a.feraParams.show_errors)},a.parseDebugMode=function(){return!(!window.__bsioDebugMode&&!window.feraDebugMode)||(!!t.cookieJar.getCookie("Fera.DebugMode",!1)||(a.hasUrlFlag("debug_mode")||a.hasUrlFlag("fera_debug")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("DEBUG Mode activated via URL params."),!0):!!t.debugMode&&(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("DEBUG Mode activated via initialization options."),!0)))},a.parseAdminMode=function(){var e=r();return t.adminSessionToken=a.urlParams.fera_site_com_token||a.urlParams.fera_admin_session,t.adminSessionToken?t.cookieJar.setCookie("Fera.Admin.SessionToken",t.adminSessionToken,30):t.adminSessionToken=t.cookieJar.getCookie("Fera.Admin.SessionToken"),e},a.parseCheckIntegration=function(){return!(!a.urlParams||!a.urlParams.check_integration_type)&&(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("Integration Checking enabled: "+a.urlParams.check_integration_type),a.urlParams.check_integration_type)};var n=function(){a.sandboxMode=a.parseSandboxMode();var e=window.feraAdminSandboxStatus;a.sandboxStatus=e?parseInt(e):200,a.sandboxError=a.sandboxMode&&400<=a.sandboxStatus},i=function(){for(var e=Object.keys(a.urlParams),t={},n=0;n<e.length;n++){var i=e[n];if(0===i.indexOf("fera_")){var r=i.substr(5);t[r]=a.urlParams[i],-1!==["yes","true","1","t","on"].indexOf(t[r])&&(t[r]=!0),-1!==["no","false","","off"].indexOf(t[r])&&(t[r]=!1)}}return t},r=function(){return!!a.urlParams.show_element_selector||(!!a.urlParams.ensure_loaded_cart||(a.hasUrlFlag("admin_mode")||a.hasUrlFlag("fera_admin")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("ADMIN Mode activated via URL params."),t.cookieJar.setCookie("Fera.Admin.Enabled","t",1),!0):a.hasUrlFlagOff("admin_mode")||a.hasUrlFlagOff("fera_admin")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("ADMIN Mode DEactivated via URL params."),t.cookieJar.setCookie("Fera.Admin.Enabled","f",1),!1):"t"===t.cookieJar.getCookie("Fera.Admin.Enabled")?(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("ADMIN Mode active via cookie."),!0):!!t.adminMode&&(a.hasUrlFlag("fera_quiet")||!window.console||Fera.Util.ie()||console.info("ADMIN Mode activated via initialization options."),t.cookieJar.setCookie("Fera.Admin.Enabled","t",1),!0)))};e()},Fera.PopupNotification=function(e){var n,r=this,a=e.$,t=!1,i=function(){r.notif=e.notif,r.$el=e.$el,r.$container=e.container,r.$el.on("mouseenter",function(){!0}),r.$el.on("mouseleave",function(){!1})};r.attach=function(){return!(t||!r.$el)&&(r.$el.hide(),r.$container.append(r.$el),t=!0)},r.detach=function(){return!(!t||!r.$el)&&(r.$el.hide(),r.$el.remove(),!(t=!1))},r.destroy=function(){r.detach(),r.$el=null},r.hideAndDetach=function(e,t,n){r.hide(e,t,function(){r.detach(),n&&n()})},r.hide=function(e,t,n){n=n||function(){};var i=-1===t.indexOf("top")?"bottom":"top";"slide_and_fade"===e?(r.$el.css("opacity",1),r.$el.css(i,""),r.$el.css("-webkit-transition",i+" 1s ease, opacity 1s ease"),r.$el.css("opacity",0),r.$el.css(i,o()),setTimeout(n,1e3)):"fade"===e?(r.$el.css("opacity",1),r.$el.css("-webkit-transition","opacity 1s ease"),r.$el.css("opacity",0),setTimeout(n,1e3)):"slide"===e?(r.$el.css(i,""),r.$el.css("-webkit-transition",i+" 1s ease"),r.$el.css(i,o()),setTimeout(n,1e3)):n()},r.attached=function(){return t},r.ensureLoadThenShow=function(e,t,n){var i=r.$el.find("img").attr("src");i&&"string"==typeof i?a("<img>").on("load",function(){s(e,t,n)}).on("error",function(){s(e,t,n)}).attr("src",i):s(e,t,n)},r.initiateCountdown=function(t){n&&clearInterval(n),r.$el.find(".banana-notification-countdown, .fera-notification-countdown").each(function(){var e=a(this);e.data("seconds",t),e.text(t),n=setInterval(function(){e.data("seconds",e.data("seconds")-1),0==e.data("seconds")?(clearInterval(n),e.text("")):e.text(e.data("seconds"))},1e3)})};var o=function(){return-100},s=function(e,t,n){n=n||function(){};var i=-1===t.indexOf("top")?"bottom":"top";"slide_and_fade"===e?(r.$el.css(i,o()),r.$el.css("opacity",0),r.$el.css("-webkit-transition",i+" 1s ease, opacity 1s ease"),r.$el.show(),r.$el.css("opacity",1),r.$el.css(i,"")):"fade"===e?(r.$el.css("opacity",0),r.$el.css("-webkit-transition","opacity 1s ease"),r.$el.show(),r.$el.css("opacity",1)):"slide"===e?(r.$el.css(i,o()),r.$el.css("-webkit-transition",i+" 1s ease"),r.$el.show(),r.$el.css(i,"")):r.$el.show(),n()};i()},Fera.SeenNotifTracker=function(e){var t,n=this,i=e.localStorage,r=e.storageKey,a=[],o=e.expireAfter||864e5,s=function(e){return Fera.Util.$()(e)},l=function(){f(),u(),d(),c()&&(n.clear(),e.logger.info("Clear notification history flag was detected, so no seen notifications will be assumed."))};n.getSeenIds=function(){return u(),s(a).map(function(){return this.id}).toArray()},n.updateExpiryTime=function(e){return t!=(o=1e3*e)&&(n.clear(),t=o),n},n.hasSeen=function(e){var t;u(),t="number"==typeof t?e:e.getId();for(var n=0;n<a.length;n++)if(a[n].id===t)return!0;return!1},n.markSeen=function(e){var t;(t="number"==typeof t?e:e.getId())<0||(a.push({id:t,expiresAt:(new Date).getTime()+o}),u(),d())},n.clear=function(){a=[],d()};var c=function(){return-1!==window.location.toString().search(/(.*)((\?|&)clear_notification_history=(t|1|y))/i)},u=function(){for(var e=[],t=0;t<a.length;t++){var n=a[t];n.expiresAt<=(new Date).getTime()||e.push(n)}a=e},d=function(){i.setItem(r,p())},f=function(){var e=i.getItem(r,{notifs:[],expireAfter:o});a=e.notifs,t=e.expireAfter},p=function(){return{notifs:a,expireAfter:o}};l()},Fera.TimeAgo=function(n){var t,i=this,e=n.language||"en",r={en:["2 seconds ago","2 minutes ago","2 hours ago","2 days ago","2 weeks ago","1 second ago","1 minute ago","1 hour ago","1 day ago","1 week ago"],es:["Hace 2 segundos","hace 2 minutos","Hace 2 horas","hace 2 d\xedas","hace 2 semanas","hace 1 segundo","Hace 1 minuto","1 hora antes","Hace 1 d\xeda","Hace 1 semana"],fr:["Il y a 2 secondes","Il y a 2 minutes","il y a 2 heures","il y a 2 jours","Il y a 2 semaines","Il y a 1 seconde","il y a 1 minute","Il ya 1 heure","il y a 1 jour","Il ya 1 semaine"],id:["2 detik yang lalu","2 menit yang lalu","2 jam lalu","2 hari yang lalu","2 minggu yang lalu","1 detik yang lalu","1 menit yang lalu","1 jam yang lalu","1 hari yang lalu","1 minggu yang lalu"],it:["2 secondi fa","2 minuti fa","2 ore fa","2 giorni fa","2 settimane fa","1 secondo fa","1 minuto fa","1 ora fa","1 giorno fa","1 settimana fa"],nl:["2 seconden geleden","2 minuten geleden","2 uur geleden","2 dagen geleden","2 weken geleden","1 seconde geleden","1 minuut geleden","1 uur geleden","1 dag geleden","1 week geleden"],no:["2 sekunder siden","2 minutter siden","2 timer siden","2 dager siden","2 uker siden","For 1 sekund siden","For 1 minutt siden","1 time siden","For 1 dag siden","1 uke siden"],pt:["2 segundos atr\xe1s","2 minutos atr\xe1s","2 horas atr\xe1s","2 dias atr\xe1s","2 semanas atr\xe1s","1 segundo atr\xe1s","1 minuto atr\xe1s","1 hora atr\xe1s","1 dia atr\xe1s","1 semana atr\xe1s"],ro:["Acum 2 secunde","acum 2 minute","2 ore \xeen urm\u0103","2 zile \xeen urm\u0103","acum 2 saptamani","Acum 1 secund\u0103","Acum 1 minut","1 or\u0103 \xeen urm\u0103","Acum o zi","1 s\u0103pt\u0103m\xe2n\u0103 \xeen urm\u0103"],sv:["2 sekunder sedan","f\xf6r 2 minuter sedan","2 timmar sedan","2 dagar sedan","2 veckor sedan","1 sekund sedan","1 minut sedan","1 timme sedan","1 dag sedan","1 vecka sedan"],th:["2 \u0e27\u0e34\u0e19\u0e32\u0e17\u0e35\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32","2 \u0e19\u0e32\u0e17\u0e35\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32","2 \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32","2 \u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27","2 \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27","1 \u0e27\u0e34\u0e19\u0e32\u0e17\u0e35\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32","1 \u0e19\u0e32\u0e17\u0e35\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32","1 \u0e0a\u0e31\u0e48\u0e27\u0e42\u0e21\u0e07\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27","1 \u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e41\u0e25\u0e49\u0e27","1 \u0e2a\u0e31\u0e1b\u0e14\u0e32\u0e2b\u0e4c\u0e17\u0e35\u0e48\u0e1c\u0e48\u0e32\u0e19\u0e21\u0e32"],"zh-TW":["2\u79d2\u524d","2\u5206\u9418\u524d","2\u5c0f\u6642\u524d","2\u5929\u524d","2\u500b\u661f\u671f\u524d","1\u79d2\u524d","1\u5206\u9418\u524d","1\u5c0f\u6642\u524d","1\u5929\u524d","1\u9031\u524d"]},a=n.tpl||r[e],o=function(){t=l()};this.toSeconds=function(){var e=new Date;return Math.floor((e.getTime()-t.getTime())/1e3)},this.toString=function(){var e,t=i.toSeconds();return(e=s(t,604800,9,4))?e:(e=s(t,86400,8,3))?e:(e=s(t,3600,7,2))?e:(e=s(t,60,6,1))?e:e=s(Math.max(t,1),1,5,0)};var s=function(e,t,n,i){if(1<=e/t){var r=Math.round(e/t);return 1===r?a[n].replace("1",r):a[i].replace("2",r)}return!1},l=function(){if("string"!=typeof n.time)return n.time;var e;e=n.time.indexOf("Z")===n.time.length-1?n.time.replace("Z"," GMT").replace("T"," ").replace(".000",""):n.time;var t=Date.parse(e);return t||(t=(new Date).getTime()-36e5,Fera.logger.error("Failed to parse time: ",n.time,n,i)),new Date(t)};o()},Fera.TimeTracker=function(n){var i=this;n=n||{};var r=3e4,a=0,o=1e3,s=!1,l=!1,c="default-page-name",u=[],d=[],f=[],p={},h=0,g=null,e=function(){g=n.localStorage;var e=r||30,t=t||window.location.pathname;e=n.idleTimeoutInSeconds||e,t=n.currentPageName||t,k(),C(e),x(t),L(),m(),setInterval(A,1e3)};i.getTimeOnCurrentPage=function(){return b(t(c))},i.getSessionTime=function(){var e=g.getItem(P(),(new Date).getTime());return Math.round(((new Date).getTime()-e)/1e3)},i.getTotalInteractionTime=function(){return Math.round(parseFloat(g.getItem(S())||0))},i.setTotalInteractionTime=function(e){g.setItem(S(),e)},i.getTimeSinceFirstSeen=function(){var e=g.getItem(F());return e?(e=Date.parse(e),Math.round((new Date-e)/1e3)):0},i.reset=function(){v();var e=new Date;g.setItem(F(),e),g.setItem(S(),0),g.setItem(P(),e.getTime()),g.setItem(T(),e.getTime()),p={},m()};var m=function(e){if(e||(e=c),p[e]===undefined)p[e]=[];else{var t=p[e],n=t[t.length-1];if(n!==undefined&&n.stopTime===undefined)return}p[e].push({startTime:new Date,stopTime:undefined}),s=!0},v=function(){for(var e=Object.keys(p),t=0;t<e.length;t++)y(e[t])},y=function(e){e||(e=c);var t=p[e];t!==undefined&&0!==t.length&&(t[t.length-1].stopTime===undefined&&(t[t.length-1].stopTime=new Date),s=!1)},b=function(e){return e===undefined?undefined:Math.round(e/1e3)},t=function(e){var t=p[e];if(t!==undefined){for(var n=0,i=0;i<t.length;i++){var r=t[i].startTime,a=t[i].stopTime;a===undefined&&(a=new Date),n+=a-r}return Number(n)}};i.getInactiveTimeOnPage=function(){var e=p[c];if(void 0===e||e.length<1)return 0;var t=e[e.length-1].stopTime;return t?b(Number(new Date-t)):0};var w,_,k=function(){g.getItem(F())||g.setItem(F(),new Date)},C=function(e){var t=parseFloat(e);if(!1!==isNaN(t))throw{name:"InvalidDurationException",message:"An invalid duration time ("+e+") was provided."};return r=1e3*e,i},x=function(e){return c=e,i},S=function(){return"TimeTracker.totalInteractionTime"},F=function(){return"TimeTracker.timeSinceFirstSeen"},P=function(){return"TimeTracker.sessionStartTime"},T=function(){return"TimeTracker.sessionLastUpdateTime"},I=function(){if(s){var e=i.getTimeOnCurrentPage(),t=e-h;if(!(t<=.1)){var n=i.getTotalInteractionTime();return n+=t,g.setItem(S(),n),h=e,n}}},A=function(){var e=g.getItem(T()),t=(new Date).getTime();3e3<t-e?g.setItem(P(),t):864e5<t-g.getItem(P(),t)&&g.setItem(P(),t);g.setItem(T(),t)},$=function(){l&&O(),l=!1,a=0},O=function(){if(!s)for(var e=0;e<f.length;e++){var t=f[e],n=t.numberOfTimesToInvoke;(isNaN(n)||n===undefined||0<n)&&(t.numberOfTimesToInvoke-=1,t.callback())}m()},E=function(){if(s)for(var e=0;e<d.length;e++){var t=d[e],n=t.numberOfTimesToInvoke;(isNaN(n)||n===undefined||0<n)&&(t.numberOfTimesToInvoke-=1,t.callback())}v()},D=function(){for(var e=I(),t=0;t<u.length;t++)u[t].pending&&e>u[t].timeInSeconds&&(u[t].callback(),u[t].pending=!1);!1===l&&r<a?(l=!0,E()):a+=o},L=function(){"undefined"!=typeof document.hidden?(_="hidden",w="visibilitychange"):"undefined"!=typeof document.mozHidden?(_="mozHidden",w="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(_="msHidden",w="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(_="webkitHidden",w="webkitvisibilitychange"),document.addEventListener(w,function(){document[_]?E():O()},!1),window.addEventListener("blur",function(){
E()}),window.addEventListener("focus",function(){O()}),document.addEventListener("mousemove",function(){$()}),document.addEventListener("keyup",function(){$()}),document.addEventListener("touchstart",function(){$()}),window.addEventListener("scroll",function(){$()}),setInterval(D,o)};i.callAfterTimeElapsedInSeconds=function(e,t){u.push({timeInSeconds:e,callback:t,pending:!0})},i.callWhenUserLeaves=function(e,t){d.push({callback:e,numberOfTimesToInvoke:t})},i.callWhenUserReturns=function(e,t){f.push({callback:e,numberOfTimesToInvoke:t})},e()},Fera.Timer=function(r){var a,o,s,l,n,e,t,c=this,i=(Fera.Util.$(),null),u=null,d=function(){c.timerTemplate=new Fera.TimerTemplate({template:r.timerTemplate,logger:r.logger}),r.padTimes="undefined"==typeof r.padTimes||r.padTimes,t=r.finishCallback||function(){},e=r.countCallback||function(){}};this.setTemplate=function(e){e&&(c.timerTemplate.template=e)},this.getTimeLeft=function(){return i},this.start=function(e,t){n=e,i=parseInt(t)||0==t?t:n,c.resume(),p()},this.reset=function(){i=n,f(),e(h(),i)},this.restart=function(){c.reset(),c.resume()},this.stop=function(){u&&clearInterval(u),!1},this.pause=c.stop,this.resume=function(){u&&clearInterval(u),u=setInterval(p,1e3),!0};var f=function(){a=r.showDays&&c.timerTemplate.templateHasDays()?Math.floor(i/86400):0,o=Math.floor(i/3600-24*a),s=Math.floor(i%3600/60),l=Math.floor(i%60)},p=function(){i-=1,f(),e(h(),i),i<=0&&(i=0,clearInterval(u),t())},h=function(){var e,t,n,i;return e=a<1?"":a,r.sentenceFormat?(e=a<1?"":g(a,"day"),t=o<1?"":g(o,"hour"),n=g(s,"minute"),i=g(l,"second")):r.padTimes?(t=o<10?"0"+o:o,n=s<10?"0"+s:s,i=l<10?"0"+l:l):(t=o,n=s,i=l),c.timerTemplate.render(e,t,n,i)},g=function(e,t){return e+" "+t+(1===e?"":"s")};d()},Fera.TimerTemplate=function(e){e=e||{};var c=this,t="[[%DAYS%:]][[%HOURS%:]]%MINUTES%:%SECONDS%",u=Fera.Util.$(),n=function(){c.template=e.template||t};this.templateHasDays=function(){return-1!==c.template.indexOf("%DAYS%")},this.render=function(e,t,n,i){var r,a,o,s=c.template,l=s.match(/(\[\[.*%DAYS%.*\]\])(\[\[.*%HOURS%.*\]\])(.*)/);return l?(r=l[1],a=l[2],o=l[3]):s.match(/(\[\[.*%HOURS%.*\]\])(.*)/)?(r="",a=(l=s.match(/(\[\[.*%HOURS%.*\]\])(.*)/))[1],o=l[2]):(a=r="",o=s),s=(s=(r=p(r,e))+(a=h(a,t))+o).replace("%DAYS%",e).replace("%HOURS%",t).replace("%MINUTES%",n).replace("%SECONDS%",i),s=d(s,n),s=f(s,i),0<c.template.indexOf(":")&&(s=u(s.split(":")).map(function(e){return 0<e&&this.match(/^[0-9]$/)?"0"+this:this}).toArray().join(":")),s};var d=function(e,t){return e=1==t?e.replace(/\[m\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,""):e.replace(/\[m\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,"$1")},f=function(e,t){return e=1==t?e.replace(/\[s\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,""):e.replace(/\[s\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,"$1")},p=function(e,t){return 0==t?e="":(e=e.replace("[[","").replace("]]",""),e=1===t?e.replace(/\[d\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,""):e.replace(/\[d\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,"$1")),e},h=function(e,t){return 0==t?e="":(e=e.replace("[[","").replace("]]",""),e=1==t?e.replace(/\[h\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,""):e.replace(/\[h\*([a-z\u0391-\u03a9\u03b1-\u03c9\u03af\u03ca\u0390\u03cc\u03ac\u03ad\u03cd\u03cb\u03b0\u03ae\u03ce]+)\]/i,"$1")),e};n()},Fera.TitleBarManager=function(e){e=e||{};var t,n=this,i=function(){t=document.title,t};n.setTitle=function(e){document.title,document.title=e,e},n.resetToOriginal=function(){document.title,document.title=t,t},i()},Fera.Util={toTitleCase:function(e){return e.replace(/\w\S*/g,function(e,t,n){return 0<e.indexOf(".")&&e.indexOf(".")<e.length-1?e.toUpperCase():e.length<=3&&(","===e.trim().substr(-1)||e.length+t===n.length)&&(0<t&&","===n.substr(t-1,1)||1<t&&","===n.substr(t-2,1))?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},truncateTextToMaxWidth:function(e){var i=this.$();e.each(function(){var e=i(this),t=parseFloat(e.css("max-width"));if(e.width()>t)for(var n=e.html().trim();e.width()>t;)n=n.slice(0,-1),e.html(n+"...")})},debounce:function(n,i,r){var a;return function(){var e=this,t=arguments;clearTimeout(a),a=setTimeout(function(){a=null,r||n.apply(e,t)},i),r&&!a&&n.apply(e,t)}},throttle:function(i,r,a){var o,s;return function(){var e=this,t=arguments,n=(new Date).getTime();if(!s||s+r<n)return s=(new Date).getTime(),i.apply(e,t);a&&(o=o||setTimeout(function(){o=null,s=(new Date).getTime(),i.apply(e,t)},r-(n-s)))}},generateUUID:function(){var n=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},isFullyVisible:function(e){if(e.data("always_visible"))return!0;if((Object&&Object.getPrototypeOf?Object.getPrototypeOf(e).jquery:$&&$.zepto)&&!e.is(":visible"))return!1;if(!this.isScrolledIntoView(e))return!1;if("none"==e.css("display")||"hidden"==e.css("visibility")||0==e.css("opacity"))return!1;for(var t=e.parent();"BODY"!==t.prop("tagName");){if("hidden"==t.css("visibility")||0==t.css("opacity"))return!1;t=t.parent()}return!0},parseBool:function(e){return void 0!==e&&-1!==[1,"1","true","t","yes",!0,2].indexOf(e)},outerHeight:function(e){var t,n,i=e.get(0);if(navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 9.")){var r=i.offsetHeight,a=getComputedStyle(i);return r+parseInt(a.marginTop)+parseInt(a.marginBottom)}return"undefined"!=typeof i.offsetHeight?i.offsetHeight:("number"!=typeof(t=document.defaultView.getComputedStyle(i,"").getPropertyValue("height"))&&(t=0),n=parseInt(document.defaultView.getComputedStyle(i,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(i,"").getPropertyValue("margin-bottom")),parseFloat(t)+parseFloat(n))},isHome:function(){return-1===window.location.toString().replace(/^https?:\/\/([a-zA-Z0-9_\-.]+)\/?([?#][#a-z=\-_A-Z0-9&]+)?$/i,"$1").indexOf("/")},updateURLParameter:function(e,t,n){var i="",r=e.split("?"),a=r[0],o=r[1],s="";if(o){r=o.split("&");for(var l=0;l<r.length;l++)r[l].split("=")[0]!=t&&(i+=s+r[l],s="&")}var c=a+"?"+i;return null!==n&&(c+=s+t+"="+n),c===a+"?"?a:c},isFullyInvisible:function(e){return!this.isFullyVisible(e)},isScrolledIntoView:function(e){var t=Fera.Util.$()(window).scrollTop(),n=t+Fera.Util.$()(window).height(),i=e.offset().top;return i+e.height()<=n&&t<=i},scrollToElement:function(i,r){(r="object"==typeof r?r:{}).duration="undefined"==typeof r.duration?200:r.duration,r.callback=r.callback||function(){},r.position="undefined"==typeof r.position?"center":r.position;var a,o=Fera.Util.$()(window),s=r.duration,l=10,c=(new Date).getTime(),u=this,d=function(){var e=i.offset().top,t=window.innerHeight||o.height(),n=u.outerHeight(i);return"center"===r.position&&n<t&&(e-=t/2,e+=n/2),e},f=setInterval(function(){if(a=(new Date).getTime(),s-=l=a-c,!i.offset()||0===i.offset().top)return clearInterval(f),r.callback(i);var e=d();if(s<=0)return o.scrollTop(e),clearInterval(f),r.callback(i);var t,n=o.scrollTop()-e;t=r.duration-s<100?n/(s/l*2):s<100?n/(s/l):n/((s-50)/l),o.scrollTop(o.scrollTop()-t),c=(new Date).getTime()},10)},addZepto:function(e,t){t=t||function(){},new FeraCachedAsset({name:"zepto",version:"1.2.0",expiresIn:(e=e||{}).devMode?15:900,url:"https://cdn.fera.ai/js/lib/zepto"+(e.debugMode?"":".min")+".js"}).load(t)},$:function(){return"undefined"!=typeof jQuery?jQuery:"undefined"!=typeof $&&"undefined"!=typeof $.fn&&"undefined"!=typeof $.fn.jquery?$:"undefined"!=typeof Zepto?Zepto:(Fera.logger.warn("Something must have removed jQuery/Zepto because it is no longer present after the application has already started. Zepto will be added in now."),this.addZepto(),null)},showWithoutTransform:function(e){e.show().css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:""})},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},shuffleArray:function(e){var t,n,i;for(i=e.length-1;0<i;i--)t=Math.floor(Math.random()*(i+1)),n=e[i],e[i]=e[t],e[t]=n;return e},isNullOrEmpty:function(e){return!e||e===undefined||""===e||0===e.length},detectBrowser:function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))},ie:function(){return 0===this.detectBrowser().indexOf("IE")||-1!==this.detectBrowser().indexOf("MSIE")},maxGetRequestChars:function(){return-1!==this.detectBrowser().indexOf("MSIE")?2e3:6e3},sizeOfParams:function(e){return encodeURI(Fera.Util.$().param(e)).split(/%..|./).length-1},_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,i,r,a,o,s,l="",c=0;for(e=this._utf8_encode(e);c<e.length;)r=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(n=e.charCodeAt(c++))>>4,o=(15&n)<<2|(i=e.charCodeAt(c++))>>6,s=63&i,isNaN(n)?o=s=64:isNaN(i)&&(s=64),l=l+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(s);return l},decode:function(e){var t,n,i,r,a,o,s="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(r=this._keyStr.indexOf(e.charAt(l++)))>>4,n=(15&r)<<4|(a=this._keyStr.indexOf(e.charAt(l++)))>>2,i=(3&a)<<6|(o=this._keyStr.indexOf(e.charAt(l++))),s+=String.fromCharCode(t),64!=a&&(s+=String.fromCharCode(n)),64!=o&&(s+=String.fromCharCode(i));return s=this._utf8_decode(s)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t},_utf8_decode:function(e){for(var t="",n=0,i=c1=c2=0;n<e.length;)(i=e.charCodeAt(n))<128?(t+=String.fromCharCode(i),n++):191<i&&i<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),n+=3);return t},jsonHasArray:function(e){for(var t in e)if(e[t]&&"object"==typeof e[t]&&e[t].constructor===Array)return!0;return!1},httpMethodToUse:function(e){return this.sizeOfParams(e)>this.maxGetRequestChars()||this.jsonHasArray(e)?"POST":"GET"}},Fera.VariantLoader=function(n){var i=this;n=n||{};var e=Fera.Util.$(),t=function(){i.$form=e('form[action~="/cart/add"]'),i.variantId=null,i.loadVariant(),i.$form.find(":input").on("change",function(){setTimeout(function(){i.loadVariant(!0)},1)}),i.onUrlChange(function(){i.loadVariant(!0)})};i.onUrlChange=function(t){e(window).on("hashchange",t);var n=window.location.toString();setInterval(function(){var e=window.location.toString();e!==n&&(n=e,t())},100)},i.loadVariant=function(e){void 0===e&&(e=!1),i.findVariantId(),n.app.getVariantId()!==i.variantId&&(n.app.setVariantId(i.variantId),e&&n.app.refreshContent())},i.findVariantId=function(){if(i.variantId=r(),i.variantId&&""!==i.variantId)return i.variantId;var e=i.$form.serializeArray().find(function(e){return"id"===e.name});if(e)return i.variantId=e.value,i.variantId;var t=n.app.getProduct();return t?t.variants[0].id:null};var r=function(){var e=/variant=(.*?)(&|$)/,t=window.location.href.match(e);return t?parseInt(t[1]):null};t()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.Verifier=function(){function t(e){_classCallCheck(this,t),this._opts=e,this.$=Fera.Util.$(),this._skillSelectorsToVerify=[],this._popovers=[],this.app=this._opts.app,this._opts.app.on("skill.create",this._onSkillCreate.bind(this)),this._opts.app.on("notification.show",this._onNotifShow.bind(this)),this._opts.debugMode&&(window.verifier=this)}return _createClass(t,[{key:"_onSkillCreate",value:function n(e){e.settings&&e.settings.show_verification&&e.$el&&(e.$el.length<1||("product_detail_counter"!=e.type||e.$el.is(".fera-recentOrderCount")?"product_list_counter"==e.type&&this._skillSelectorsToVerify.push(e.$el):this._skillSelectorsToVerify.push(e.$el.find(".banana-sentence,.fera-sentence")),this._attachPopovers()))}},{key:"addVerificationIcon",value:function r(e,t){var n=arguments.length<=1||t===undefined?{}:t,i=this.$(this.constructor._iconTpl(n));return e.append(i),this._attachPopover(e),i}},{key:"_attachPopovers",value:function e(){var n=this;this._skillSelectorsToVerify.forEach(function(e){n.$(e).each(function(e,t){n._attachPopover(n.$(t))})})}},{key:"_onNotifShow",value:function i(e){e.settings.show_verification&&this.addNotifIcon(e.popup.$el)}},{key:"addNotifIcon",value:function a(e){var t=this;this._loadAssets(function(){t._notifIcon=new Fera.Verification.Icon({$target:e.find(".fera-event-time-ago"),iconTpl:t.constructor._iconTpl()}),t._notifIcon.show()})}},{key:"_attachPopover",value:function o(n){var i=this;n.data("fera-verifier-attached")||n.on("mouseenter",function(){i._loadAssets(function(){if(!n.data("fera-verifier-attached")){var e=new Fera.Verification.Popover(n);if(e.show(),i._popovers.push(e),1<i._popovers.length){var t=i._popovers.map(function(e){return e.getInstance()});t=t.filter(function(e){if(e)return e}),i._popovers[0].createOrUpdateSingleton(t)}n.addClass("fera-verified"),n.data("fera-verifier-attached",!0)}})})}},{key:"_setupListeners",value:function s(){var t,n=this;new MutationObserver(function(e){e.forEach(function(e){e.addedNodes&&(t||(t=setTimeout(function(){clearTimeout(t),n._attachPopovers()},10)))})}).observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}},{key:"_loadAssets",value:function l(t){var n=this;if(t=t||function(){},this._loadedAssets)return t();if(this._loadingAssets)return setTimeout(function(){return n._loadAssets(t)},50);this._loadingAssets=!0;var e="";e=-1!==this._opts.api.baseAppPath.indexOf("ngrok.")||-1!==this._opts.api.baseAppPath.indexOf("localhost")||-1!==this._opts.api.baseAppPath.indexOf("test-")?this._opts.api.baseAppPath+"/assets/public/fera.verification.js?v="+this.app.version:"https://cdn.jsdelivr.net/gh/feracommerce/ferajs@"+this.app.version+"/dist/fera.verification.js";var i=this._opts.debugMode?1:900;new FeraCachedAsset({name:"Fera.Verifcation.Js",url:e,expiresIn:i}).load(function(){try{n._setupListeners(),n._loadedAssets=!0,n._loadingAssets=!1,t()}catch(e){if(n._opts.debugMode)throw e}})}}],[{key:"_iconTpl",value:function c(e){return'<svg height="'+((arguments.length<=0||e===undefined?{}:e).height||16)+'" viewBox="0 0 28 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="fera-validation-icon fera-validation-icon--sm">\n            <path d="M8.08787 1.53793C8.08787 2.38731 7.39477 3.07586 6.53979 3.07586C5.68481 3.07586 4.99171 2.38731 4.99171 1.53793C4.99171 0.688554 5.68481 0 6.53979 0C7.39477 0 8.08787 0.688554 8.08787 1.53793Z" fill="#EF4323" class="fera-verification-icon-sm-1"></path>\n            <path d="M16.3635 1.66374C16.3635 2.51312 15.6704 3.20167 14.8155 3.20167C13.9605 3.20167 13.2674 2.51312 13.2674 1.66374C13.2674 0.814365 13.9605 0.125811 14.8155 0.125811C15.6704 0.125811 16.3635 0.814365 16.3635 1.66374Z" fill="#EF4323" class="fera-verification-icon-sm-2"></path>\n            <path d="M20.5 5.54887C20.5 6.39825 19.8069 7.0868 18.9519 7.0868C18.0969 7.0868 17.4038 6.39825 17.4038 5.54887C17.4038 4.69949 18.0969 4.01094 18.9519 4.01094C19.8069 4.01094 20.5 4.69949 20.5 5.54887Z" fill="#EF4323" class="fera-verification-icon-sm-3"></path>\n            <path d="M3.54806 5.44971C3.54806 6.29908 2.85496 6.98763 1.99998 6.98763C1.145 6.98763 0.451904 6.29908 0.451904 5.44971C0.451904 4.60033 1.145 3.91178 1.99998 3.91178C2.85496 3.91178 3.54806 4.60033 3.54806 5.44971Z" fill="#EF4323" class="fera-verification-icon-sm-4"></path>\n            <path d="M12.3526 5.54888C12.3526 6.39826 11.6595 7.08681 10.8045 7.08681C9.94953 7.08681 9.25643 6.39826 9.25643 5.54888C9.25643 4.6995 9.94953 4.01095 10.8045 4.01095C11.6595 4.01095 12.3526 4.6995 12.3526 5.54888Z" fill="#EF4323" class="fera-verification-icon-sm-5"></path>\n            <path d="M6.64421 10.5C6.64421 11.3494 5.95111 12.0379 5.09614 12.0379C4.24116 12.0379 3.54806 11.3494 3.54806 10.5C3.54806 9.65062 4.24116 8.96207 5.09614 8.96207C5.95111 8.96207 6.64421 9.65062 6.64421 10.5Z" fill="#EF4323" class="fera-verification-icon-sm-6"></path>\n            <path d="M12.3526 14.4621C12.3526 15.3115 11.6595 16 10.8045 16C9.94953 16 9.25643 15.3115 9.25643 14.4621C9.25643 13.6127 9.94953 12.9241 10.8045 12.9241C11.6595 12.9241 12.3526 13.6127 12.3526 14.4621Z" fill="#EF4323" class="fera-verification-icon-sm-7"></path>\n            <path d="M19 5.5L14.8155 1.53796L10.8045 6L6.34792 1.53796L2 5.5L5 10.5L10.8045 14.4621" stroke="#EF4323" class="fera-verification-icon-sm-8"></path>\n            <path d="M13.5872 9.66042L18.0438 14.4621L27 5" stroke="#00C48D" stroke-width="2" stroke-linejoin="round" class="fera-verification-icon-sm-9"></path>\n        </svg>'}}]),t}(),Fera.BaseContainer=function(e){e=e||{};var r=this,t=Fera.Util.$();r.id=e.id;var n=function(){r.$container=e.el,r.dataAttr=i(r.$container)};this.dispatchEvent=function(t,n,i){i=i||function(){},r.each(function(e){"function"==typeof e.dispatchEvent&&e.dispatchEvent(t,n,i)})},this.selector=function(){return r.$container},this.hasDataAttr=function(e){return r.dataAttr[e]&&""!=r.dataAttr[e]},this.getDataAttr=function(e){return r.dataAttr[e]};var i=function(e){var i={},r=/^data\-(.+)$/;return t.each(e.get(0).attributes,function(e,t){if(r.test(t.nodeName)){var n=t.nodeName.match(r)[1];i[n]=t.nodeValue}}),i};n()},Fera.CartContainer=function(){var e=this;this.onBecomeVisible=function(){},this.onBecomeInvisible=function(){},this.getContentRequest=function(){return null},this.updateContent=function(){},this.reset=function(){},this.empty=function(){},this.isVisible=function(){return Fera.Util.isFullyVisible(e.$container)}},Fera.CartContainer.resetCookies=function(e){var t=e.optionsParser.getPreviewId(),n="fera-cartContainer";t&&(n+="-preview_"+t),e.cookieJar.setCookie(n+"-cartItemIds","",1),e.cookieJar.setCookie(n+"-secondsLeft","undefined",1)},Fera.ContainerCollection=function(s){s=s||{};var e,l=this,i=Fera.Util.$(),c=[],t=0,n=!1,r=function(){l.locateNewContainers(),a(),setTimeout(function(){g(),o()},100)};this.updateContentFromCache=function(){l.globalBottom&&l.globalBottom.updateContentFromCache()},this.locateNewContainers=function(){var n=[];return i(".banana-container").each(function(){var e=s;if(e.el=i(this),!e.el.data("bsio-container-id")){var t=Fera.ContainerFactory.create(e.el.data("container_type"),e);t&&(c.push(t),n.push(t),t.constructor===Fera.GlobalBottomContainer&&(l.globalBottom=t))}}),l.length=c.length,n},this.triggerSkill=function(t,n){this.each(function(e){"undefined"!=typeof e.triggerSkill&&e.triggerSkill(t,n)})};var a=function(){20<l.length&&(n=!0)};this.size=function(){return c.length},this.updateContent=function(e,t,n){if(n=n||function(){},!e.content_responses)return s.logger.logWarning("Content responses result was empty so content couldn't be updated.",e),n();s.containersDirtyScheduler.reset();for(var i=0;i<e.content_responses.length;i++){var r=e.content_responses[i];if(r){var a=l.getContainerById(r.container_id);if(!a||a.isPreview)continue;try{a.updateContent(r)}catch(o){s.logger.error(o)}a.needsUpdate=!1,s.containersDirtyScheduler.collect(r.seconds_until_dirty,a)}else s.logger.logWarning("Fera did not receive persistent content for container so nothing was displayed for that container.",r)}return n()},this.markAllContainersAsDirty=function(){c&&l.each(function(e){e.needsUpdate=!0})},this.getContainerById=function(e){for(var t=0;t<c.length;t++){if(c[t].id==e)return c[t];if(c[t].abstractBlocks&&c[t].abstractBlocks[e])return c[t].abstractBlocks[e]}return null},this.getContentRequest=function(e,t){for(var n=[],i=void 0===t?c:t,r=0;r<i.length;r++){var a=i[r];if(a.needsUpdate){if(u(a))continue;var o=a.getContentRequest(e);if(!o){a.needsUpdate=!1;continue}o.container_id=a.id,n.push(o)}}return n};var u=function(e){return!!n&&(!e.isVisible()&&!e.alwaysVisible&&(t/1e3<(new Date).getTime()/1e3-60&&(t=(new Date).getTime()),!0))};this.findCurrentlyViewingProductId=function(){for(var e=0;e<c.length;e++){var t=c[e];if(t.constructor==Fera.ViewContainer)return t.getProductId()}return null},this.each=function(e){for(var t=0;t<c.length;t++)e(c[t],t);return this},this.find=function(e){for(var t=0;t<c.length;t++)if(e(c[t],t))return c[t];return null},this.toArray=function(){return c},this.indexOf=function(e){for(var t="number"==typeof e?e:e.id,n=0;n<c.length;n++)if(c[n].id==t)return n;return-1},this.removeByIndex=function(e){return c[e]?c.splice(e,1):(s.logger.logWarning("Could not remove container at index because it does not exist.",e),null)},this.remove=function(e){return l.removeByIndex(l.indexOf(e))},this.removeAll=function(e){for(var t=0;t<e.length;t++)l.remove(e[t]);return e},this.dispatchEvent=function(t,n,i){i=i||function(){},l.each(function(e){e.dispatchEvent&&e.dispatchEvent(t,n,i)})};var o=function(){l.each(function(e){e.wasVisible=e.isVisible()})},d=function(){var t=[],n=[];l.each(function(e){!e.isVisible()||e.wasVisible||e.alwaysVisible?e.isVisible()||!e.wasVisible||e.alwaysVisible||(n.push(e),e.wasVisible=!1):(t.push(e),e.wasVisible=!0)}),0<t.length&&o();var e=0;for(e=0;e<t.length;e++)t[e].onBecomeVisible&&t[e].onBecomeVisible();for(e=0;e<n.length;e++)n[e].onBecomeVisible&&n[e].onBecomeInvisible()},f=function(){var e=l.locateNewContainers();if(0<e.length){h();var t=l.getContentRequest({},e);return l.updateContainers(!1,function(){g()},t),!0}return!1},p=function(){var t=[];return l.each(function(e){i.contains(document.documentElement,e.$container[0])||t.push(e)}),l.removeAll(t),t},h=function(){clearInterval(e)},g=function(){e&&clearInterval(e),e=setInterval(function(){p(),f()?o():d()},100)};r()},Fera.ContainerFactory={create:function(e,t){t.id=Fera.ContainerFactory.nextContainerId();var n=!1;return"list"==e?n=new Fera.ListContainer(t):"global_bottom"==e&&(n=new Fera.GlobalBottomContainer(t)),n&&n.$container.data("bsio-container-id",t.id),n},nextContainerId:function(){return window.__bsioLastContainerId=window.__bsioLastContainerId||0,window.__bsioLastContainerId++,window.__bsioLastContainerId}},Fera.GlobalBottomContainer=function FeraGlobalBottomContainer(s){s=s||{};var l=this;l.baseContainer=new Fera.BaseContainer(s),l.id=s.id;var n,i=1,r="global_bottom";l.alwaysVisible=!0;var e=[],t=function(){l.needsUpdate=!0,(n={container:l,cookieJar:s.cookieJar,debugMode:s.debugMode,testMode:s.testMode,logger:s.logger,localStorage:s.localStorage,adminMode:s.adminMode,optionsParser:s.optionsParser,app:s.app,api:s.api,timeTracker:s.timeTracker}).engagementTracker=s.engagementTracker,l.abstractBlocks={},a()};this.updateContentFromCache=function(){return!(s.app.opts.testMode||s.app.opts.adminMode||s.app.opts.previewMode)&&(o(e),!0)},this.triggerSkill=function(n,i){this.each(function(e,t){parseInt(n)===parseInt(t)&&"undefined"!=typeof e.triggerSkill&&e.triggerSkill(i)})},this.each=function(e){for(var t=Object.keys(l.abstractBlocks),n=0;n<t.length;n++)e(l.abstractBlocks[t[n]],t[n],n);return this};var c=function(e){for(var t=[],n=864e5,i=0;i<e.length;i++){var r=e[i];r.cacheable&&t.push(r)}s.app.localStorage.setObject("Cache.DisplayerResponses",t,n)},a=function(){e=s.app.localStorage.getObject("Cache.DisplayerResponses",[])},o=function(e){var t=!1,n={};c(e);for(var i=0;i<e.length;i++){var r=e[i],a=r.campaign_id;l.hasPreview=l.hasPreview||r.isPreview;try{l.abstractBlocks[a]?(l.abstractBlocks[a].isPreview?(l.abstractBlocks[a].remove(),l.abstractBlocks[a]=u(r)):l.abstractBlocks[a].settings&&!l.abstractBlocks[a].settings.needs_updates||l.abstractBlocks[a].update(r),n[a]=!0):l.abstractBlocks[a]=u(r),Fera.Util.showWithoutTransform(l.$container),t=!0}catch(o){s.logger.error(o)}}return t||l.hasPreview},u=function(e){var t=new Fera.CustomContainer(n);return t.id=l.id.toString()+"_"+i++,t.create(e),t};this.updateContent=function(e,t){t=t||function(){};var n=!1;e.abstract_blocks&&o(e.abstract_blocks)&&(n=!0),n||l.$container.hide(),t(l)},this.getContentRequest=function(e){e=e||{};var t=l.dataAttr;return t.container_type=r,t},this.getDataAttr=l.baseContainer.getDataAttr,this.hasDataAttr=l.baseContainer.hasDataAttr,this.dataAttr=l.baseContainer.dataAttr,this.selector=l.baseContainer.selector,this.$container=l.baseContainer.$container,this.isVisible=function(){return Fera.Util.isFullyVisible(l.$container)},t()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions=Fera.Actions||{},Fera.Actions.Base=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"run",value:function n(){this._error("isStillThere must be implemented by Fera.Actions.CustomBlocks.Base")}},{key:"update",value:function i(){}}]),t}(Fera.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.ChangeBlockAction=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.skill=e,this.action=null}return _inherits(t,e),_createClass(t,[{key:"run",value:function n(){if(this.$target=this.$(this.skill.settings.target_selector),"hide"===this.skill.settings.target_action)this.action=this._createNewAction(this.$target,"hide");else if("move"===this.skill.settings.target_action){this.$destination=this.$(this.skill.settings.integration_selector);var e=this.skill.settings.integration_selector_action;this.action=this._createNewAction(this.$destination,e)}else this.action=this._createNewAction(this.$target,"replace");this.action&&this.action.run(this.skill)}},{key:"update",value:function i(){this.action&&this.action.update(this.skill)}},{key:"_createNewAction",value:function r(e,t){return"insert_after"===t?new Fera.Actions.CustomBlocks.InsertAfterAction(e):"insert_before"===t?new Fera.Actions.CustomBlocks.InsertBeforeAction(e):"append_to"===t?new Fera.Actions.CustomBlocks.AppendAction(e):"prepend_to"===t?new Fera.Actions.CustomBlocks.PrependAction(e):"replace"===t?new Fera.Actions.CustomBlocks.ReplaceAction(e):"hide"===t?new Fera.Actions.CustomBlocks.HideAction(e):(this._error("Unknown integration selector location configured.",this.skill.settings,e),null)}},{key:"remove",value:function a(){this.action&&this.action.remove()}}]),t}(Fera.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks=Fera.Actions.CustomBlocks||{},Fera.Actions.CustomBlocks.Base=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.$targetEl=e}return _inherits(t,e),_createClass(t,[{key:"isStillThere",value:function n(){return this.$.contains(document.documentElement,this.$el.get(0))}},{key:"makeChange",value:function i(){this._error("#makeChange must be implemented by Fera.Actions.CustomBlocks.Base")}},{key:"run",value:function r(e){if(this.$el&&this.isStillThere())return!1;this._setElement(e),this.makeChange()}},{key:"refreshOnTargetChange",value:function a(){return!1}},{key:"_setElement",value:function o(e){"hide"===e.settings.target_action?this.$el=this.$targetEl:"move"===e.settings.target_action?(this.$movePlaceHolder=this.$("<div></div>"),this.$el=this.$(e.settings.target_selector).replaceWith(this.$movePlaceHolder)):(this.$el=this.$(e.html.replace(/<!--[\s\S]*?-->/g,"").trim()),this.$el.attr("data-fera-skill",e.skillId))}},{key:"update",value:function s(e){return this.isStillThere()?this._updateBlock(e):this.run(e),!0}},{key:"remove",value:function l(){this.$el.remove(),this.$movePlaceHolder&&this.$movePlaceHolder.replaceWith(this.$el)}},{key:"_updateBlock",value:function c(e){"move"!==e.settings.target_action&&"hide"!==e.settings.target_action&&this.$el.html(this.$(e.html).html())}}]),t}(Fera.Actions.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.AppendAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$targetEl.append(this.$el)}},{key:"isStillThere",value:function i(){return this.$.contains(this.$targetEl.get(0),this.$el.get(0))}}]),t}(Fera.Actions.CustomBlocks.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.HideAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$targetEl.hide()}},{key:"isStillThere",value:function i(){return"none"==this.$targetEl.css("display")}},{key:"remove",value:function r(){this.$targetEl.show()}}]),t}(Fera.Actions.CustomBlocks.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype)
;var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.InsertAfterAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$targetEl.after(this.$el)}},{key:"isStillThere",value:function i(){return this.$.contains(this.$targetEl.parent().get(0),this.$el.get(0))}},{key:"refreshOnTargetChange",value:function r(){return!0}}]),t}(Fera.Actions.CustomBlocks.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.InsertBeforeAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$targetEl.before(this.$el)}},{key:"isStillThere",value:function i(){return this.$.contains(this.$targetEl.parent().get(0),this.$el.get(0))}},{key:"refreshOnTargetChange",value:function r(){return!0}}]),t}(Fera.Actions.CustomBlocks.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.PrependAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$targetEl.prepend(this.$el)}}]),t}(Fera.Actions.CustomBlocks.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Actions.CustomBlocks.ReplaceAction=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"makeChange",value:function n(){this.$oldElement=this.$targetEl.replaceWith(this.$el)}},{key:"remove",value:function i(){this.$el.replaceWith(this.$oldElement),_get(Object.getPrototypeOf(t.prototype),"remove",this).call(this)}}]),t}(Fera.Actions.CustomBlocks.Base),Fera.CustomContainer=function FeraCustomContainer(opts){opts=opts||{};var self=this,$=Fera.Util.$(),lastDisplayerResponse,campaignSettings,ran=!1,registeredEngagement=!1,keyPrefix,feraSkill,feraKeyPrefix,actions=new Fera.ActionCollection,triggered=!1,triggerDelay,init=function(){self.$globalTopContainer=opts.container.$container,self.$container=$('<div class="banana-container-row banana-custom-container"></div>'),self.$container.appendTo(self.$globalTopContainer)};this.create=function(jsonResponse){lastDisplayerResponse=jsonResponse,campaignSettings=lastDisplayerResponse.settings,ran=!1;var continueCreate=!0;keyPrefix="Fera.Skill."+jsonResponse.campaign_id,feraKeyPrefix="skill."+jsonResponse.campaign_id,self.app=opts.app,self.memory=new Fera.SkillsLocalStorage({logger:opts.logger,cookieJar:opts.cookieJar,namespace:keyPrefix}),self.localStorage=self.memory,lastDisplayerResponse.html&&(self.html=lastDisplayerResponse.html),self.options=self.settings=campaignSettings,self.storeSettings=lastDisplayerResponse.store,self.api=opts.api,self.adminMode=opts.adminMode,self.skillId=lastDisplayerResponse.campaign_id,self.isPreview=jsonResponse.isPreview||opts.optionsParser.getPreviewId()==self.skillId,self.type=lastDisplayerResponse.type,triggerEvent(keyPrefix+"-create-before"),triggerEvent("fera-skill-create-before"),triggerFeraEvent("skill.create:before"),eval(lastDisplayerResponse.js),"function"==typeof FeraSkill&&(feraSkill=new FeraSkill(self)),setupShopperActionTriggers(),setupTriggerDelays(),waitForRun(function then(){feraSkill&&feraSkill.run&&(continueCreate=feraSkill.run()),!1!==continueCreate?(markSeen(),registeredEngagement||(opts.engagementTracker.register(jsonResponse.campaign_id),registeredEngagement=!0),triggerEvent(keyPrefix+"-create-after"),triggerEvent("fera-skill-create-after"),triggerFeraEvent("skill.create"),triggerFeraEvent("skill.create:after"),triggerFeraEvent(feraKeyPrefix+".create"),feraSkill&&feraSkill.afterCreate&&feraSkill.afterCreate()):opts.logger.log("Creation blocked by Fera Skill",feraSkill)})};var canRunWithoutRepeating=function(){if(self.isPreview)return!0;if(!campaignSettings.trigger_repeat)return!0;var e=self.memory.get("last_seen");if(!e)return!0;var t=parseInt(e)+1e3*parseInt(campaignSettings.trigger_repeat);return(new Date).getTime()>t},markSeen=function(){self.memory.set("last_seen",(new Date).getTime())};this.getState=function(){return opts.app.getState()},this.update=function(e){if(ran){campaignSettings=(lastDisplayerResponse=e).settings,self.html=lastDisplayerResponse.html,self.settings=self.options=campaignSettings,triggerEvent(keyPrefix+"-update-before"),triggerEvent("fera-skill-update-before");var t=!0;waitForRun(function(){updateActions(),feraSkill&&feraSkill.update&&(t=feraSkill.update()),!1!==t?(triggerEvent(keyPrefix+"-update-after"),triggerEvent("fera-skill-update-after"),triggerFeraEvent(feraKeyPrefix+".update"),feraSkill&&feraSkill.afterUpdate&&feraSkill.afterUpdate()):opts.logger.log("Update blocked by Fera Skill",feraSkill)})}},this.hide=function(){self.$container.hide()},this.remove=function(){actions.remove(),feraSkill&&feraSkill.remove&&feraSkill.remove(),self.$container.remove()},this.triggerSkill=function(){triggered=!0};var setupTriggerDelays=function(){if(campaignSettings.trigger_value&&-1!==["after_time_on_page","after_time_on_site","after_inactive_time_on_page","after_time_since_first_seen"].indexOf(campaignSettings.trigger))if("string"==typeof campaignSettings.trigger_value)if(campaignSettings.trigger_value.match(/^[0-9]+$/))triggerDelay=parseInt(campaignSettings.trigger_value);else{var e=0,t=15;"random_1_to_15_sec"===campaignSettings.trigger_value||("random_15_to_60_sec"===campaignSettings.trigger_value?(e=15,t=60):"random_1_to_5_min"===campaignSettings.trigger_value?(e=60,t=900):Fera.logger.warn("Skill settings for trigger random range are invalid. Fell back on 1-15 seconds range.",campaignSettings)),(triggerDelay=Math.round(Math.random()*t)+e)<1&&(triggerDelay=1)}else triggerDelay=parseInt(campaignSettings.trigger_value)},setupShopperActionTriggers=function(){if("on_exit_intent"===campaignSettings.trigger)new Fera.ExitIntentDetector({onExitIntent:self.triggerSkill});else if(-1!==["on_click","on_mouseenter","on_mouseleave"].indexOf(campaignSettings.trigger)){var e=campaignSettings.trigger.replace("on_","");$(campaignSettings.trigger_value).on(e,self.triggerSkill)}},waitForRun=function(e){if(ran)return e();if("custom_action"==self.type||"change_block"==self.type)return e();if(runActions(),ran)return e();var t=setInterval(function(){if(runActions(),ran)return clearInterval(t),e()},10)},updateActions=function(){foreachTargetEl(function(e,t){var n=actions.get(t);if(n){if(n.$targetEl.get(0)!==e.get(0)){if(!n.refreshOnTargetChange())return;n.$targetEl=e}n.update(self),e.data("feraFoundExisting",!0)}}),foreachTargetEl(function(e){if(e.data("feraFoundExisting"));else{var t=createNewAction(e);actions.add(t),t.run(lastDisplayerResponse)}e.data("feraFoundExisting",null)}),pullElementsFromActions()},triggerConditionsMet=function(){if(triggered)return!0;if(self.isPreview&&opts.app.sandboxMode)return!0;if(!campaignSettings.trigger||"on_load"===campaignSettings.trigger)return!0;if("after_time_on_page"===campaignSettings.trigger){if(opts.timeTracker.getTimeOnCurrentPage()>=triggerDelay)return!0}else if("after_time_on_site"===campaignSettings.trigger){if(opts.timeTracker.getSessionTime()>=triggerDelay)return!0}else if("after_inactive_time_on_page"===campaignSettings.trigger){if(opts.timeTracker.getInactiveTimeOnPage()>=triggerDelay)return!0}else{if("after_time_since_first_seen"!==campaignSettings.trigger)return-1===["manual","on_click","on_mouseenter","on_mouseleave","on_exit_intent"].indexOf(campaignSettings.trigger)&&(Fera.logger.logWarning("Unknown trigger conditions so triggering now.",campaignSettings,self),!0);if(opts.timeTracker.getTimeSinceFirstSeen()>=triggerDelay)return!0}return!1},runActions=function(){triggerConditionsMet()&&canRunWithoutRepeating()&&(campaignSettings.integration_selector&&campaignSettings.integration_selector_action?createActions():ran=!0,actions.run(self),pullElementsFromActions())},pullElementsFromActions=function(){self.$el=$([]),actions.each(function(e){e.$el&&(self.$el=self.$el.add(e.$el))}),self.$el.data("fera-preview-container")&&1===self.$el.children().length&&(self.$el=self.$el.children()),self.$el.attr("data-fera-skill",self.skillId)},foreachTargetEl=function(n){var e=$(campaignSettings.integration_selector);if(e.length<1)return!1;e.each(function(e){var t=$(this);n(t,e)})},createActions=function(){if(lastDisplayerResponse.html){var n=!1;foreachTargetEl(function(e){var t=createNewAction(e);t&&(actions.add(t),n=!0)}),n&&(ran=!0)}},createNewAction=function(e){var t=campaignSettings.integration_selector_action;return"insert_after"===t?new Fera.Actions.CustomBlocks.InsertAfterAction(e):"insert_before"===t?new Fera.Actions.CustomBlocks.InsertBeforeAction(e):"append_to"===t?new Fera.Actions.CustomBlocks.AppendAction(e):"prepend_to"===t?new Fera.Actions.CustomBlocks.PrependAction(e):"replace"===t?new Fera.Actions.CustomBlocks.ReplaceAction(e):(opts.logger.error("Unknown integration selector location configured.",campaignSettings),null)},triggerEvent=function(n){!function(e){try{e(document).trigger(n,self)}catch(t){opts.logger.error(t),opts.adminMode&&opts.optionsParser.hasPreviewFilterById()&&alert("Your custom skill produced an error: "+t.message+" (see console for more info).\n\n**THIS MESSAGE WILL NOT APPEAR TO YOUR SHOPPERS ***")}}($)},triggerFeraEvent=function(e){try{opts.app.trigger(e,self)}catch(t){opts.logger.error(t),opts.adminMode&&opts.optionsParser.hasPreviewFilterById()&&alert("Your custom skill produced an error: "+t.message+" (see console for more info).\n\n**THIS MESSAGE WILL NOT APPEAR TO YOUR SHOPPERS ***")}};init()},Fera.SocialProofPopupContainer=function FeraSocialProofPopupContainer(){var e=this;this.update=function(){return!1},this.hide=function(){e.$container.hide()}},Fera.GlobalTopContainer=function FeraGlobalTopContainer(e){e=e||{};var n=this;n.baseContainer=new Fera.BaseContainer(e),n.id=e.id,n.alwaysVisible=!0;var t=function(){};this.updateContent=function(e,t){(t=t||function(){})(n)},this.getContentRequest=function(){return null},this.getDataAttr=n.baseContainer.getDataAttr,this.hasDataAttr=n.baseContainer.hasDataAttr,this.dataAttr=n.baseContainer.dataAttr,this.selector=n.baseContainer.selector,this.$container=n.baseContainer.$container,this.isVisible=function(){return Fera.Util.isFullyVisible(n.$container)},t()},Fera.PromoBarContainer=function(){this.update=function(){},this.hide=function(){},this.isVisible=function(){return!1}},Fera.ListContainer=function FeraListContainer(i){i=i||{};var r=this;r.baseContainer=new Fera.BaseContainer(i);i.api;var a,o=null;r.id=i.id;var e=!(r.type="product_list_counter"),t=function(){r.needsUpdate=!0};this.updateContent=function(e,t){t=t||function(){};var n=(a=e).persistent_content;r.$el=r.$container,r.skillId=a.campaign_id,r.settings=a.settings,r.isPreview=a.isPreview||i.optionsParser.getPreviewId()==r.skillId,r.$container.attr("data-fera-skill",r.skillId),"string"!=typeof n&&(i.logger.warn("New content was not a string even though it was expected to be one. It was set to an empty string.",e),n=""),o,(o=n)?r.showContent():r.hide(),t(r)},this.showContent=function(){null!=o&&(r.$container.html(o),this.hidden&&this.show(),i.app.trigger("skill.create",r),i.app.trigger("skill.create:after",r),i.app.trigger("skill."+r.skillId+".create",r),o&&""!==o&&(e||(i.engagementTracker.register(a.campaign_id),e=!0)))},this.hide=function(){this.hidden=!0,this.$container.hide()},this.show=function(){this.hidden=!1,this.$container.show()},this.getContentRequest=function(e){e=e||{};var t=r.dataAttr;return r.hasProductId()||(t.product_id=e.defaultProductId),t.container_type="list",t},this.getProductId=function(){return r.getDataAttr("product_id")},this.hasProductId=function(){return r.hasDataAttr("product_id")},this.getDataAttr=r.baseContainer.getDataAttr,this.hasDataAttr=r.baseContainer.hasDataAttr,this.dataAttr=r.baseContainer.dataAttr,this.selector=r.baseContainer.selector,this.$container=r.baseContainer.$container,this.isVisible=function(){return Fera.Util.isFullyVisible(r.$container)},t()},Fera.ViewContainer=function(e){var n=this;n.baseContainer=new Fera.BaseContainer(e),n.id=e.id,this.updateContent=function(e,t){if(t)return t(n)},this.clearSeenHistory=function(){},this.getContentRequest=function(){return null},this.getProductId=function(){return n.getDataAttr("product_id")},this.hasProductId=function(){return n.hasDataAttr("product_id")},this.getDataAttr=n.baseContainer.getDataAttr,this.hasDataAttr=n.baseContainer.hasDataAttr,this.dataAttr=n.baseContainer.dataAttr,this.selector=n.baseContainer.selector,this.$container=n.baseContainer.$container,this.isVisible=function(){return Fera.Util.isFullyVisible(n.$container)}},Fera.GetItByTimerContainer=function(){this.getContentRequest=function(){return null},this.update=function(){},this.hide=function(){}},Fera.ProductDetailCounterContainer=function(){this.getContentRequest=function(){return null},this.update=function(){},this.hide=function(){}},Fera.SocialProofFeedContainer=function(){this.getSeenNotifIds=function(){return[]},this.update=function(){},this.hide=function(){}},Fera.InstantClickSupport=function(i){var r=Fera.Util.$();i=i||{};var e=function(){"undefined"!=typeof InstantClick&&(i.logger.log("Instant Click was detected, so support module was loaded."),t())},t=function(){InstantClick.on("change",function(){var e=r(".banana-view-container").first(),t=i.app.getProductId();if(e&&0<e.length){var n=e.data("product_id");i.app.push("setProductId",{id:n})}else t&&i.app.push("setProductId",{id:null});i.app.refreshContent()})};e()},Fera.SkillsLocalStorage=function(e){var t,i=this,n=function(){t=new Fera.LocalStorageJar(e),i.memory=t.getObject("memory")||{}};i.set=function(e,t,n){return i.memory[e]={value:t,expiry:s(n)},r(),i},i.get=function(e,t){return i.memory[e]===undefined?t:o(e)?t:i.memory[e].value},i.reset=function(){return i.memory={},r(),a("Local storage was reset.",e.namespace),i};var r=function(){t.setObject("memory",i.memory)},a=function(){e.logger&&e.logger.log&&-1===Fera.Util.detectBrowser().indexOf("MSIE")&&e.logger.log.apply(this,arguments)},o=function(e){return null!==i.memory[e].expiry&&Date.now()>i.memory[e].expiry},s=function(e){return"number"!=typeof e?null:Date.now()+e};n()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.ActionCollection=function(){function e(){_classCallCheck(this,e),this._actions=[]}return _createClass(e,[{key:"add",value:function t(e){this._actions.push(e)}},{key:"run",value:function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._actions.forEach(function(e){e.run&&e.run.apply(e,t)})}},{key:"update",value:function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._actions.forEach(function(e){e.update&&e.update.apply(e,t)})}},{key:"each",value:function n(e){this._actions.forEach(e)}},{key:"remove",value:function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._actions.forEach(function(e){e.remove&&e.remove.apply(e,t)})}},{key:"get",value:function o(e){return this._actions[e]}}]),e}(),Fera.AdminElementSelector=function(u){var i=this;u=u||{};var r,a,d=Fera.Util.$(),n=(u.closeAfter,u.elementHeight||"15px"),f=u.elementDisplayType||"block",p=u.elementMinWidth||150,o=[],s=[],e=function(){t(),h(),i.running=!0,i.stopped=!1},t=function(){var t,n=20;d("body","*").on("mousemove",function(e){i.running&&(10<(n+=1)&&(w(e),n=0),t&&clearTimeout(t),t=setTimeout(function(){n=20},100))}),d("body","*").on("click",function(e){if(i.running&&!i.stopped){var t=e||window.event;t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0);var n=d(".fera-highlight");n.hasClass("fera-highlight-invalid")?alert("This element cannot be used as an integration point because it does not have a specific enough class or ID. Please contact your developer or the Fera support team for help with modifying your store's content if you really want it at this location."):(r||g(n),c())}}),d(document).on("keyup keydown",function(e){var t=e.keyCode||e.which;i.stopped||27!==t||(i.pause(),i.stopped=!0,u.completedCallback()),i.stopped||16!==t||("keydown"===e.type?i.pause():(i.resume(),w(e)))})},l=function(e){var t=e.attr("class");if(!t)return e;t=t.split(" ");for(var n=[],i=0;i<t.length;i++)t[i]&&-1===t[i].indexOf("fera-")&&""!==t[i]&&n.push(t[i]);return e.attr("class",n.join(" ")),e};i.pause=function(){i.running=!1,l(d(".fera-highlight")),d(".fera-highlight-placeholder").remove(),d("body").removeClass("fera-choosingLocation"),d("#feraElementSelectorStyles").remove()},i.resume=function(e,t){void 0!==e&&(u.chooseLocation=e),void 0!==t&&(u.completedCallback=t),i.running=!0,i.stopped=!1,h()};var c=function(){var e=d(d(r)[0].outerHTML),t={css_path:r,position:a,html:e[0].outerHTML.replace(/fera-highlight[^\s'"]*/g,"").replace(/ class="\s?"/,"").replace(/\n\n+/g,"\n").trim(),recommended_classes:o,recommended_styles:s};i.pause(),i.stopped=!0,u.completedCallback(t)},h=function(){var e='<style id="feraElementSelectorStyles"> .fera-highlight{ cursor: crosshair !important; } .fera-highlight.fera-highlight-invalid{ cursor: not-allowed !important; outline: 1px solid red !important; } body.fera-load-waiting::after {content: "";background-color: rgba(255, 255, 255, 0.5);position: fixed;left: 0;top: 0;right: 0;bottom: 0;z-index: 99999999;}';if(u.chooseLocation){d("body").addClass("fera-choosingLocation");var t=parseInt(n.replace("px",""));t=150<t?150:t;Math.max((t-15)/2,2);e+="[data-fera-skill] { opacity: 0.3; cursor: not-allowed; } .fera-highlight{ outline: 1px solid #0000ff24 !important; } .fera-highlight-placeholder { text-align: center !important;\n    width: 100% !important;\n    font-weight: bold !important;\n    color: black !important;\n    display: block !important;\n    background-color: #f0f2ff !important;\n    border: 4px solid #1800ff !important;\n    text-transform: uppercase !important;\n    z-index: 9 !important;\n    position: relative !important;\n    margin-left: auto !important;\n    margin-right: auto !important;\n    font-size: 16px !important;\n    cursor: crosshair !important;\n    height: 0 !important;}.fera-choosingLocation [data-fera-skill] * {\n    pointer-events: none;\n}@keyframes feraHighlightPulse {\n    0% {        box-shadow: none;    }    20% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    80% {        box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.5);    }    100% {        box-shadow: none;    }}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;\n    animation-duration: 1.5s;\n    animation-iteration-count: 1;\n    animation-timing-function: linear;}.fera-highlight.fera-highlight-before, .fera-highlight.fera-highlight-prepend_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n\n.fera-highlight.fera-highlight-after, .fera-highlight.fera-highlight-append_to {\n    cursor: url(\"data:image/svg+xml,%3Csvg aria-hidden='true' role='img' xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 448 512'%3E%3Cpath fill='%231800ff' d='M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z'%3E%3C/path%3E%3C/svg%3E\"), crosshair !important;\n}\n"}else e+=".fera-highlight{ outline: 2px solid #0000ff !important; } .fera-highlight.btn:not(.disabled):hover::after { border: none !important; }";e+="</style>",d("body").append(e)},g=function(e,t){var n;t=t||" ";var i=e.get(0).tagName;if(-1!==["TR","THEAD","TFOOT","TBODY"].indexOf(i))return null;if(e.hasClass("shopify-payment-button__button"))return null;if(e.width()<p)return null;if("flex"===e.parent().css("display"))return null;var r=function(e){return 1===d(t+e).length};if(e.data("fera-skill")||0<e.parents("[data-fera-skill]").length)return null;if(e.attr("id")&&(e.attr("id")&&r("#"+e.attr("id"))&&!e.attr("id").match(/product[_\-.][0-9a-z]+/i)))return n=t+"#"+e.attr("id");if(e.data("section-id"))return n='[data-section-id="'+e.data("section-id")+'"]';if("FORM"===i&&e.attr("action")){var a='form[action="'+e.attr("action")+'"]';if(r(a))return n=t+a}if(e.attr("class"))for(var o=e.attr("class").replace(/\s\s+/gm," ").trim().split(" "),s=0;s<o.length;s++){var l=o[s];if(-1===l.indexOf("fera-highlight")&&r("."+l))return n=t+"."+l}if(r(i))return n=t+i.toLowerCase();var c=new Fera.CssPathGenerator(e.get(0),{skipDataAttributes:!0,skipAttributes:!0});return r(n=c.getPath())?t+n:r(n=(c=new Fera.CssPathGenerator(e.get(0),{skipAttributes:!0,maxDataAttrSize:60})).getPath())?t+n:null},m=function(){d(".fera-highlight").removeClass("fera-highlight fera-highlight-prepend_to fera-highlight-append_to fera-highlight-invalid fera-highlight-after fera-highlight-before fera-highlight-left fera-highlight-right")},v=function(e,t){var n=t.css("display"),i=-1===["table-cell","table-row","li"].indexOf(n);-1!==["table-cell","table-row"].indexOf(n)&&(i=!1);var r=!0;"block"===f&&u.chooseLocation&&(-1!==["inline-block","inline","flex"].indexOf(n)&&(r=!1),-1!==["H1","H2","H3","H4","H5","H6","P","A","TABLE","SVG","IMG"].indexOf(t[0].tagName)&&(r=!1)),t.is(".slideshow,.slick-slider")&&(r=!1);var a=t.height()/4,o=e.offsetY>=2*a,s=(e.offsetY,e.offsetY>=3*a),l=e.offsetY>=2*a&&e.offsetY<3*a,c=e.offsetY>=a&&e.offsetY<2*a;e.offsetY;return i&&s?"after":r&&(i&&l||!i&&o)?"append_to":r&&c||!i?"prepend_to":"before"},y=function(e,t){-1!==["after","before"].indexOf(t)&&-1!==["left","right"].indexOf(e.css("float"))?s.push("float: "+e.css("float")):-1!==["prepend_to","append_to"].indexOf(t)&&-1!==["left","right"].indexOf(e.children(":not(.fera-highlight-placeholder)").css("float"))&&s.push("float: "+e.children(":not(.fera-highlight-placeholder)").css("float")),e.hasClass("container")&&o.push("container");var n=parseInt(e.css("padding-bottom"));n&&0<n&&"after"===t&&s.push("margin-bottom: "+e.css("padding-bottom"));var i=parseInt(e.css("padding-top"));i&&0<i&&"before"===t&&s.push("margin-top: "+e.css("padding-top"));var r=parseInt(e.css("margin-bottom"));r&&0<r&&"after"===t&&s.push("margin-bottom: "+e.css("margin-bottom"));var a=parseInt(e.css("margin-top"));a&&0<a&&"before"===t&&s.push("margin-top: "+e.css("margin-top"))},b=function(){if(u.chooseLocation){var e=d("<div></div>");e.attr("style",s.join(" !important; ")),e.attr("class","fera-highlight-placeholder "+o.join(" ")),e.insertBefore(".fera-highlight-before"),e.insertAfter(".fera-highlight-after"),e.prependTo(".fera-highlight-prepend_to"),e.appendTo(".fera-highlight-append_to")}},w=function(e){var t=d(e.target);if(t.hasClass("fera-highlight-placeholder"))return!1;d(".fera-highlight-placeholder").remove();var n=g(t);if(!n){var i=t.parents("div[id]");(n=g(t,"#"+i.first().attr("id")+" "))&&(t=d(n))}if(0<t.parents(".slideshow,.slick-slider").length&&(t=t.parents(".slideshow,.slick-slider").first()),m(),s=[],o=[],t.addClass("fera-highlight"),null===n)return t.addClass("fera-highlight-invalid"),r=a=null,!1;a=v(e,t),t.addClass("fera-highlight-"+a),u.chooseLocation&&y(t,a),r=n,b()};e()},Fera.AdminIntegrationChecker=function(e){e=e||{};var t=this,i=Fera.Util.$();t.check=function(e){var t="==== YOUR CUSTOMERS WILL >>NOT<< SEE THIS MESSAGE ====\n\n",n="Please contact our support team at help@fera.ai and someone will be able to help you get it working.";"product_list"==e&&0==i('.banana-container[data-container_type="list"]').length&&alert(t+"It doesn't look like Fera is integrated properly into your list/grid/collection pages. "+n)}},Fera.AdminPanel=function(i){this.version=i.app.version;var r=this;i=i||{};var e,t,n,a,o=Fera.Util.$(),s=!1,l=function(){i.logger.log("~~ Loaded fera.admin.js version "+r.version+" ~~")};r.initHelpers=function(){e=i.containers,t=i.markAllContainersAsDirtyCallback,$(),m(),v(),F(),S(),y(),b(),T(),P(),I(),A(),w(),_(),k(),setInterval(k,1e3),C(),d(),c(),r.previewer=new Fera.AdminPreviewer(i)};var c=function(){if(i.optionsParser.urlParams.show_element_selector){var e={elementHeight:i.optionsParser.urlParams.fera_element_height,adminSessionToken:i.adminSessionToken,apiUrl:i.optionsParser.urlParams.api_url,chooseLocation:i.optionsParser.hasUrlFlag("choose_location"),closeAfter:i.optionsParser.hasUrlFlag("fera_close_after"),api:i.api};new Fera.AdminElementSelector(e)}};r.showPreviewMessage=function(e){u()&&n.html(": "+e)};var u=function(){return i.optionsParser.getPreviewId()},d=function(){if(u()&&0===o("#feraPreviewModeIndicator").length){var e=".fera-preview-mode-indicator-container {\n  height: 0;\n  width: 0;\n}\n.fera-preview-mode-indicator {\n  z-index: 99999999999;\n  position: fixed;\n  top: 0;\n  left: 0;\n  background-color: white;\n  color: #ff3500;\n  border: 12px solid #f44714;\n  padding: 18px 60px;\n  vertical-align: middle;\n  box-shadow: 0px 0px 20px #00000014;\n  cursor: grabbing;\n}\n.fera-preview-mode-indicator.draggable { cursor: grabbing; } \n.fera-preview-mode-indicator img {\n  max-height: 22px;\n  display: inline-block;\n  vertical-align: middle;\n}\n.fera-preview-mode-indicator #adminPreviewModeMainCaption {\n  height: 24px;\n  display: inline-block;\n  vertical-align: middle;\n  line-height: unset;\n  margin-left: 12px;\n  font-weight: bold;\n  letter-spacing: 1px;\n  text-transform: uppercase;}\n.fera-preview-mode-indicator:hover a.close-preview {\n    display: block;\n}\n\n.fera-preview-mode-indicator .close-preview {\n  position: absolute;\n  right: 4px;\n  top: 2px;\n  font-size: 10px;\n  text-transform: uppercase;\n  color: #ff3500;\n  text-decoration-color: #ff35003d;\n}@media(max-width: 500px) {\n .fera-preview-mode-indicator #adminPreviewModeMessage,\n .fera-preview-mode-indicator #adminPreviewModeMainCaption {\n     display: none;\n }  \n .fera-preview-mode-indicator {\n     padding: 4px;\n     border-width: 2px;\n } \n  .fera-preview-mode-indicator .close-preview {\n      background-color: white;\n      font-size: 8px;\n      position: relative;\n      left: 0;\n  }\n}";a=o('<div id="feraPreviewModeIndicator" class="fera-preview-mode-indicator"><img src="'+i.api.baseCdnPath+'/img/branding/logo_icon.png" alt="Fera.ai Admin Preview"><span id="adminPreviewModeMainCaption">Skill Preview Mode</span><a class="close-preview" href="#">close preview</a><span id="adminPreviewModeMessage"></span><style>'+e+"</style></div>"),o("body").prepend(a),n=a.find("#adminPreviewModeMessage"),a.find(".close-preview").on("click",function(e){e.preventDefault(),f()}),p(),h(),o("#admin-bar-iframe").hide()}},f=function(){var e=window.location.toString();return e=Fera.Util.updateURLParameter(e,"fera_preview",null),e=Fera.Util.updateURLParameter(e,"fera_test",null),e=Fera.Util.updateURLParameter(e,"fera_admin",null),e=Fera.Util.updateURLParameter(e,"test_mode",null),e=Fera.Util.updateURLParameter(e,"admin_mode",null),e=Fera.Util.updateURLParameter(e,"preview",null),e=Fera.Util.updateURLParameter(e,"fera",null),window.location=e,!0},p=function(){o("a").each(function(){var e=o(this);if(!e.data("fera-preview-links-added")){var t=e.attr("href");"string"==typeof t&&""!==t&&0!==t.indexOf("#")&&(t=Fera.Util.updateURLParameter(t,"fera_test",i.testMode),t=Fera.Util.updateURLParameter(t,"fera_admin",i.adminMode),t=Fera.Util.updateURLParameter(t,"fera_preview",i.optionsParser.getPreviewId()),e.data("fera-preview-links-added",!0),e.attr("href",t))}})},h=function(){var t=a.width(),n=a.height(),i=null;a.on("mousedown",function(e){"close-preview"!==o(e.target).attr("class")&&(a.attr("unselectable","on").addClass("draggable"),i=a)}).on("mouseup",function(){i=null,a.removeAttr("unselectable").removeClass("draggable")}),o("body").on("mousemove",function(e){i&&i.offset({top:e.pageY-n/2,left:e.pageX-t/2})})},g=function(){s?(r.$panel.hide(),s=!1):(r.$panel.show(),s=!0)},m=function(){o("#feraAdminPanelToggle").on("change",function(e){e.preventDefault(),g()})},v=function(){r.$panel.find("#feraAdminPanel--hide").on("click",function(e){e.preventDefault(),o("#feraAdminPanelToggle").click()})},y=function(){r.$panel.find("#feraAdminPanel--clearShownHistoryHelp").on("click",function(e){return e.preventDefault(),alert('Fera only shows each social proof event (eg. "Someone has started buying X item") ONCE per customer.\n\nUse this action to clear Fera\'s "seen" history and re-display any shown social proof events for testing purposes.\n\nNote: Clearing of notifications will remain active until you switch to another page.'),!1})},b=function(){r.$panel.find("#feraAdminPanel--clearShownHistory").on("click",function(e){return e.preventDefault(),i.app.trigger("feeds.reset"),window.location=Fera.Util.updateURLParameter(window.location.toString(),"clear_notification_history",1),!1})},w=function(){r.$panel.find("#feraAdminPanel--numContainersHelp").on("click",function(e){return e.preventDefault(),alert("This shows you the number of Fera containers located on this page. The Fera containers are what show Fera content embedded within your pages. \n\nIf you're expecting to see Fera embedded content ON THIS PAGE but you're not seeing anything and this number is 0, that probably means Fera is not properly integrated into your store's theme. Please follow our integration guides or seek help from one of our support staff to get integration working on your store."),!1}),r.$panel.find("#feraAdminPanel--numContainersValue").text(e.size())},_=function(){r.$panel.find("#feraAdminPanel--sessionTimeHelp").on("click",function(e){return e.preventDefault(),alert("Shows how much time the user spent on site during the current session. Session resets after 1 hours of inactivity."),!1}),r.$panel.find("#feraAdminPanel--timeSinceFirstSeenHelp").on("click",function(e){return e.preventDefault(),alert("Shows how much time has passed since the user first visited the site (including any time in the past). This timer never resets (unless the shoppers session is lost)."),!1}),r.$panel.find("#feraAdminPanel--timeOnCurrentPageHelp").on("click",function(e){
return e.preventDefault(),alert("Shows how much time the user spent on current page. This timer resets after the shopper navigates to any other page."),!1})},k=function(){i.timeTracker&&(r.$panel.find("#feraAdminPanel--sessionTimeValue").text(x(i.timeTracker.getSessionTime())),r.$panel.find("#feraAdminPanel--timeSinceFirstSeenValue").text(x(i.timeTracker.getTimeSinceFirstSeen())),r.$panel.find("#feraAdminPanel--timeOnCurrentPageValue").text(x(i.timeTracker.getTimeOnCurrentPage())),r.$panel.find("#feraAdminPanel--inactiveTimeOnCurrentPageValue").text(x(i.timeTracker.getInactiveTimeOnPage())))},C=function(){(r.$panel.find("#feraAdminPanel--resetUserTimersHelp").on("click",function(e){return e.preventDefault(),alert("Resets all timers: Session Time, Time on Current Page and Time Since 1st Seen."),!1}),i.timeTracker)&&r.$panel.find("#feraAdminPanel--resetUserTimers").on("click",function(e){return e.preventDefault(),i.timeTracker.reset(),t&&t(),k(),!1})},x=function(e){var t=e%60,n=(e=(e-t)/60)%60,i=(e-n)/60,r="";return 0<i&&(r+=i+"h "),(0<n||0<i)&&(r+=n+"min "),i<=0&&(r+=t+"sec "),r},S=function(){r.$panel.find("#feraAdminPanel--testModeHelp").on("click",function(e){return e.preventDefault(),alert("Test Mode allows admins to preview in-store campaigns using test data from our server. This is useful for you to see how a busy store will look to visitors."),!1})},F=function(){var e=r.$panel.find("#feraAdminPanel--toggleTestMode");i.testMode?e.checked=!0:e.checked=!1,e.on("change",function(e){e.preventDefault();var t=window.location.toString();return-1!==t.indexOf("fera_test")?-1!==(t=Fera.Util.updateURLParameter(t,"fera_test",i.testMode?0:1)).indexOf("test_mode")&&(t=Fera.Util.updateURLParameter(t,"test_mode",null)):t=Fera.Util.updateURLParameter(t,"fera_test",i.testMode?0:1),window.location=t,!1})},P=function(){r.$panel.find("#feraAdminPanel--resetHelp").on("click",function(e){return e.preventDefault(),alert("Resetting the timers will bring back any countdown timers to their starting position. This is useful to see how things look on your store to customers who have not had their timers expire yet."),!1})},T=function(){r.$panel.find("#feraAdminPanel--reset").on("click",function(e){return e.preventDefault(),i.app.trigger("timers.reset"),i.app.trigger("feeds.reset"),window.location.reload(),!1})},I=function(){r.$panel.find("#feraAdminPanel--goBackToAdmin").on("click",function(e){return e.preventDefault(),window.location=i.api.baseAppPath,!1})},A=function(){r.$panel.find("#feraAdminPanel--turnOff").on("click",function(){if(confirm("You can reactivate the storefront admin panel from your Fera account under the 'Store Settings' menu section.")){var e=window.location.toString();-1!==e.indexOf("fera_test")?-1!==(e=Fera.Util.updateURLParameter(e,"fera_test",0)).indexOf("test_mode")&&(e=Fera.Util.updateURLParameter(e,"test_mode",null)):e=Fera.Util.updateURLParameter(e,"fera_test",0),-1!==e.indexOf("fera_admin")?-1!==(e=Fera.Util.updateURLParameter(e,"fera_admin",0)).indexOf("admin_mode")&&(e=Fera.Util.updateURLParameter(e,"admin_mode",null)):e=Fera.Util.updateURLParameter(e,"fera_admin",0),window.location=e}})},$=function(){var e;o("#feraAdminPanelContainer").remove(),e=i.testMode?'<label class="fera-toggle-switch"><input type="checkbox" checked id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>':'<label class="fera-toggle-switch"><input type="checkbox" id="feraAdminPanel--toggleTestMode"><span class="fera-slider round"></span></label>';var t='<div><div class="fera-button-wrapper" id="feraAdminButton"><input class="fera-hidden-trigger" id="feraAdminPanelToggle" type="checkbox"><div class="fera-circle"><label class="fera-circle-label" for="feraAdminPanelToggle"><img src="'+i.api.baseCdnPath+'/img/branding/logo_icon.png" alt="Fera A.I. Admin Icon" /><div class="fera-button-label">Admin</div></label></div></div></div>',n='<div id="feraAdminPanelContainer"><div id="feraAdminPanel" class="fera-admin-panel"><div class="fera-admin-panel-header"><div class=fera-admin-panel-header-side></div><div class="fera-admin-panel-header-inner">Fera Admin Panel</div><div class="fera-admin-panel-header-side"><a href="#" id="feraAdminPanel--hide">Hide</a></div></div><div class="fera-admin-note"><strong>NOTE:</strong> Your customers will <b>not</b> see this panel or any admin buttons.</div><div class="fera-admin-option" id="feraToggleTestModeSection"><div>Test Mode<span class="fera-admin-panel-help" id="feraAdminPanel--testModeHelp">(?)</span> :</div>'+e+'</div><div class="fera-admin-option" id="feraNumContainersSection"><div>Fera Containers:<span class="fera-admin-panel-help" id="feraAdminPanel--numContainersHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--numContainersValue">n/a</span></div><div class="fera-admin-option" id="feraTimeOnCurrentPageSection"><div>Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--timeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraInactiveTimeOnCurrentPageSection"><div>Inactive Time on Page<span class="fera-admin-panel-help" id="feraAdminPanel--inactiveTimeOnCurrentPageHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--inactiveTimeOnCurrentPageValue">n/a</span></div><div class="fera-admin-option" id="feraSessionTimeSection"><div>Time On Site<span class="fera-admin-panel-help" id="feraAdminPanel--sessionTimeHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--sessionTimeValue">n/a</span></div><div class="fera-admin-option" id="feraTimeSinceFirstSeenSection"><div>Time Since First Seen<span class="fera-admin-panel-help" id="feraAdminPanel--timeSinceFirstSeenHelp">(?)</span>:</div><span class="fera-admin-option-value" id="feraAdminPanel--timeSinceFirstSeenValue">n/a</span></div><div class="fera-admin-option" id="feraResetUserTimersSection"><div>Reset Time<span class="fera-admin-panel-help" id="feraAdminPanel--resetUserTimersHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--resetUserTimers">Reset</div></div><div class="fera-admin-option" id="feraResetTimersSection"><div>Reset Cart Timers<span class="fera-admin-panel-help" id="feraAdminPanel--resetHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--reset">Reset</div></div><div class="fera-admin-option" id="feraClearShownHistorySection"><div>Reset Social Proof Events<span class="fera-admin-panel-help" id="feraAdminPanel--clearShownHistoryHelp">(?)</span>:</div><div class="fera-reset-button" id="feraAdminPanel--clearShownHistory">Reset</div></div><div class="fera-admin-return"><a href="#" id="feraAdminPanel--goBackToAdmin">Go To Admin</a> <a href="#" id="feraAdminPanel--turnOff">Disable Admin Mode</a></div></div><style>'+O()+"</style>"+t+"</div>";o("body").append(n),r.$panel=o("#feraAdminPanel"),r.$panel.hide(),r.$toggleBtn=o("#feraAdminButton"),i.adminMode||r.$toggleBtn.hide()},O=function(){return'@keyframes radial-pulse{0%{box-shadow:0 0 0 0 rgba(0,0,0,.5)}to{box-shadow:0 0 0 30px transparent}}.fera-circle img,fera-button{-webkit-user-select:none;-ms-user-select:none}.fera-admin-panel{color:#1c1c1c;width:40%;min-width:450px;border-radius:0;position:fixed;z-index:999;font-size:12px;font-family:Helvetica,Arial,sans-serif!important}.fera-admin-panel-header-inner{margin:auto;font-size:18px;text-align:center;padding:5px 10px}.fera-admin-panel-header-side{top:0;bottom:0;padding:10px;font-weight:300;flex-shrink:0}.fera-admin-panel a{font-size:14px}.fera-admin-panel-logo{vertical-align:middle;width:18px;height:38px}.fera-admin-option{height:28px!important;margin:auto auto 12px;display:flex;flex-wrap:no-wrap;justify-content:space-between;font-size:14px;text-align:center}.fera-admin-option-value{flex-wrap:nowrap;font-weight:200;padding:2px 4px;margin-left:7px;border-bottom: 1px solid #c3c3c3;color:#404040;}.fera-admin-return{display:table;padding-top: 12px;width: 100%;}.fera-admin-return > a { display: table-cell !important;} .fera-admin-return > a:last-child {text-align: right !important;}.fera-admin-note{text-align:center;font-style:italic;font-weight:400;padding:10px; border: 1px solid #efefef;}@media (max-width:401px){.fera-admin-panel{display:none!important}}.fera-admin-panel-help{flex-wrap:nowrap;vertical-align:super;font-size:8px;margin-left:2px;text-decoration:none;cursor:pointer}.fera-admin-panel-help:hover{opacity:.7}.fera-toggle-switch{position:relative;display:inline-block;width:60px;height:28px}.fera-slider,.fera-slider:before{position:absolute;background-color:#fff;-webkit-transition:.4s;-ms-transition:.4s;transition:.4s}.fera-toggle-switch input{display:none}.fera-slider{cursor:pointer;top:0;right:0;box-shadow:0 1px 3px #969696 inset;left:0;bottom:0}.fera-slider:before{box-shadow:0 1px 3px #969696;content:"";height:24px;width:24px;left:2px;bottom:2px}.fera-reset-button{cursor:pointer;display:inline-block!important}.fera-button-wrapper,.fera-circle,.fera-circle-label{height:60px;width:60px}input:checked+.fera-slider{background-color:#00e640}input:focus+.fera-slider{box-shadow:0 1px 1px #969696}input:checked+.fera-slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(32px);transform:translateX(32px)}.fera-slider.round{border-radius:34px}.fera-slider.round:before{border-radius:50%}fera-button{user-select:none;border:0;outline:0}.fera-button-wrapper{z-index:100;position:fixed;bottom:100px;left:20px;top: initial !important;}.fera-circle{position:relative;padding:0;margin:0 auto;border-radius:50%;animation:radial-pulse 1.5s 1;transition:.2s;text-align:center;background-color:rgba(33,43,54,0.9);box-shadow:0 2px 2px 0 rgba(0,0,0,.2);}.fera-circle:active{-webkit-transform:scale(.9);-ms-transform:scale (.9);transform:scale(.9);box-shadow:0 2px 15px 0 rgba(0,0,0,.3)}.fera-circle:hover{cursor:pointer;background-color:#ff492a;box-shadow:0 8px 15px 0 rgba(0,0,0,.3)}.fera-hidden-trigger:checked~.fera-circle .fera-button-label{opacity: 0;}.fera-circle img{user-select:none;position:absolute;top:50%;left:50%;margin-left: -20px;margin-top: -16px; width: 40px;transition: .5s;filter: brightness(0%) invert(100%);}.fera-hidden-trigger{display:none!important}.fera-hidden-trigger:checked~.fera-circle img { filter: none; }.fera-button-label{position:absolute;left:8px;top:22px;font-weight:700;font-size:13px}.fera-admin-panel{box-shadow:1px -1px 4px 1px rgba(0,0,0,.2);left:80px;bottom:156px;top:inherit;background-color:#fff;padding:32px 54px;max-width:550px}.fera-admin-panel-header{display:table;width:100%}.fera-admin-panel a{color:#5b5bff!important;text-transform:uppercase;text-decoration:none!important;font-weight:400!important}.fera-button-label{text-transform:uppercase;text-shadow:-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff,-1px 0 #fff,0 1px #fff,1px 0 #fff,0 -1px #fff;color:#000}.fera-hidden-trigger:checked~.fera-circle{cursor:pointer;box-shadow:1px 4px 4px 1px rgba(0,0,0,.2);background-color:#fff;-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1);transform:scaleX(-1)}.fera-admin-panel a:hover{text-decoration:underline!important}.fera-reset-button{border-radius:1px;box-shadow:0 1px 2px #969696!important;padding:3px 18px;line-height:unset!important;text-transform:uppercase;background-color:#5b5bff!important;color:#fff}.fera-admin-note{border-top:none;border-bottom:none;background-color:#f9f9e7;font-size:12px;margin-bottom:12px}.fera-admin-panel-header-side{text-align:right;margin:0;vertical-align:middle;display:table-cell;width:50px}.fera-admin-option{width:100%}.fera-admin-panel-header-side:first-child{text-align:left}.fera-admin-panel-header-inner{vertical-align:middle;font-weight:400;display:table-cell} @media(max-width: 500px){ #feraAdminPanelContainer, #feraPreviewModeIndicator { display: none; }'};l()};var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.AdminPreviewStyler=function(){function t(e){_classCallCheck(this,t),this.previewer=e}return _createClass(t,[{key:"unhighlightPreviewSelectors",value:function e(){this._findElement({selector:".fera-highlightingSelector, .fera-flashingSelector",success:function t(e){e.data("highlighted",!1),e.data("flashing",!1),e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-highlightingSelector"),e.removeClass("fera-flashingSelector")}})}},{key:"unhighlightPreviewSelector",value:function n(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")&&(e.data("highlighted",!1),e.removeClass("fera-highlightingSelector")),e.data("flashing")&&(e.stop(),e.data("flashing",!1),e.removeClass("fera-flashingSelector")),e.css("outline",""),e.css("outline-offset","")}})}},{key:"highlightPreviewSelector",value:function i(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")||(e.data("highlighted",!0),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.addClass("fera-highlightingSelector"))}})}},{key:"flashPreviewSelector",value:function r(e){this._findElement({selector:e,success:function t(e){e.data("highlighted")||e.data("flashing")||(e.data("flashing",!0),e.addClass("fera-flashingSelector"),e.css("outline","3px solid rgba(93, 156, 236, 0.6)"),e.css("outline-offset","-1px"),e.css("outline-color","rgba(93, 156, 236, 0.6)").animate({"outline-color":"rgba(255, 255, 255, 0)"},1e3,"swing",function(){e.css("outline",""),e.css("outline-offset",""),e.removeClass("fera-flashingSelector"),e.data("flashing",!1)}))}})}},{key:"fetchStyle",value:function a(e,t,n){this._findElement({selector:e.replace("&gt;",">"),success:function i(e){n(e.css(t))},fail:function r(){Fera.logger.warn("Selectable element doesn't exist so initial value could not be detected by CurrentStyleDetector.",e,t),n(null)},addBack:!0})}},{key:"_findElement",value:function o(e){var t=this,n=this.previewer.$previewContainer.find(e.selector);e.addBack&&(n=this.previewer.$previewContainer.parent().find(e.selector)),0<n.length?e.success(n):!e.retries||e.retries<6?setTimeout(function(){return t._findElement(_extends({},e,{retries:(e.retries||0)+1}))},200):e.fail&&e.fail()}}]),t}();var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.AdminPreviewer=function(){function r(e,t){var n=this,i=arguments.length<=1||t===undefined||t;_classCallCheck(this,r),this.containers=e.containers,this.optionsParser=e.optionsParser,this.app=e.app,this.$=Fera.Util.$(),this.$previewContainer=this.$(),this._initCss(),i&&this._ensureCartPreviewWorksHasProducts()||(this.styler=new Fera.AdminPreviewStyler(this),this.sandboxMessenger=new Fera.AdminSandboxMessenger({parentDomain:e.api.baseAppPath,previewer:this,styler:this.styler,configured:i,app:e.app}),"complete"===document.readyState?this.sandboxMessenger.send("document.ready",{}):this.$(document).on("ready",function(){n.sandboxMessenger.send("document.ready",{})}),this.$(window).on("beforeunload",function(){n.sandboxMessenger.send("window.unload",{})}),this.active=!0)}return _createClass(r,[{key:"selectLocation",value:function i(e,t){if(this.elementSelector)this.elementSelector.resume(e,t);else{var n={elementHeight:(this._testHeight()||30)+"px",chooseLocation:e,closeAfter:!1,completedCallback:t};this.elementSelector=new Fera.AdminElementSelector(n)}}},{key:"updatePreview",value:function a(e,t){var n=this;if(this.lastPreviewUpdate=_extends({},this.lastPreviewUpdate||{},e,{isPreview:!0,cacheable:!1}),this.$previewCss.text(this.lastPreviewUpdate.css),this.lastPreviewUpdate.settings.store_sections&&this.lastPreviewUpdate.settings.store_sections!=[]&&this.lastPreviewUpdate.settings.store_sections!=["any"]&&0<this.lastPreviewUpdate.settings.store_sections.length&&-1===this.lastPreviewUpdate.settings.store_sections.indexOf(this.app.getSection()))this.setState("notVisibleInCurrentSection");else{if("product_list_counter"===this.lastPreviewUpdate.type){var i=function(){n.$previewContainer=n.$();var t=!0;if(n.containers.each(function(e){"product_list_counter"===e.type&&(e.updateContent({settings:n.lastPreviewUpdate.settings,campaign_id:n.lastPreviewUpdate.campaign_id,persistent_content:n.lastPreviewUpdate.html,isPreview:!0}),n.$previewContainer=n.$previewContainer.add(e.$el),t&&(n._debouncedHighlightPreview(e.$el,{scroll:".banana-globalBottom-container"!==n.lastPreviewUpdate.settings.integration_selector}),t=!1))}),!t)return n.setState("success"),{v:undefined}}();if("object"==typeof i)return i.v}else if(this.containers.globalBottom)return void this.containers.globalBottom.updateContent({abstract_blocks:[this.lastPreviewUpdate]},function(){var e=n.containers.getContainerById(n.lastPreviewUpdate.campaign_id);e?(n.$previewContainer=e.$el,n.$previewContainer&&0!==n.$previewContainer.length?(n._debouncedHighlightPreview(n.$previewContainer,{scroll:".banana-globalBottom-container"!==n.lastPreviewUpdate.settings.integration_selector}),n.setState("success")):n.setState("missingSelector")):n.setState("missingContainer")});this.containers.locateNewContainers(),(t||0)<6?(this.setState("checking"),setTimeout(function(){return n.updatePreview({},(t||0)+1)},500)):this.setState("missingContainer")}}},{key:"findBestLocation",value:function o(e){for(var t={},n=0;n<e.length;n++){var i=e[n],r=this.$(i.selector);if(1===r.length){t=this._genBestLocationParams(i,r);break}t.found=!1}this.sandboxMessenger.send("previewer.findBestLocation.result",t)}},{key:"setState",value:function n(e){if(this.state!=e){this._oldState=this.state,this.state=e;var t={lastPreviewUpdate:this.lastPreviewUpdate,newState:this.state,oldState:this._oldState};this.sandboxMessenger.send("previewer.state.change",t)}}},{key:"_genBestLocationParams",value:function s(e,t){var n=["display","width","position","transform","background-color","font-size","border","text-align","margin","padding"];return{found:!0,location:e,target:{css:t.css(n)},parent:{css:t.parent().css(n)},siblings:t.siblings().map(function(e,t){return{css:$(t).css(n)}}).toArray(),prev:t.prev().css(n),next:t.next().css(n)}}},{key:"_removeMerchantMaskClasses",value:function e(){var t=this;["async-hide"].forEach(function(e){return t.$previewContainer.parents("."+e).removeClass("."+e)})}},{key:"highlight",value:function t(){var e=this._lastHighlighted$el||this.$previewContainer;return!!e&&(!(e.length<1)&&void this._highlightPreview(e,{scroll:!0,force:!0}))}},{key:"_initCss",value:function l(){this.$("body").append("<style id='feraAdminPreviewCss'></style>"),this.$previewCss=this.$("#feraAdminPreviewCss"),this.$previewerCss=this.$('<style id="feraAdminPreviewerCss">'+this._previewerCss()+"</style>"),this.$("body").append(this.$previewerCss)}},{key:"_resetHighlight",value:function c(e){this._allowHighlights=!0,e.data("fera-highlighted-container",!1)}},{key:"_debouncedHighlightPreview",value:function u(e,t){var n=this,i=arguments.length<=1||t===undefined?{}:t;this._debouncedHighlightPreviewCallback=function(){n._highlightPreview(e,i)},this._debouncedHighlightPreviewMethod||(this._debouncedHighlightPreviewMethod=Fera.Util.debounce(function(){return n._debouncedHighlightPreviewCallback()},500)),this._debouncedHighlightPreviewMethod()}},{key:"_highlightPreview",value:function d(e,t){var n=this,i=arguments.length<=1||t===undefined?{}:t;i=i||{};var r=e.parents(".fera-container,.banana-container");if(e=0<r.length?r.first():e.first(),this._removeMerchantMaskClasses(),i.force&&this._resetHighlight(e),!1!==this._allowHighlights){if(this._lastHighlighted$el=e,i.scroll)return Fera.Util.scrollToElement(e,{duration:200,callback:function a(){return n._highlightPreview(e,{scroll:!1})}});this._showLightBox(e),setTimeout(function(){n._allowHighlights=!1},300)}}},{key:"_showLightBox",value:function f(e){if(!e.data("fera-highlighted-container")&&(0!==e.height()||0!==e.children().height()||0!==e.children().children().height())){var t=e.parents("a"),n=e.parents("body");n.addClass("fera-highlight-container-body"),t.addClass("fera-highlight-container-container"),e.addClass("fera-highlight-container"),setTimeout(function(){e.removeClass("fera-highlight-container"),t.removeClass("fera-highlight-container-container"),n.removeClass("fera-highlight-container-body")},2e3),e.data("fera-highlighted-container",!0)}}},{key:"_scrollToPreview",value:function p(e){if(".banana-globalBottom-container"!==e){var t=this.$(e);t.length<1||this._highlightPreview(t)}}},{key:"_testHeight",value:function h(){if(this.elementHeight||!this.lastPreviewUpdate)return this.elementHeight;var e=this.$(this.lastPreviewUpdate.html);return e.css("visibility","hidden"),this.$("body").append(e),this.elementHeight=e.height(),e.remove(),this.elementHeight}},{key:"_ensureCartPreviewWorksHasProducts",value:function g(){if(window.performance&&window.performance.navigation.type==window.performance.navigation.TYPE_BACK_FORWARD)return!1;if(this.optionsParser.sandboxMode&&this.optionsParser.sandboxError)return!1;if(!this.optionsParser.hasUrlFlag("ensure_loaded_cart"))return this._goToCheckoutOnFlag();var e=this.optionsParser.urlParams.sample_variant_id,t=this.optionsParser.urlParams.sample_product_id;return t?(e?this._addProductToCartIfEmpty(t,{variant_id:e}):this._addProductToCartIfEmpty(t,{}),!0):(Fera.logger.error("Expected sample product in the params but didn't get one so couldn't ensure that the cart was loaded. Please contact the fera.ai support team if you see this message.",this.optionsParser.urlParams),!1)}},{key:"_addProductToCartIfEmpty",value:function m(e,t){this.app.cart.addProductIfEmpty(e,t,{afterAdd:function n(){var e=window.location.toString();setTimeout(function(){window.location=Fera.Util.updateURLParameter(e,"ensure_loaded_cart","0")},1e3)}})}},{key:"_previewerCss",value:function v(){return"@keyframes feraHighlightPulse-light {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    80% { box-shadow: 0 0 0 10000000px rgba(255, 255, 255, 0.95); }    100% { box-shadow: none; }}@keyframes feraHighlightPulse {    0% { box-shadow: none; }    20% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    80% { box-shadow: 0 0 0 10000000px rgba(0, 0, 0, 0.6); }    100% { box-shadow: none; }}body.fera-highlight-container-body .card--reveal {    transform: none !important;    -webkit-transform: none !important;    -ms-transform: none !important;    transition: none !important;}.fera-highlight-container {    z-index: 99999;    position: relative;    animation-name: feraHighlightPulse;    animation-duration: 2s;    animation-iteration-count: 1;    animation-timing-function: linear;}.fera-highlight-container--dark {    animation-name: feraHighlightPulse;}a.fera-highlight-container-container {    overflow: visible;    z-index: 2;}body.fera-highlight-container-body > div {    overflow: visible;}body.fera-highlight-container-body #shopify-section-header,body.fera-highlight-container-body > header {    z-index: 0 !important;}body.fera-highlight-container-body .site-header--sticky {    position: static;}body.fera-highlight-container-body > main {    z-index: 0 !important;}"}},{key:"_goToCheckoutOnFlag",value:function y(){var e=this;return!!this.optionsParser.hasUrlFlag("go_to_checkout")&&(this.$(window).on("load",function(){e.app.cart.startCheckout()}),!0)}}]),r}();var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.AdminSandboxMessenger=function(){function i(e){if(_classCallCheck(this,i),this.parentDomain=e.parentDomain,this.previewer=e.previewer,this.styler=e.styler,this.configured=e.configured,this.parentWindow=e.app.parentWindow,this.parentWindow){var t=window.feraAdminSandboxStatus||200,n=window.feraAdminSandboxMessage;n=n?decodeURIComponent(n):null,this.configured?(this._initIframeListener(),this._bindFocusListener(),this._readyForParent({status:t,message:n})):parseInt(t)<400?this._readyForParent({status:500,message:"An unknown error occurred. Please contact support."}):this._readyForParent({status:t,message:n})}}return _createClass(i,[{key:"_initIframeListener",value:function e(){var n=this;window.addEventListener("message",function(e){if(e.origin===n.parentDomain){var t=JSON.parse(e.data);n.send("gotMessage",{id:t.id}),n._trigger(t)}})}},{key:"_bindFocusListener",value:function t(){var e=this;window.addEventListener("focus",function(){e.send("focused")},!0)}},{key:"_readyForParent",value:function n(e){var t=arguments.length<=0||e===undefined?{}:e;this.send("ready",Fera.Util.$().extend({},{href:window.location.href,status:200},t||{}))}},{key:"send",value:function r(e,t){!this.parentWindow||this.parentWindow.length<0||this.parentWindow.postMessage(JSON.stringify({methodName:e,params:t}),this.parentDomain)}},{key:"_trigger",value:function a(t){var n=this;"selectLocation"===t.methodName?this.previewer.selectLocation(t.params,function(e){window.stop(),n.send("window.stop",{}),n.send("locationSelected",e)}):"updatePreview"===t.methodName?this.previewer.updatePreview(t.params):"fetchStyle"===t.methodName?this.styler.fetchStyle(t.params.selector,t.params.attribute,function(e){n.send("styleFetched",{callbackId:t.params.callbackId,value:e})}):"unhighlightPreviewSelectors"===t.methodName?this.styler.unhighlightPreviewSelectors():"unhighlightPreviewSelector"===t.methodName?this.styler.unhighlightPreviewSelector(t.params):"highlightPreviewSelector"===t.methodName?this.styler.highlightPreviewSelector(t.params):"flashPreviewSelector"===t.methodName?this.styler.flashPreviewSelector(t.params):"highlight"===t.methodName?this.previewer.highlight(t.params):"findBestLocation"===t.methodName?this.previewer.findBestLocation(t.params):"window.stop"===t.methodName&&this.send("window.stop",{})}}]),i}();var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.Components=Fera.Components||{},Fera.Components.Base=function(){function e(){_classCallCheck(this,e),this.$globalTopContainer=Fera.Util.$()(".banana-globalTop-container")}return _createClass(e,[{key:"_log",value:function t(){Fera.logger.log.apply(this,arguments)}},{key:"_warn",value:function n(){Fera.logger.warn.apply(this,arguments)}},{key:"_error",value:function i(){Fera.logger.error.apply(this,arguments)}},{key:"_logWarning",value:function r(){Fera.logger.logWarning.apply(this,arguments)}}]),e}();var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Components.CustomNotif=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.skill=e,this.$=Fera.Util.$(),this.$globalBottomContainer=this.$(".banana-globalBottom-container"),this.campaignSettings=this.skill.settings,this._create(),this.show()}return _inherits(t,e),_createClass(t,[{key:"update",value:function n(){this.campaignSettings=this.skill.settings,this.show()}},{key:"_create",value:function i(){this.$el=this.skill.$el||this.$(this.skill.html);var e='<div class="banana-container-row fera-customNotif-container fera-notif-popup-container"></div>';this.skill.options.integration_selector?(this.$container=$(e),this.$container=this.$container.appendTo(this.skill.$el.parent())):(this.$globalBottomContainer.append(e),this.$container=this.$globalBottomContainer.find(".fera-customNotif-container"),this.$container.append(this.$el))}},{key:"_adminMode",value:function r(){return this.skill.adminMode}},{key:"show",value:function a(){var e=this;if(this._seen())return!1;this.popup=new Fera.PopupNotification({$el:this.$el,container:this.$container,logger:Fera.logger,$:this.$}),this.popup.attach(),this.popup.ensureLoadThenShow(this.campaignSettings.animation_in,this.campaignSettings.popout_position,function(){e._setUpCountDown()}),this._attachListeners()}},{key:"hide",value:function o(){this.popup&&this.popup.attached()&&this.popup.hideAndDetach(this.campaignSettings.animation_out,this.campaignSettings.popout_position,function(){})}},{key:"remove",value:function s(){var e=this;this.popup&&this.popup.hideAndDetach(this.campaignSettings.animation_out,this.campaignSettings.popout_position,function(){e.$container.remove()})}},{key:"_attachListeners",value:function l(){var e=this;this.popup.$el.find(".fera-notification-close").on("click touch",function(){e.hide()}),this.$el.attr("data-fera-skill",this.skill.skillId)}},{key:"_getShowTime",value:function c(){var e=5;return this.campaignSettings&&this.campaignSettings.time_to_show_for&&(e=parseInt(this.campaignSettings.time_to_show_for)),e}},{key:"_setUpCountDown",value:function u(){var e=this;this.popup.initiateCountdown(this._getShowTime()),setTimeout(function(){e.hide()},1e3*this._getShowTime())}},{key:"_markSeen",value:function d(){this.skill.memory.set("CustomNotifSeen",!0,6e4)}},{key:"_seen",value:function f(){return!(this.skill.getState().session_time<5||this.skill.memory.get("CustomNotifSeen")===undefined)&&this.skill.memory.get("CustomNotifSeen")}}]),t}(Fera.Components.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Components.CustomPopup=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.skill=e,this.$=Fera.Util.$(),this.$globalBottomContainer=this.$(".banana-globalBottom-container"),this.campaignSettings=this.skill.settings,this.stringTemplates=this.campaignSettings.string_templates,this._create()}return _inherits(t,e),_createClass(t,[{key:"update",value:function n(){this.campaignSettings=this.skill.settings}},{key:"_create",value:function i(){this.$el=this.skill.$el&&0!==this.skill.$el.length?this.skill.$el:this.$(this.skill.html),this._define$variables(),this.$el.hide(),this.skill.$el&&0!==this.skill.$el.length?this.$container=this.skill.$container:(this.skill.$container&&0!==this.skill.$container.length?this.$container=this.skill.$container:(this.$container=$('<div class="banana-container-row fera-customPopup-container"></div>'),this.$container.appendTo(this.$globalBottomContainer)),this.$container.append(this.$el))}},{key:"show",value:function r(){Fera.Util.showWithoutTransform(this.$el),this._attachListeners()}},{key:"hide",value:function a(){this.$el.hide()}},{key:"remove",value:function o(){this.$el.remove()}},{key:"_define$variables",value:function s(){this.$title=this.$el.find(".fera-popup-header h3.fera-popup-title"),this.$subtitle=this.$el.find(".fera-popup-header h5.fera-popup-title"),this.$body=this.$el.find(".fera-popup-body"),this.$btn=this.$el.find(".fera-popup-footer .fera-popup-btn")}},{key:"_attachListeners",value:function l(){var t=this;this.$el.find('[data-dismiss="fera-popup"]').on("click touch",function(){t.hide()}),
this.campaignSettings.close_on_outside_click&&this.$container.find(".fera-popup").on("click",function(e){t.$(e.target).hasClass("fera-popup")&&(e.stopPropagation(),t.hide())}),this.$btn.on("click",function(){t.startLoading()}),this.$el.attr("data-fera-skill",this.skill.skillId)}},{key:"startLoading",value:function c(){this.$btn.animate({opacity:.3}),this.$btn.addClass("fera-btn-loading"),this.originalBtnHtml=this.$btn.html(),this.$btn.html(this.stringTemplates.please_wait)}},{key:"stopLoading",value:function u(){this.$btn.removeClass("fera-btn-loading"),this.$btn.html(this.originalBtnHtml)}}]),t}(Fera.Components.Base),Fera.Feed=function(a){var o,s=this,l=a.settings.use_product_context,n=Fera.Util.$(),e=function(){o=new Fera.SeenNotifTracker({logger:Fera.logger,localStorage:a.app.localStorage,storageKey:"SocialProof.seenTracker"}),a.app.on("feeds.reset",o.clear),s.clearSeen=o.clear,s.items=[],s.notifQueue=[],s.markSeen=o.markSeen};this.load=function(r){a.app.geo.getLocationInfo(function(e){a.app.api.getFeeds(n.extend(t(),{country_code:e.country_code}),function(e){o.updateExpiryTime(parseInt(a.settings.expire_seen_memory_every||86400));for(var t=!1,n=0;n<e.length;n++){var i=new Fera.Notification(e[n],a);o.hasSeen(i)||(c(i),t=!0)}if(t)Fera.Util.shuffleArray(s.notifQueue);else if(l&&"show_others"===a.settings.product_context_fallback)return l=!1,s.load(r);r(t)})})};var c=function(e){s.notifQueue.push(e)},t=function(){var e={not_ids:o.getSeenIds().sort(function(e,t){return parseInt(t)-parseInt(e)}).reverse().slice(0,100).join(",")};if(l){var t=a.app.getProductId();t&&a.settings.use_product_context&&(e.product_id=t)}return a.settings.feed_params?e.feed_params=Fera.Util.encode(JSON.stringify(a.settings.feed_params)):e=n.extend(e,i()),a.settings.max_to_show&&(e.limit=parseInt(a.settings.max_to_show),e.limit<1&&(e.limit=1)),e},i=function(){var e={},t=[];return a.settings.orders_enabled&&(t.push("product_order"),a.settings.order_lookback&&(e.product_order_lookback=a.settings.order_lookback)),a.settings.carts_enabled&&(t.push("product_add_to_cart"),a.settings.cart_lookback&&(e.product_add_to_cart_lookback=a.settings.cart_lookback)),e.types=t.join(","),e};e()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Components.PromoBar=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.skill=e,this.$=BananaStand.Util.$(),this._create(),this.hidden=!1,this._visibleInitially()&&this.show()}return _inherits(t,e),_createClass(t,[{key:"update",value:function n(){this.$el.html(this.$(this.skill.html).html()),this._attachListeners(),this._hidden()||this.show()}},{key:"_attachListeners",value:function i(){var e=this;this.$el.find("[data-fera-promo-bar-close],[data-fera-promobar-close]").on("click",function(){e.hide()}),this.$el.attr("data-fera-skill",this.skill.skillId)}},{key:"_create",value:function r(){this.skill.$el&&0<this.skill.$el.length?this.$el=this.skill.$el:(this.$el=this.$(this.skill.html),this.$globalTopContainer.append(this.$el)),this.$el.hide(),this._attachListeners()}},{key:"hide",value:function a(){this._adminMode()?alert("Since you're an admin, it will appear again when you refresh the page. For your shoppers, it will be hidden permanently. \n\n NOTE: This message will NOT show to your customers."):this.skill.localStorage.set("hidden","1"),this.$el.hide(),this._unapplyFixedHeaderAdjustments()}},{key:"_visibleInitially",value:function o(){return!!this._adminMode()||!this._hidden()}},{key:"_hidden",value:function s(){return"1"==this.skill.localStorage.get("hidden")}},{key:"_adminMode",value:function l(){return this.skill.adminMode}},{key:"_unapplyFixedHeaderAdjustments",value:function c(){if(!this._$fixedHeaderStyle)return!0;this._$fixedHeaderStyle.remove()}},{key:"_applyFixedHeaderAdjustments",value:function u(){if(this._$fixedHeaderStyle)return!0;this._$fixedHeaderStyle=this.$("<style>.fera-themeWithFixedHeader--adjust { margin-top: "+this.height()+"px; } </style>"),this._$fixedHeaderStyle.appendTo("body")}},{key:"height",value:function d(){return Fera.Util.outerHeight(this.$el)}},{key:"show",value:function f(){this.$globalTopContainer.show(),this.$el.show(),this._applyFixedHeaderAdjustments()}}]),t}(Fera.Components.Base);var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function get(e,t,n){for(var i=!0;i;){var r=e,a=t,o=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(s!==undefined){if("value"in s)return s.value;var l=s.get;return l===undefined?undefined:l.call(o)}var c=Object.getPrototypeOf(r);if(null===c)return undefined;e=c,t=a,n=o,i=!0,s=c=undefined}};Fera.Components.PushNotification=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._skill=e,this.subscriberToken=null,this._loadSubscriberToken()}return _inherits(t,e),_createClass(t,[{key:"run",value:function n(){var e={};if(!this.subscriberToken)return"undefined"==typeof pushowl?(this._warn("Cannot run pushowl integration without pushowl.js installed."),!1):void pushowl.subscribe(!1,null,!1).then(function(){},function(){});(this._skill.isPreview||this._checkIsAllowed())&&(e.skill_id=this._skill.skillId,e.subscriber_token=this.subscriberToken,this._skill.api.triggerActions(e),this._skill.memory.set("last_pushed_at",(new Date).getTime()))}},{key:"_checkIsAllowed",value:function i(){var e=this._skill.settings.max_notif_period;if(!e)return!0;var t=this._skill.memory.get("last_pushed_at"),n=1e3*e+(new Date).getTime();return!(t&&parseInt(t)<n)||(this._log("Skipping push notification because the last one sent was",t),!1)}},{key:"_loadSubscriberToken",value:function r(){"undefined"!=typeof localStorage&&localStorage.pushowl_subscriber_token&&(this.subscriberToken=localStorage.pushowl_subscriber_token)}}]),t}(Fera.Components.Base),Fera.ClickRegistry=function(t){t=t||{};var n=this,i=Fera.Util.$(),r="ClickEvent",a=!0,o=null,s=["iframe","lang","body","!doctype","doctype","applet","article","aside","audio","basefont","body","br","colgroup","frame","frameset","head","header","html","iframe","p","main","meta","ol","param","script","tr","ul"],e=function(){n.register(),window.onunload=l};n.register=function(){i(document).on("mousedown","*",function(e){if("undefined"!=typeof e.originalEvent&&2!==e.button&&e.target!==o&&-1===s.indexOf(e.target.tagName.toLowerCase())){var t=i(e.target);t.hasClass("fera-highlight-placeholder")||0<t.find("* > * > * > *").length||(c(n.getEventData(e)),o=e.target)}}),setInterval(u,1),setInterval(function(){o=null},1500)},n.sendElementClick=function(e){t.app.pushEvent({type:"element_click",data:e})},n.getEventData=function(e){var t={};return f(e.target,t),t.client_x=e.pageX,t.client_y=e.pageY,t};var l=function(){a=!1},c=function(e){t.localStorage&&e&&t.localStorage.setObject(r,e)},u=function(){if(a){var e=t.localStorage.getObject(r);e&&(t.localStorage.removeItem(r),n.sendElementClick(e))}},d=function(e){var t=i(e).parents();return!(t.length<1)&&-1!==(t=t.map(function(){return this.tagName}).get()).indexOf("BUTTON")},f=function(e,t){d(e)&&(e=i(e).parents("button")[0]);var n=i(e);g(n,t),t.element_attributes=m(e),t.element_text=y(p(n)),t.element_tag_name=e.tagName,t.element_html=y(n.html()),n.is("select")&&(t.select_options=v(e)),t.element_css_path=h(e)},p=function(e){var t=e.clone();return t.find("style, svg").remove(),t.text()},h=function(e){var t=new Fera.CssPathGenerator(e,{skipDataAttributes:!0,skipAttributes:!0,skipTags:!0}).getPath();return""!==t?t:""===(t=new Fera.CssPathGenerator(e,{skipDataAttributes:!0,skipAttributes:!0}).getPath())?t:""===(t=new Fera.CssPathGenerator(e,{skipDataAttributes:!0}).getPath())?t:t=new Fera.CssPathGenerator(e).getPath()},g=function(e,t){var n=e.data("fera-skill");void 0===n&&(n=e.parents("[data-fera-skill]").data("fera-skill")),void 0!==n&&(t.campaign_id=n,t.created_by="campaign")},m=function(e){var t={};return i.each(e.attributes,function(){t[y(this.name,50)]=y(this.value)}),t},v=function(e){var t=[];return i.each(e.options,function(){t.push(this.text)}),t},y=function(e,t){return t=t||300,e.replace(/\s\s+/gm," ").trim().substring(0,t)};e()},Fera.CssPathGenerator=function(t,r){var e=this;r=r||{};var a=Fera.Util.$(),n=a(t).parents(),i=[],o=r.maxDataAttrSize||50,s=function(){};e.getPath=function(){i=[];var e=l(t);return e&&""!==e&&i.push(e),n.each(function(){(e=l(this))&&""!==e&&i.push(e)}),i.slice(0,5).join(" > ")};var l=function(e){var t=a(e),n=r.skipTags?"":e.tagName;n+=c(t.attr("id")),n+=u(t.attr("class"));var i=[];return r.skipAttributes||d(e.attributes,i),r.skipDataAttributes||f(t.data(),i),0<i.length&&(n+=i.slice(0,5).join("")),n},c=function(e){return h(e)?"":"#"+e},u=function(e){return h(e)?"":e.replace(/\s\s+/gm," ").trim().split(" ").map(function(e){if(e)return"."+e}).join("")},d=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];p(i.name)&&g(i.value)&&t.push("["+i.name+'="'+i.value+'"]')}},f=function(e,n){a.each(e,function(e,t){g(t)&&n.push("[data-"+e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()+'="'+t+'"]')})},p=function(e){return!e.match(/id|class|style|(data-.*)|(on.+)|(xml:.*)/i)},h=function(e){return null==e||""===e},g=function(e){return!!h(e)||(!e.trim||0!==e.trim().indexOf("{")&&(-1===e.indexOf("\n")&&e.length<=o))};s()};var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();Fera.ContentSubmission=Fera.ContentSubmission||{},Fera.ContentSubmission.Submitter=function(){function n(e){var t=arguments.length<=0||e===undefined?{}:e;_classCallCheck(this,n),this._opts=t,this.$=Fera.Util.$()}return _createClass(n,[{key:"show",value:function i(e){var t=arguments.length<=0||e===undefined?{}:e;this.customerMessageToken=t.cmt||t.customer_message_token||t.customerMessageToken,this.contentCampaignToken=t.cct||t.content_campaign_token||t.contentCampaignToken,this._showLoadingState(),this.$loadingStateContainer=this.$(".fera-contentSubmission--loading"),this._requestTemplate()}},{key:"hide",value:function t(e){this._closeWindow(e)}},{key:"_requestTemplate",value:function r(){var t=this,e={};this.customerMessageToken||this.contentCampaignToken?(e.customer_message_token=this.customerMessageToken,e.content_campaign_token=this.contentCampaignToken):e.product_id=this._opts.app.getProductId(),this._opts.api.requestContentSubmissionTemplate({params:e,success:function n(e){return t._processTemplateRequest(e)},error:function i(){return t._handleTemplateRequestError()}})}},{key:"_processTemplateRequest",value:function a(e){var t=this;if(e.reviewed){var n=this.$loadingStateContainer.find(".fera-container");return n.html("<div>You've already submitted your feedback. Thank you!</div><button>Close Window</button>"),void n.find("button").on("click",function(){return t._hideLoadingState()})}this._html=this._getHtml(e.template);var i=e.compiled_css;this._products=e.products,this._totalCount=this._products.length,this._previous_review=e.previous_review,this._requestReview=e.request_review,this._requestPhoto=e.request_photo,this._renderTemplate(this._html,i),this._hideLoadingState(!1),this._initElementsAndListeners()}},{key:"_handleTemplateRequestError",value:function o(){var e=this,t=this.$loadingStateContainer.find(".fera-container"),n="We're unable to accept your feedback at this time because of an unexpected error. <br>Our engineers have been notified and we'll have it fixed in no time. Sorry about that! :(";t.html("<div>"+n+"</div><button>Close Window</button>"),t.find("button").on("click",function(){return e._hideLoadingState()})}},{key:"_getHtml",value:function s(e,t){var n=arguments.length<=1||t===undefined?{}:t;if(!e||""===e.trim())return"";try{var i=e.replace(new RegExp(/\s*({%-)/g,"g"),"{%").replace(new RegExp(/(-%})\s*/,"g"),"%}");return Fera.Liquid.parse(i).render(n)}catch(r){if(DEV_MODE)throw r;return console.error(r),e}}},{key:"_renderTemplate",value:function l(e,t){this.$("body").addClass("fera-modal--open"),this.$("body").append(e),this.$("body").append("<style>"+t+"</style>")}},{key:"_initElementsAndListeners",value:function c(){var e=this;this.$submissionFormContainer=this.$(".fera-submissionForm"),this.$submissionRewardContainer=this.$(".fera-submissionReward"),this.$submissionSuccessContainer=this.$(".fera-submissionSuccess"),this.$submissionForm=this.$submissionFormContainer.find("form"),this.$ratingInput=this.$submissionForm.find('[name="fera-rating"]'),this.$summaryInput=this.$submissionForm.find('[name="fera-summary"]'),this.$bodyInput=this.$submissionForm.find('[name="fera-body"]'),this.$filesInput=this.$submissionForm.find('[name="fera-files"]'),this.$errorContainer=this.$submissionForm.find(".fera-errorContainer"),this.$summaryInput.on("change",function(){e.$summaryInput.data("fera-modified",!0)}),this.$totalCount=this.$submissionFormContainer.find("[data-fera-contentSubmission-info]"),this.$totalCount.html(this._totalCount-this._products.length+1+" / "+this._totalCount),1==this._totalCount&&this.$totalCount.hide(),this._initCloseButtons(),this._initReviewSections(),this._initUploadArea(),this._initSubmitAndReviewNextBtns()}},{key:"_initCloseButtons",value:function e(){var t=this;this.$submissionFormContainer.find("[data-fera-contentSubmission-closeBtn]").on("click",function(e){return t._closeWindow(e)}),this.$submissionSuccessContainer.find("[data-fera-contentSubmission-closeBtn]").on("click",function(e){return t._closeWindow(e)}),this.$submissionRewardContainer.find("[data-fera-contentSubmission-closeBtn]").on("click",function(e){return t._closeWindow(e)}),this.$submissionRewardContainer.find("[data-fera-contentSubmission-closeWindowBtn]").on("click",function(e){return t._closeWindow(e)})}},{key:"_initUploadArea",value:function u(){var t=this,e=this.$submissionForm.find("#fera-contentSubmission-formControl-upload");this._requestPhoto?e.on("change",function(e){return t._onFileChange(e)}):e.closest(".fera-contentSubmission-formControl-uploadRow").remove()}},{key:"_onFileChange",value:function d(e){var t="",n=e.target.files;t=1<n.length?n.length+" files selected":n[0].name,this.$submissionForm.find(".fera-uploadLabel").text(t)}},{key:"_initReviewSections",value:function f(){var t=this;if(this._requestReview){if(0<this._products.length){var e=this._products[0],n='<a class="fera-link" target="_blank" href="'+e.url+'">'+(e.name.length<=27?e.name:e.name.substr(0,27)+"...")+"</a>";this.$submissionForm.find(".fera-productTitle").html(n)}else this.$submissionForm.find(".fera-productTitle").closest(".fera-contentSubmission-row").hide();this.$submissionForm.find("[data-fera-contentsubmission-star]").on("click",function(e){return t._applyRating(e)}),this._populatePreviousReview()}else this.$submissionForm.find(".fera-contentSubmission-row").remove()}},{key:"_applyRating",value:function p(e,t){var n=this,i=arguments.length<=1||t===undefined?null:t;i=i||this.$(e.target).data("rating"),this.$submissionForm.find('[name="fera-rating"]').val(i),this.$submissionForm.find("[data-fera-contentSubmission-star]").each(function(e,t){e<i?n.$(t).addClass("fera-star--starred"):n.$(t).removeClass("fera-star--starred")}),this._prefillDefaultMessages(i),e&&e.preventDefault&&e.preventDefault()}},{key:"_prefillDefaultMessages",value:function h(e){if(!(this._previous_review.heading||this.$summaryInput.data("fera-modified")&&this.$summaryInput.val())){var t={1:["Really not happy.","No good.","Pretty bad.","No thanks."],2:["Not happy.","Nah.","Probably not again.","Not the best."],3:["Meh.","Not amazing.","Pretty ok.","It's fine."],4:["Pretty good!","I dig it!","Solid!","Recommended!"],5:["Great!","Fantastic!","Excellent!","Highly recommended!"]};this.$summaryInput.val(t[e][Math.floor(4*Math.random())]),this.$summaryInput.data("fera-modified",!1)}}},{key:"_populatePreviousReview",value:function g(){var e=this._previous_review,t=e.rating,n=e.heading,i=e.body;t&&this._applyRating(null,t),n&&this.$summaryInput.val(n),i&&this.$bodyInput.val(i)}},{key:"_initSubmitAndReviewNextBtns",value:function m(){var t=this;this.$submissionForm.find("[data-fera-contentSubmission-submitBtn]").on("click",function(e){return t._submitForm(e)}),this.$submissionSuccessContainer.find("[data-fera-contentSubmission-reviewNextBtn]").on("click",function(){return t._reviewNextProduct()})}},{key:"_submitForm",value:function v(e){var t=this;e.preventDefault();var n=this.$(e.target),i=new FormData,r=Array.from(this.$filesInput.prop("files")||[]),a=this._products[0];10<r.length?this.$errorContainer.text("You cannot upload more than 10 images.").removeClass("fera-hidden"):(n.text("Loading..."),n.prop("disabled",!0),i.append("customer_review[rating]",this.$ratingInput.val()||""),i.append("customer_review[heading]",this.$summaryInput.val()||""),i.append("customer_review[body]",this.$bodyInput.val()||""),r.forEach(function(e){i.append("customer_review[files][]",e,e.name)}),this._opts.api.submitContent({data:i,params:{customer_message_token:this.customerMessageToken,content_campaign_token:this.contentCampaignToken,product_id:a?a.id:null},success:function o(){return t._checkForNextReview()},error:function s(){t.$errorContainer.text("There was an error submitting your review. Please try again").removeClass("fera-hidden"),n.text("Submit"),n.prop("disabled",!1)}}))}},{key:"_checkForNextReview",value:function y(){this._products.shift(),0<this._products.length?(this.$submissionFormContainer.fadeOut(),this.$submissionSuccessContainer.removeClass("fera-hidden").fadeIn()):this._closeFormAndShowReward()}},{key:"_closeFormAndShowReward",value:function b(){this.$submissionFormContainer.fadeOut(),this.$submissionRewardContainer.removeClass("fera-hidden").fadeIn(),this._initCloseButtons()}},{key:"_closeWindow",value:function w(e){this.$submissionFormContainer.addClass("fera-hidden"),this.$submissionRewardContainer.addClass("fera-hidden"),this.$submissionSuccessContainer.addClass("fera-hidden"),this.$(".fera-contentSubmission--overlay").addClass("fera-hidden"),this.$("body").removeClass("fera-modal--open"),e&&e.preventDefault&&e.preventDefault()}},{key:"_reviewNextProduct",value:function _(){this.$submissionSuccessContainer.fadeOut(),this.$submissionFormContainer.fadeIn();var e=this.$(this._html).find("form");this.$submissionForm.html(e),this._initElementsAndListeners()}},{key:"_redirectToHomeOrProductPage",value:function k(){var e="/";this._products&&0<this._products.length&&(e=this._products[0].url),location.href=e}},{key:"_showLoadingState",value:function C(){var e='\n      <div class="fera-contentSubmission--overlay"></div>\n      <div class="fera-contentSubmission--loading">\n        <div class="fera-contentSubmission-modal">\n            <div class="fera-contentSubmission-loading">\n                <div class="fera-container">\n                    <div>Loading...<div>\n                </div>\n            </div>\n        </div>\n      </div>\n    ',t="\n      body.fera-modal--open {\n        overflow: hidden !important;\n      }\n      .fera-contentSubmission-modal {\n        height: 100vh;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 10px;\n      }\n      .fera-contentSubmission-loading,\n      .fera-contentSubmission {\n        position: relative;\n        background-color: white;\n        padding: 50px 45px 50px;\n        border-radius: 5px;\n        box-shadow: 0px 3px 20px rgba(0, 0, 0, 0.2);\n        width: 400px;\n        min-height: 500px;\n        max-height: 90vh;\n        display: flex;\n        justify-content: center;\n        flex-direction: column;\n        z-index: 9999999;\n      }\n      .fera-contentSubmission--overlay,\n      .fera-submissionForm,\n      .fera-submissionReward,\n      .fera-submissionSuccess,\n      .fera-contentSubmission--loading {\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        position: fixed;\n        z-index: 9999999;\n      }\n\n      .fera-contentSubmission--overlay {\n        background: rgba(0,0,0,0.3);\n        z-index: 9999998;\n      }\n\n      .fera-contentSubmission-loading .fera-container {\n        text-align: center;\n        font-size: 20px;\n      }\n      .fera-contentSubmission-loading button {\n        color: white;\n        border: none;\n        padding: 12px 20px;\n        border-radius: 5px;\n        font-size: 14px;\n        background-color: #1E2139;\n        margin-top: 40px;\n      }\n      .fera-contentSubmission-loading button:hover {\n        background-color: black;\n      }\n      .fera-hidden {\n        display: none !important;\n      }\n    ";this._renderTemplate(e,t)}},{key:"_hideLoadingState",value:function x(e){var t=arguments.length<=0||e===undefined||e;this.$loadingStateContainer.addClass("fera-hidden"),t&&this._redirectToHomeOrProductPage()}}]),n}(),Fera.ShopifyAdapter=function(n){var e=this,i=Fera.Util.$();n=n||{};var r=[];this.cartAdapter=new Fera.ShopifyCartAdapter(n);var t=function(){n.logger.log("Shopify adapter initialized."),s(),h(),e.variantLoader=new Fera.VariantLoader(n),a()?o():(l(),setInterval(function(){l()},250))},a=function(){if(-1!==window.location.toString().indexOf("/password"))return!0;var e=i('link[rel="canonical"]').attr("href");return!(!e||-1===e.indexOf("/password"))},o=function(){if(n.app.opts.sandboxMode)return i('a[href="/admin"]').on("click",function(e){e.preventDefault(),alert("Please enter your storefront password instead. You can find it at YOUR_STORE_URL/admin/online_store/preferences.")}),setTimeout(function(){var e=i('a[href="#LoginModal"],.password__open-modal');e.length<=0||Fera.Util.scrollToElement(e,{callback:function(){e.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}})},1e3),!0},s=function(){-1!==window.location.toString().indexOf("/checkouts/")&&i('<div class="banana-container banana-cart-container banana-order-top-container fera-order-top-container" data-container_type="cart"></div>').insertAfter(".breadcrumb")},l=function(){c(),u()},c=function(){i('form[action~="/cart/add"] button[type=submit],form[action~="/cart/add"] input[type=submit],.product-form__cart-submit,.add-to-cart, .addToCart, .add_to_cart, #addToCart, #add-to-cart, #add_to_cart, .add-to-cart input.button,.btn-addtocart').each(function(){var e=i(this);if(e.data("Fera.listenersBound"))return!0;if(e.length<=0)n.logger.warn("Fera did not find the add to cart button so it will not be enabled for add to cart events.");else{var t=f(e.parents("form"));e.on("click touch",function(){p(t)}),e.data("Fera.listenersBound",!0)}})},u=function(){i('form[action~="/cart/add"]').each(function(){var e=i(this);if(e.data("Fera.listenersBound"))return!0;if(e.length<=0)n.logger.warn("Fera did not find the add to cart form.");else{var t=f(e);e.on("submit",function(){p(t)}),e.data("Fera.listenersBound",!0)}})},d=function(e){return e&&0<e.length&&!e.match(/\D/)?e:null},f=function(e){var t=d(e.data("productid"))||d(e.data("product-id"))||d(e.find("[data-productid]").data("productid"))||d(e.find("[data-product-id]").data("product-id"));if(!t){var n=e.attr("id");n&&(n=n.split("_").pop()),t=d(n)}var i=d(e.find('[name="id"]').val()),r={};return i&&(r.variant_id=i),t&&(r.product_id=t),r!={}&&Fera.logger.log("Located product/variant event data for click: ",r),r},p=function(t){for(var e=0;e<r.length;e++)if(r[e].variant_id===t.variant_id&&r[e].product_id===t.product_id)return;r.push(t),n.app.pushAddToCartEvent(t),setTimeout(function(){for(var e=0;e<r.length;e++)if(r[e].variant_id===t.variant_id&&r[e].product_id===t.product_id){r.splice(e,1);break}},1e3)},h=function(){if("undefined"!=typeof Shopify&&Shopify.theme&&Shopify.theme.name){var e=Shopify.theme.name.toLowerCase();-1===e.indexOf("boundless")&&-1===e.indexOf("narrative")||Fera.Util.isHome()&&(i("body").addClass("fera-themeWithFixedHeader fera-themeWithFixedHeader--adjust"),-1!==e.indexOf("narrative")&&i(".site-header--homepage").addClass("fera-themeWithFixedHeader--adjust"))}};t()},Fera.ShopifyAdapter.generateProductDataAttribute=function(e){try{var t={id:e.id,name:e.title,variants:[]};"string"==typeof e.images?t.thumbnail_url=e.images:"undefined"!=typeof e.image&&("string"==typeof e.image?t.thumbnail_url=e.image:"object"==typeof e.image&&"string"==typeof e.image.src&&(t.thumbnail_url=e.image.src));for(var n=0;n<e.variants.length;n++){var i=e.variants[n],r={name:i.title,stock:i.inventory_quantity,inventory_policy:i.inventory_policy,manages_stock:i.inventory_management&&""!==i.inventory_management};i.image&&i.image.src&&(r.thumbnail_url=i.image.src),t.variants.push(r)}return encodeURI("0617-"+Fera.Util.encode(JSON.stringify(t)))}catch(a){return console.error(a.message,a),null}},Fera.ShopifyCartAdapter=function(l){var e=this,c=Fera.Util.$(),t=function(){n(),i()},n=function(){c(document).on("ajaxComplete",function(e,t,n){300<=t.status||!l.app.cart||(n&&-1!==n.url.indexOf("/cart.js")?l.app.cart.loadCartData(JSON.parse(t.responseText)):n&&/\/cart\/(add|update|clear|change)/.test(n.url)&&(-1!==n.url.indexOf("/cart/add")?l.app.cart.loadItemData(JSON.parse(t.responseText)):l.app.cart.loadCartData(JSON.parse(t.responseText)),l.app.updateAllContainers()))})},i=function(){-1!==window.location.toString().indexOf("/thank_you")&&l.app.cart&&l.app.cart.reset()};e.startCheckout=function(){var e=Fera.Util.updateURLParameter(window.location.toString(),"ensure_loaded_cart","0");e=Fera.Util.updateURLParameter(e,"go_to_checkout","0"),window.location=e.replace("/cart","/checkout")},e.downloadData=function(t){c.getJSON("/cart.js",function(e){"function"==typeof t&&t(e)})},e.clear=function(e){c.ajax({method:"GET",type:"GET",data:{},dataType:"json",url:"/cart/clear",complete:function(){"function"==typeof e&&e()}})},e.parseCartData=function(e){var t={};if(!e)return null;t.item_count=e.item_count,t.currency=e.currency,t.total=e.total_price/100,t.total_weight=e.total_weight,t.total_discount=e.total_discount/100,t.items=[];for(var n=0;n<e.items.length;n++){var i=e.items[n];t.items.push({price:i.price/100,total:i.line_price/100,product_id:i.product_id,name:i.product_title,variant_id:i.variant_id,quantity:i.quantity})}return t},e.parseItemData=function(e){var t={};return e?(t.price=e.price/100,t.total=e.line_price/100,t.product_id=e.id,t.name=e.product_title,t.variant_id=e.variant_id,t.quantity=e.quantity,t.weight=e.grams,t.total_discount=e.total_discount,t):null},e.removeProduct=function(e,t,n){var i={},r=(l.app.cart.getData()||{}).items;if(!r)return!1;var a=0;t&&(a=t.quantity||0);for(var o=0;o<r.length;o++){var s=r[o];if(s.product_id==e){if(t){if(t.variant_id&&s.variant_id!=t.variant_id)continue;if(t.quantity){if(!(0<a))continue;if((a-=s.quantity)<0){i[s.variant_id]=0-a;break}}}i[s.variant_id]=0}}return 0!==Object.keys(i).length&&(c.ajax({method:"POST",type:"POST",data:{updates:i},dataType:"json",url:"/cart/update.js",complete:n.afterAdd||n.then||function(){}}),!0)},e.addProduct=function(t,e,n){var i={id:e.variant_id||e.variant||e.variantId,quantity:e.quantity||1};c.ajax({method:"POST",type:"POST",data:i,dataType:"json",url:"/cart/add.js",complete:function(){var e=arguments;r(t,function(){(n.afterAdd||n.then||function(){}).apply(this,e)})}})};var r=function(e,t){if(1<=l.app.cart.getProductQuantity(e))return t();setTimeout(function(){l.app.cart.update(function(){r(e,t)},!1)},500)};t()},Fera.BigcommerceAdapter=function(a){var e=this,o=Fera.Util.$();a=a||{};var s,l=null,t=function(){e.cartAdapter=new Fera.BigcommerceCartAdapter(a),y(),b(),i(),w(),u(),n()},n=function(){var e=window.location.toString();Fera.Util.isHome()?a.app.setSection("home"):-1!==e.indexOf("cart.php")?a.app.setSection("cart"):0<o(".banana-view-container").length?a.app.setSection("product_view"):0<o(".banana-list-container").length?a.app.setSection("product_list"):-1!==e.indexOf("checkout")&&a.app.setSection("checkout")},i=function(){a.params&&a.params.dynamically_integrate&&(-1!==a.params.dynamically_integrate.indexOf("product_view")&&p(),-1!==a.params.dynamically_integrate.indexOf("product_list")&&c(),-1!==a.params.dynamically_integrate.indexOf("cart_top")&&r())},r=function(){var e='<!-- BEGIN Fera.ai Shopping Cart Top Container --> <div class="banana-container banana-cart-container" data-container_type="cart" ></div> <!-- END -->';if(!(0<o(".banana-cart-container").length))if(-1!==window.location.toString().indexOf("/cart.php")){var t=o(".cart-container");0<t.length?t.each(function(){o(e).prependTo(o(this))}):o(e).insertAfter(o("h1,.page-title,.page-heading").first())}else-1===window.location.toString().indexOf("checkout")&&o(e).prependTo(o(".optimizedCheckout-contentPrimary"))},c=function(){var i='<!-- BEGIN Fera.ai Product List Bottom Container --> <div class="banana-container banana-list-container" data-product_id="#{product_id_code}" data-container_type="list"></div> <!-- END -->';if(f(i))return!0;o(".productGrid article, .product-grid-container article").each(function(){var e=o(this),t=e.find("[data-product-id]").first().data("product-id");if(t&&""!==t||e.find("a").each(function(){var e=o(this).attr("href");e&&-1!==e.indexOf("product_id=")&&(e.match(/.+(product_id|product-id|productId)=(.+).*/i)&&(t=e.match(/.+(product_id|product-id|productId)=(.+).*/i)[2]))}),t&&""!==t){var n=i;n=n.replace("#{product_id_code}",t),o(n).appendTo(e)}})},u=function(){o(document).on("ajaxComplete",function(e,t){try{if(!t)return;var n=JSON.parse(t.responseText);t&&n&&n.productListing&&c()}catch(i){}})},d=function(){return o(".product-grid *").contents().filter(function(){return 8===this.nodeType&&-1!==this.nodeValue.indexOf("snippet location product_rating")})},f=function(i){var e=d();if(e.length<1)return!1;var r=!1;return e.each(function(){var e=o(this),t=e.parents(".product-item").find("[data-product-id]").data("productId");if(t&&""!==t){var n=i.replace("#{product_id_code}",t);e.after(n),o(n).appendTo(e),r=!0}}),r},p=function(){var e='<!-- BEGIN Fera.ai Product View Container --> <div class="banana-container banana-view-container" data-product_id="#{product_id_code}" data-container_type="view"></div> <!-- END -->';if(g(e))return!0;0<s.length?v(e):m(e)},h=function(){return o(Fera.Util.ie()?"body":"*").contents().filter(function(){return 8===this.nodeType&&-1!==this.nodeValue.indexOf("snippet location product_addtocart")})},g=function(i){var e=h();if(e.length<1)return!1;var r=!1;return e.each(function(){var e=o(this),t=e.parents("form").find("[data-product-id]").val();if(t&&""!==t){a.app.getProductId()||a.app.setProductId(t);var n=i.replace("#{product_id_code}",t);e.after(n),o(n).appendTo(e),r=!0}}),r},m=function(e){for(var t=0;t<l.length;t++){var n=l[t],i=n.find("input[name=product_id]").val();a.app.getProductId()||a.app.setProductId(i);var r=e;r=r.replace("#{product_id_code}",i),o(r).appendTo(n)}},v=function(e){for(var t=0;t<s.length;t++){var n=s[t],i=n.attr("action").match(/.*product_id=([0-9]+).*/)[1],r=e;a.app.getProductId()||a.app.setProductId(i),r=r.replace("#{product_id_code}",i),o(r).insertAfter(n)}},y=function(){return null!=l||(l=[],o("form[action]").each(function(){var e=o(this);-1!==e.attr("action").indexOf("cart.php")&&l.push(e)})),l},b=function(){return null!=s||(s=[],o("form[action]").each(function(){var e=o(this);-1!==e.attr("action").indexOf("wishlist.php?action=add")&&s.push(e)})),s},w=function(){for(var e=0;e<l.length;e++){var t=l[0].find('#form-action-addToCart, input[type="submit"]');if(t.length<=0)return void a.logger.warn("Fera did not find the add to cart button so it will not be enabled for add to cart events.");t.on("click touch",function(){a.app.pushAddToCartEvent()})}};t()},Fera.BigcommerceCartAdapter=function(i){var u=this,o=Fera.Util.$(),e=function(){t(),r(),n()},t=function(){o(document).on("ajaxComplete",function(e,t,n){300<=t.status||n&&-1!==n.url.indexOf("/cart.php")||n&&-1!==n.url.indexOf("/remote/v1/cart/")&&setTimeout(function(){i.app.cart.update()},500)})},n=function(){o(window).on("load"
,function(){var e=document.querySelector("[data-cart-content]");if(e&&"undefined"!=typeof MutationObserver){var t={attributes:!0,childList:!0,characterData:!0};new MutationObserver(function(){i.app.cart.update(!0)}).observe(e,t)}})},r=function(){-1!==window.location.toString().indexOf("/order-confirmation")&&i.app.cart.reset()};u.startCheckout=function(){var e=Fera.Util.updateURLParameter(window.location.toString(),"ensure_loaded_cart","0");e=Fera.Util.updateURLParameter(e,"go_to_checkout","0"),window.location=e.replace("/cart","/checkout")},u.removeProduct=function(s,l,c){return o.ajax({method:"GET",type:"GET",data:{},dataType:"json",url:"/api/storefront/cart",beforeSend:function(e){e.setRequestHeader("x-xsrf-token",f())},complete:function(e){Fera.logger.log("Removing product...",e);var t=JSON.parse(e.responseText)[0];if(t){var n=[],i="",r=0;l&&(r=l.quantity||0);for(var a=0;a<t.lineItems.physicalItems.length;a++){var o=t.lineItems.physicalItems[a];if(o.productId==s)if(l&&l.quantity){if((r-=o.quantity)<=0){r<0&&(i=o.productId),n.push(o.id);break}}else n.push(o.id)}d(t.id,n,i?function(){l.quantity=0-r,u.addProduct(i,l,c)}:c.then)}else"function"==typeof c.then&&c.then()}}),!0},u.clear=function(a){o.ajax({method:"GET",type:"GET",data:{},dataType:"json",url:"/api/storefront/cart",beforeSend:function(e){e.setRequestHeader("x-xsrf-token",f())},complete:function(e){Fera.logger.log("Clearing cart...",e);var t=JSON.parse(e.responseText)[0];if(t){for(var n=[],i=0;i<t.lineItems.physicalItems.length;i++){var r=t.lineItems.physicalItems[i];n.push(r.id)}d(t.id,n,a)}else"function"==typeof a&&a()}})};var d=function(e,t,n){if(t.length<1)"function"==typeof n&&n();else{var i=t.shift();a(e,i,function(){setTimeout(function(){return d(e,t,n)},100)})}},a=function(e,t,n){o.ajax({method:"DELETE",type:"DELETE",data:{},dataType:"json",url:"/api/storefront/carts/"+e+"/items/"+t,beforeSend:function(e){e.setRequestHeader("x-xsrf-token",f())},complete:n})};u.downloadData=function(t){o.getJSON("/api/storefront/carts",function(e){e&&e[0]?t(e[0]):t(null)})},u.parseCartData=function(e){var t={};if(!e)return null;if(e.items)return s(e);!e.lineItems&&e[0]&&e[0].lineItems&&(e=e[0]),t.item_count=e.lineItems.physicalItems.length,t.currency=e.currency.code,t.total=e.cartAmount,t.total_discount=e.discountAmount,t.items=[];for(var n=0;n<e.lineItems.physicalItems.length;n++){var i=e.lineItems.physicalItems[n];t.items.push(u.parseItemData(i))}return t};var s=function(e){var t={};if(!e)return null;t.item_count=e.quantity,t.currency=e.currency,t.total=e.total?e.total.value:0,t.grand_total=e.grand_total?e.grand_total.value:0,t.total_discount=e.discount,t.items=[];for(var n=0;n<e.items.length;n++){for(var i=e.items[n],r=[],a=0;a<i.options.length;a++)r.push(i.options[a].id);t.items.push({price:i.price.value,total:i.total.value,product_id:i.product_id,name:i.name,variant_id:r,quantity:i.quantity})}return t};u.parseItemData=function(e){return e?{price:e.salePrice,total:e.salePrice*e.quantity,product_id:e.productId,name:e.name,variant_id:e.variantId,quantity:e.quantity}:null};var f=function(){var e=("; "+document.cookie).split("; XSRF-TOKEN=").pop().split(";")[0],t="";return BCData&&BCData.csrf_token&&(t=BCData.csrf_token),e||t};u.addProduct=function(e,t,n){var i={action:"add",product_id:e,qty:[1]};if(t){if(t.variant_id&&-1!==t.variant_id.indexOf("=")){i.attribute={};for(var r=t.variant_id.split("&"),a=0;a<r.length;a++){var o=r[a].split("=");i.attribute[o[0]]=o[1]}}i.qty=[t.quantity||1]}l(i,n)};var l=function(i,r){i.attribute?c(i,r):o.ajax({method:"GET",type:"GET",url:"/products.php?productId="+i.product_id,error:function(){c(i,r)},success:function(e){var n=!1;o(e).find('form[action*="cart.php"]').each(function(){var t={};if(o(this).serializeArray().forEach(function(e){"qty[]"!==e.name&&(t[e.name]=e.value)}),n=t.product_id==i.product_id)return c(o.extend(t,i),r),!1}),n||c(i,r)}})},c=function(e,t){t=t||{},o.ajax({method:"POST",type:"POST",data:e,dataType:"json",url:"/remote/v1/cart/add",beforeSend:function(e){e.setRequestHeader("x-xsrf-token",f())},complete:t.afterAdd||t.then||function(){}})};e()},Fera.MagentoAdapter=function(e){var t,n,i=Fera.Util.$();e=e||{};var r=function(){e.debugMode&&console.log("Magento adapter initialized."),t=i('form[action*="cart/add"]'),o(),a()},a=function(){var e='<!-- BEGIN Fera.ai Shopping Cart Top Container --> <div class="banana-container banana-cart-container" data-container_type="cart" ></div> <!-- END -->';if(!(0<i(".banana-cart-container").length)&&-1!==window.location.toString().indexOf("/checkout")){var t=i(".cart-container");0<t.length?t.each(function(){i(e).prependTo(i(this))}):i(e).insertAfter(i("h1,.page-title,.page-heading").first())}},o=function(){(n=t.find('button:contains("Add")')).length<1&&(n=t.find('input[type="submit"],button[onclick="productAddToCartForm.submit(this)"],a[onclick="productAddToCartForm.submit(this)"],#product-addtocart-button,button[title*="Add"],')),n.length<1?e.logger.logWarning("Fera did not find the add to cart button so it will not be enabled for add to cart events."):n.on("click touch",function(){e.app.pushAddToCartEvent()})};r()},Fera.CustomAdapter=function(e){Fera.Util.$();e=e||{},e.debugMode&&console.log("Custom adapter initialized.")};try{var loadFera=function(){window.fera&&window.fera.version||(window.fera=window.fera||[],window.__bsio&&(window.fera=window.fera.concat(window.__bsio)),window.fera=window.__bsio=new Fera.App({pushBuffer:window.fera,debugMode:window.feraDebugMode||window.__bsioDebugMode||!1,showErrors:window.feraShowErrors,standaloneMode:window.feraStandaloneMode||window.__bsioStandaloneMode||!1,supportedPlatforms:["shopify","bigcommerce","magento","custom"],parentWindow:window.parent&&0<window.parent.length?window.parent:window.opener}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",loadFera):loadFera()}catch(e){if(window.feraDebugMode||window.__bsioDebugMode||window.feraShowErrors)throw e;window.console&&window.console.error(e)}